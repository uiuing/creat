{"version":3,"file":"creat-loader.es.js","sources":["src/common/constants.ts","src/common/utils/index.ts","src/classFile/Author.ts","src/classFile/Background.ts","src/classFile/Cursor.ts","src/classFile/Event.ts","src/classFile/Export.ts","src/support/Canvas.ts","src/classFile/Grid.ts","src/classFile/History.ts","src/classFile/ImageEdit.ts","src/classFile/KeyCommand.ts","src/common/utils/checkClick.ts","src/support/BaseNode.ts","src/support/BaseMultiplexCoordinateNode.ts","src/support/plot.ts","src/support/DragNode.ts","src/components/ArbitraryPlot.ts","src/components/Arrow.ts","src/components/Circle.ts","src/components/Diamond.ts","src/components/Image.ts","src/components/Line.ts","src/components/Rectangle.ts","src/components/Text.ts","src/components/Triangle.ts","src/classFile/Nodes.ts","src/classFile/Render.ts","src/common/utils/Calculate.ts","src/components/MultiplexSelectNode.ts","src/classFile/Selection.ts","src/classFile/TextEdit.ts","src/components/index.ts","src/API.ts","src/index.ts"],"sourcesContent":["import { KeyPosit } from '../types'\n\n// The number key corresponding to the key position\nexport const keyPosit: KeyPosit = {\n  '0': 48,\n  '1': 49,\n  '2': 50,\n  '3': 51,\n  '4': 52,\n  '5': 53,\n  '6': 54,\n  '7': 55,\n  '8': 56,\n  '9': 57,\n  Backspace: 8,\n  Tab: 9,\n  Enter: 13,\n  Shift: 16,\n  Control: 17,\n  Alt: 18,\n  CapsLock: 20,\n  Esc: 27,\n  Space: 32,\n  PageUp: 33,\n  PageDown: 34,\n  End: 35,\n  Home: 36,\n  Insert: 45,\n  Left: 37,\n  Up: 38,\n  Right: 39,\n  Down: 40,\n  Del: 46,\n  NumLock: 144,\n  Cmd: 91,\n  CmdFF: 224,\n  F1: 112,\n  F2: 113,\n  F3: 114,\n  F4: 115,\n  F5: 116,\n  F6: 117,\n  F7: 118,\n  F8: 119,\n  F9: 120,\n  F10: 121,\n  F11: 122,\n  F12: 123,\n  '`': 192,\n  '=': 187,\n  '+': 187,\n  '-': 189,\n  \"'\": 222,\n  '/': 191,\n  '.': 190,\n  a: 65,\n  b: 66,\n  c: 67,\n  d: 68,\n  e: 69,\n  f: 70,\n  g: 71,\n  h: 72,\n  i: 73,\n  j: 74,\n  k: 75,\n  l: 76,\n  m: 77,\n  n: 78,\n  o: 79,\n  p: 80,\n  q: 81,\n  r: 82,\n  s: 83,\n  t: 84,\n  u: 85,\n  v: 86,\n  w: 87,\n  x: 88,\n  y: 89,\n  z: 90\n}\n// Click on the applicable trigger pixel range\nexport const CLICK_DISTANCE = 10\n\n// Four corners of a graphical object\nexport const FOUR_CORNER = {\n  TOP_LEFT: 'topLeft',\n  TOP_RIGHT: 'topRight',\n  BOTTOM_RIGHT: 'bottomRight',\n  BOTTOM_LEFT: 'bottomLeft'\n}\n\n// Drag and drop a part of a graphic object\nexport const DRAG_NODE_PARTS = {\n  BODY: 'body',\n  ROTATE: 'rotate',\n  TOP_LEFT_BUTTON: 'topLeftButton',\n  TOP_RIGHT_BUTTON: 'topRightButton',\n  BOTTOM_RIGHT_BUTTON: 'bottomRightButton',\n  BOTTOM_LEFT_BUTTON: 'bottomLeftButton'\n}\n","import { Ctx, LocalData, Node, NodeArray, Style } from '../../types'\n\n// Generate an ID, seeded with a timestamp + random number, with the first half random and the second half incremental\nexport function getNodeID() {\n  const seed = Math.floor(Math.random() * 1e12) * 1e7 + new Date().getTime()\n  return seed.toString(36)\n}\n\n// Unique key for graphical objects\nlet nodeKeyIndex = 0\nexport function createNodeKey() {\n  nodeKeyIndex += 1\n  return nodeKeyIndex\n}\n\nexport const deepCopy = (obj: LocalData) => JSON.parse(JSON.stringify(obj))\n\n// Download the file\nexport const downloadFile = (file: string, fileName: string) => {\n  const a = document.createElement('a')\n  a.href = file\n  a.download = fileName\n  a.click()\n}\n\n// Throttling\nexport const throttle = (fn: any, ctx: Ctx, time = 20) => {\n  let _timer: any = null\n  return (...args: any) => {\n    if (_timer) {\n      return\n    }\n    _timer = setTimeout(() => {\n      fn.call(ctx, ...args)\n      _timer = null\n    }, time)\n  }\n}\n\n// Spliced text font size string\nexport const getFontString = (fontSize: number, fontFamily: string) =>\n  `${fontSize}px ${fontFamily}`\n\n// Text cut into lines\nexport const splitTextLines = (text: string) =>\n  text.replace(/\\r\\n?/g, '\\n').split('\\n')\n\n// Curvature to angle\nexport const radToDeg = (rad: number) => rad * (180 / Math.PI)\n\n// Angle to radians\nexport const degToRad = (deg: number) => deg * (Math.PI / 180)\n\nexport const createCanvas = (\n  width: number,\n  height: number,\n  option: { noStyle?: boolean; noTranslate?: boolean; className?: string } = {\n    noStyle: false,\n    noTranslate: false,\n    className: ''\n  }\n) => {\n  const canvas = document.createElement('canvas')\n  if (!option.noStyle) {\n    canvas.style.cssText = `position: absolute;left: 0;top: 0;`\n  }\n  if (option.className) {\n    canvas.className = option.className\n  }\n  // Get Drawing Context\n  const ctx = canvas.getContext('2d')\n  canvas.width = width\n  canvas.height = height\n  // Move the canvas origin to the centre of the canvas\n  if (!option.noTranslate) {\n    ctx?.translate(canvas.width / 2, canvas.height / 2)\n  }\n  return {\n    canvas,\n    ctx\n  }\n}\n\n// Calculate the distance between two coordinates\nexport const getTowCoordinateDistance = (\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number\n) => Math.sqrt((x1 - x2) ** 2 + (y1 - y2) ** 2)\n\n// Calculate the distance from a point to a line\nexport const getCoordinateToLineDistance = (\n  x: number,\n  y: number,\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number\n) => {\n  // Straight line perpendicular to x-axis\n  if (x1 === x2) {\n    return Math.abs(x - x1)\n  }\n  const B = 1\n  const A = (y1 - y2) / (x2 - x1)\n  const C = 0 - B * y1 - A * x1\n  return Math.abs((A * x + B * y + C) / Math.sqrt(A * A + B * B))\n}\n\n// Check if you have clicked on a line segment\nexport const checkIsAtSegment = (\n  x: number,\n  y: number,\n  x1: number,\n  y1: number,\n  x2: number | undefined,\n  y2: number | undefined,\n  dis = 10\n) => {\n  if (typeof x2 === 'undefined' || typeof y2 === 'undefined') {\n    return false\n  }\n  if (getCoordinateToLineDistance(x, y, x1, y1, x2, y2) > dis) {\n    return false\n  }\n  const dis1 = getTowCoordinateDistance(x, y, x1, y1)\n  const dis2 = getTowCoordinateDistance(x, y, x2, y2)\n  const dis3 = getTowCoordinateDistance(x1, y1, x2, y2)\n  const max = Math.sqrt(dis * dis + dis3 * dis3)\n  return dis1 <= max && dis2 <= max\n}\n\n// Calculate the angle of difference between two coordinates with the same centre point\nexport const getTowCoordinateRotate = (\n  cx: number,\n  cy: number,\n  tx: number,\n  ty: number,\n  fx: number,\n  fy: number\n) => radToDeg(Math.atan2(ty - cy, tx - cx) - Math.atan2(fy - cy, fx - cx))\n\n// Get coordinates rotated by a specified angle from a specified centre, clockwise or anti-clockwise rotate by passing positive or negative\nexport const getRotatedCoordinate = (\n  x: number,\n  y: number,\n  cx: number,\n  cy: number,\n  rotate: number\n) => {\n  const deg = radToDeg(Math.atan2(y - cy, x - cx))\n  const del = deg + rotate\n  const dis = getTowCoordinateDistance(x, y, cx, cy)\n  return {\n    x: Math.cos(degToRad(del)) * dis + cx,\n    y: Math.sin(degToRad(del)) * dis + cy\n  }\n}\n\n// Get the coordinates of the element's centroid\nexport const getNodeCenterCoordinate = (node: any) => {\n  const { x, y, width, height }: any = node as Node\n  return {\n    x: x + width / 2,\n    y: y + height / 2\n  }\n}\n\n// Rotate the coordinates by the specified angle at the specified centre point\nexport const transformCoordinateReverseRotate = (\n  x: number,\n  y: number,\n  cx: number,\n  cy: number,\n  rotate: number\n) => {\n  if (rotate !== 0) {\n    const rp = getRotatedCoordinate(x, y, cx, cy, -rotate)\n    x = rp.x\n    y = rp.y\n  }\n  return {\n    x,\n    y\n  }\n}\n\n//  Handles mouse coordinates according to whether the element is rotated or not, if the element is rotated, then the mouse coordinates are rotated backwards\nexport const transformCoordinateOnNode = (x: number, y: number, node: any) => {\n  const center = getNodeCenterCoordinate(node as Node)\n  return transformCoordinateReverseRotate(\n    x,\n    y,\n    center.x,\n    center.y,\n    <number>node.rotate\n  )\n}\n\n// Get the four corner coordinates of the object\nexport const getNodeFourCornerCoordinate = (node: Node, dir: string) => {\n  const { x, y, width, height }: any = node\n  switch (dir) {\n    case 'topLeft':\n      return {\n        x,\n        y\n      }\n    case 'topRight':\n      return {\n        x: x + width,\n        y\n      }\n    case 'bottomRight':\n      return {\n        x: x + width,\n        y: y + height\n      }\n    case 'bottomLeft':\n      return {\n        x,\n        y: y + height\n      }\n    default:\n      break\n  }\n  return {}\n}\n\n// Get the outer bounding box for multiple coordinates\nexport const getBoundingRect = (\n  coordinateArr = [],\n  returnFourCorners = false\n) => {\n  let minX = Infinity\n  let maxX = -Infinity\n  let minY = Infinity\n  let maxY = -Infinity\n  coordinateArr.forEach((coordinate) => {\n    const [x, y]: Array<number> = coordinate\n    if (x < minX) {\n      minX = x\n    }\n    if (x > maxX) {\n      maxX = x\n    }\n    if (y < minY) {\n      minY = y\n    }\n    if (y > maxY) {\n      maxY = y\n    }\n  })\n  const x = minX\n  const y = minY\n  const width = maxX - minX\n  const height = maxY - minY\n  // Return in four corner coordinates\n  if (returnFourCorners) {\n    return [\n      {\n        x,\n        y\n      },\n      {\n        x: x + width,\n        y\n      },\n      {\n        x: x + width,\n        y: y + height\n      },\n      {\n        x,\n        y: y + height\n      }\n    ]\n  }\n  return {\n    x,\n    y,\n    width,\n    height\n  }\n}\n\n// Get the coordinates of the four corners of a rotated graphic object\nexport const getNodeRotatedFourCornerCoordinate = (node: Node, dir: string) => {\n  const center = getNodeCenterCoordinate(node)\n  const dirPos = getNodeFourCornerCoordinate(node, dir)\n  if (!dirPos || !dirPos.x || !dirPos.y) {\n    return 0\n  }\n  return getRotatedCoordinate(\n    dirPos.x,\n    dirPos.y,\n    center.x,\n    center.y,\n    <number>node.rotate\n  )\n}\n\n// Determines whether a coordinate is within a rectangle. rx can be a graphical object with x, y, width, height\nexport const checkCoordinateIsInRectangle = (\n  x: number,\n  y: number,\n  rx: number | Node,\n  ry?: number | undefined,\n  rw?: number | undefined,\n  rh?: number | undefined\n) => {\n  if (typeof rx === 'object') {\n    const node = rx\n    rx = node.x as number\n    ry = node.y\n    rw = node.width\n    rh = node.height\n  }\n  if (\n    typeof ry === 'undefined' ||\n    typeof rw === 'undefined' ||\n    typeof rh === 'undefined'\n  ) {\n    return false\n  }\n  return x >= rx && x <= rx + rw && y >= ry && y <= ry + rh\n}\n\n// Get the outermost bounding box information of multiple graphic objects\nexport const getMultiplexNodeRectInfo = (nodeList: NodeArray = []) => {\n  if (nodeList.length <= 0) {\n    return {\n      minX: 0,\n      maxX: 0,\n      minY: 0,\n      maxY: 0\n    }\n  }\n  let minX = Infinity\n  let maxX = -Infinity\n  let minY = Infinity\n  let maxY = -Infinity\n  nodeList.forEach((node) => {\n    const coordinateList = node?.getEndCoordinateList?.()\n    coordinateList.forEach(({ x, y }: { x: number; y: number }) => {\n      if (x < minX) {\n        minX = x\n      }\n      if (x > maxX) {\n        maxX = x\n      }\n      if (y < minY) {\n        minY = y\n      }\n      if (y > maxY) {\n        maxY = y\n      }\n    })\n  })\n  return {\n    minX,\n    maxX,\n    minY,\n    maxY\n  }\n}\n\n// Calculate the actual rendering width of the text\nlet textCheckEl: HTMLDivElement | null = null\nexport const getTextActWidth = (text: string, style: Style) => {\n  if (!textCheckEl) {\n    textCheckEl = document.createElement('div')\n    textCheckEl.style.position = 'fixed'\n    textCheckEl.style.left = '-99999px'\n    document.body.appendChild(textCheckEl)\n  }\n  const { fontSize, fontFamily } = style\n  textCheckEl.innerText = text\n  textCheckEl.style.fontSize = `${fontSize}px`\n  textCheckEl.style.fontFamily = fontFamily\n  const { width } = textCheckEl.getBoundingClientRect()\n  return width\n}\n\n//  Gets the coordinates of the four corners of the graphical object, after applying the rotation\nexport const getNodeFourCorners = (node: Node) => {\n  const bottomRight = getNodeRotatedFourCornerCoordinate(node, 'bottomRight')\n  const topLeft = getNodeRotatedFourCornerCoordinate(node, 'topLeft')\n  const topRight = getNodeRotatedFourCornerCoordinate(node, 'topRight')\n  const bottomLeft = getNodeRotatedFourCornerCoordinate(node, 'bottomLeft')\n  return [topLeft, topRight, bottomLeft, bottomRight]\n}\n\n// Creating picture objects\nexport const createImageObj = (url: string) =>\n  new Promise((resolve) => {\n    const img = new Image()\n    img.setAttribute('crossOrigin', 'anonymous')\n    img.onload = () => {\n      resolve(img)\n    }\n    img.onerror = () => {\n      resolve(null)\n    }\n    img.src = url\n  })\n\n// Calculate the maximum font size that will fit all text within a fixed width\nexport const getMaxFontSizeInWidth = (\n  text: string,\n  width: number,\n  style: { fontSize: number; fontFamily: string }\n) => {\n  let fontSize = 12\n  while (\n    getTextActWidth(text, {\n      ...style,\n      fontSize: fontSize + 1\n    }) < width\n  ) {\n    fontSize += 1\n  }\n  return fontSize\n}\n\n// Calculating the actual width of line feed text\nexport const getWrapTextActWidth = (node: Node) => {\n  const { text }: any = node\n  const textArr = splitTextLines(text)\n  let maxWidth = -Infinity\n  textArr.forEach((textRow) => {\n    const width = getTextActWidth(textRow, <any>node.style)\n    if (width > maxWidth) {\n      maxWidth = width\n    }\n  })\n  return maxWidth\n}\n\n// Calculate the number of words in the longest line of newline text\nexport const getWrapTextMaxRowTextNumber = (text: string) => {\n  const textArr = splitTextLines(text)\n  let maxNumber = -Infinity\n  textArr.forEach((textRow) => {\n    if (textRow.length > maxNumber) {\n      maxNumber = textRow.length\n    }\n  })\n  return maxNumber\n}\n\n// Calculate the width and height of a text graphic object\nexport const getTextNodeSize = (node: Node) => {\n  const { text, style }: any = node\n  const width = getWrapTextActWidth(node)\n  const lines = Math.max(splitTextLines(text).length, 1)\n  const lineHeight = style.fontSize * style.lineHeightRatio\n  const height = lines * lineHeight\n  return {\n    width,\n    height\n  }\n}\n\n// Calculate brush thickness based on speed\nexport const computedLineWidthBySpeed = (\n  speed: number,\n  lastLineWidth: number,\n  baseLineWidth = 2\n) => {\n  let lineWidth = 0\n  const maxLineWidth = baseLineWidth + 2\n  const maxSpeed = 10\n  const minSpeed = 0.5\n  if (speed >= maxSpeed) {\n    lineWidth = baseLineWidth\n  } else if (speed <= minSpeed) {\n    lineWidth = maxLineWidth + 1\n  } else {\n    lineWidth =\n      maxLineWidth - ((speed - minSpeed) / (maxSpeed - minSpeed)) * maxLineWidth\n  }\n  if (lastLineWidth === -1) {\n    lastLineWidth = maxLineWidth\n  }\n  return lineWidth * 0.5 + lastLineWidth * 0.3\n}\n","import { keyPosit } from '../common/constants'\nimport { throttle } from '../common/utils'\nimport { AppObject } from '../types'\n\nexport default class Author {\n  public app: AppObject\n\n  public startScrollX: number | undefined\n\n  public startScrollY: number | undefined\n\n  isDragAuthor: boolean\n\n  constructor(app: AppObject) {\n    this.app = app\n    // Save the scroll offset when dragging is about to start\n    this.startScrollX = 0\n    this.startScrollY = 0\n    // Canvas drag and drop Author\n    this.isDragAuthor = false\n    // A little relief from lag\n    this.onMove = throttle(this.onMove, this as any, 15)\n    this.bindEvent()\n  }\n\n  // Save the current scroll offset\n  onStart() {\n    this.startScrollX = this.app.state.scrollX\n    this.startScrollY = this.app.state.scrollY\n  }\n\n  // Update scroll offset and re-render\n  onMove(e: any, event: { mouseOffset: { originX: number; originY: number } }) {\n    if (\n      typeof this.startScrollX !== 'undefined' &&\n      typeof this.startScrollY !== 'undefined' &&\n      typeof this.app.state.scale !== 'undefined'\n    ) {\n      this.app.scrollTo(\n        this.startScrollX - event.mouseOffset.originX / this.app.state.scale,\n        this.startScrollY - event.mouseOffset.originY / this.app.state.scale\n      )\n    }\n  }\n\n  bindEvent() {\n    this.app.event.on('keydown', (e: { keyCode: number }) => {\n      if (e.keyCode === keyPosit.Space) {\n        this.isDragAuthor = true\n        this.app.cursor.set('grab')\n      }\n    })\n    this.app.event.on('keyup', () => {\n      if (this.isDragAuthor) {\n        this.isDragAuthor = false\n        this.app.cursor.set('default')\n      }\n    })\n  }\n\n  // Set to edit Author\n  setEditAuthor() {\n    this.app.cursor.set('default')\n    this.app.updateState({\n      readonly: false\n    })\n  }\n\n  // Set to read-only Author\n  setReadonlyAuthor() {\n    this.app.cursor.set('grab')\n    this.app.cancelActiveNode()\n    this.app.updateState({\n      readonly: true\n    })\n  }\n}\n","import { AppObject, Ctx } from '../types'\n\nexport default class Background {\n  public app: AppObject\n\n  constructor(app: AppObject) {\n    this.app = app\n  }\n\n  // Setting the background\n  set() {\n    if (this.app.state.backgroundColor) {\n      this.addBackgroundColor()\n    } else {\n      this.remove()\n    }\n  }\n\n  // Add background colour\n  addBackgroundColor() {\n    this.app.mountEL.style.backgroundColor = <string>(\n      this.app.state.backgroundColor\n    )\n  }\n\n  // Remove background colour\n  remove() {\n    this.app.mountEL.style.backgroundColor = ''\n  }\n\n  // Set background colour inside canvas, not css style\n  static canvasAddBackgroundColor(\n    ctx: Ctx,\n    width: number,\n    height: number,\n    backgroundColor: string\n  ) {\n    ctx.save()\n    ctx.rect(0, 0, width, height)\n    ctx.fillStyle = backgroundColor\n    ctx.fill()\n    ctx.restore()\n  }\n}\n","import { DRAG_NODE_PARTS } from '../common/constants'\nimport { AppObject } from '../types'\n\nexport default class Cursor {\n  public app: AppObject\n\n  public currentType: string\n\n  constructor(app: AppObject) {\n    this.app = app\n    this.currentType = 'default'\n  }\n\n  // Set the mouse pointer style\n  set(type = 'default') {\n    this.currentType = type\n    let style = type\n    if (type === 'eraser') {\n      style = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAbZJREFUSEvNlL1rVEEUxc95uwvCVjYKNnZa2ATEXrALNhaKiBgQDabQwt13hlQbi30w8x4oNhaCkYBFElAhoJXaip2FRfIX2FhY2c2VJy5skn0fERacbphzf3Pv5dxLzOlwTlz8H2Dv/VqSJF/NbFHS3bpqW2ec5/mqmWUk1wC8iTFmzrnLVfBWYO/9gGQxBVkl+c7M1iWdnwVvBIcQ7gN4OiP4IckPZrYj6fTB91pwURT3YozPqso1sxWSnwF8knR8WlcJDiHcAfC8yY5mdgvAT5KvJXUn+plg7/0SyZdN0Kn3bQA/JK1UgvM8v2Fmr44A/SMleSlN048zwSGEqwC2jgpNkmRxOBy+r+yx9/4xyQUAF9vCzeyKc+5trStCCCaJRVFciDF+aQG/Lmmz1schhHKKXkg6UQqzLDvT7XZ3a+BLkjZaTV6ZcafTOTsYDPbKgPF4fLLX630/VCa5nKZprRX32a1cMiRHZTsmsNFodKzf7/+a3M3stnNuvalNh3w8gQO4Jmn7r1OeADhlZjedc62sWDUgyyQfADgH4BuAR2WG5UdNmdZOXtvgOl3jdvvXT+YG/g3VNZQXhpoDKQAAAABJRU5ErkJggg==) 10 10, auto`\n    }\n    if (type === 'text') {\n      style = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAWZJREFUSEvNlLFOwzAQhi+5iaUrDDwBHekDNHtZEOorMFk5JQ8APEAsJyOPwAjsZEZ0LAMrCzwBUxx0kVM5adI4RZXwlMj2p///fXceHGh5B+LC/wPHcXxWFMWSHSulbtvO91JsoA8AMDXAXCkV2PC9wAwgIlZ5Y8HubOWjwLX9GtCCN1Q7g1v2N+oM/Mr3/Usp5UftwAlsoG8AcNRlnfeTJHkflbGBrnvqvZGrM5iI5gDw0gNdI+KyrXQwigHoDyLO+qAM78w4DMNjz/O++todEae7oJ1gIcQpIn7+BboFHrDP5wOlVO4yuBpREBGX1HnPRWdoQ3EURQut9VMXtCzLkzRNv12UblUFET0CwEX7stZ6lmXZagx0o1gIMTEPNrEAK631dQ01rVuNyPobAHg+5PZeQ7HVXWz31ff9eynls62SiEoDCqzhU+Vu73VFMd/14qZiWDGDuCOrZf/b952G0Nh8+fwvoNqzF6HDmhsAAAAASUVORK5CYII=) 10 10, auto`\n    }\n    this.app.mountEL.style.cursor = style\n  }\n\n  setEraser() {\n    this.set('eraser')\n  }\n\n  setText() {\n    this.set('text')\n  }\n\n  setMove() {\n    this.set('move')\n  }\n\n  hide() {\n    this.set('none')\n  }\n\n  reset() {\n    this.set()\n  }\n\n  setCrossHair() {\n    this.set('crosshair')\n  }\n\n  // Set to a movable state in a certain direction\n  setResize(direction: string) {\n    let type = ''\n    switch (direction) {\n      case DRAG_NODE_PARTS.BODY:\n        type = 'move'\n        break\n      case DRAG_NODE_PARTS.ROTATE:\n        type = 'grab'\n        break\n      case DRAG_NODE_PARTS.TOP_LEFT_BUTTON:\n        type = 'nw-resize'\n        break\n      case DRAG_NODE_PARTS.TOP_RIGHT_BUTTON:\n        type = 'ne-resize'\n        break\n      case DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON:\n        type = 'se-resize'\n        break\n      case DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON:\n        type = 'sw-resize'\n        break\n      default:\n        break\n    }\n    this.set(type)\n  }\n}\n","import EventEmitter from 'eventemitter3'\n\nimport { getTowCoordinateDistance } from '../common/utils'\nimport { AppObject } from '../types'\n\nexport default class Event extends EventEmitter {\n  public app: AppObject\n\n  public calculate: any\n\n  public lastMousePos: { x: number; y: number }\n\n  public mouseDistance: number\n\n  public lastMouseTime: number\n\n  public mouseDuration: number\n\n  public mouseSpeed: number\n\n  public isMousedown: boolean\n\n  public mousedownPos: {\n    originClientY: number\n    x: number\n    y: number\n    unGridClientX: number\n    unGridClientY: number\n    originClientX: number\n  }\n\n  public mouseOffset: {\n    originX: number\n    originY: number\n    x: number\n    y: number\n  }\n\n  constructor(app: AppObject) {\n    super()\n    this.app = app\n    this.calculate = app.calculate\n\n    // Record the mouse position at the previous moment\n    this.lastMousePos = {\n      x: 0,\n      y: 0\n    }\n\n    // Distance of mouse movement in the previous instant\n    this.mouseDistance = 0\n\n    // Record the time of the previous moment\n    this.lastMouseTime = Date.now()\n\n    // The moment before\n    this.mouseDuration = 0\n\n    // Mouse movement speed in the previous instant\n    this.mouseSpeed = 0\n\n    // Is the mouse pressed\n    this.isMousedown = false\n\n    // Mouse position when pressed\n    this.mousedownPos = {\n      x: 0,\n      y: 0,\n      unGridClientX: 0,\n      unGridClientY: 0,\n      originClientX: 0,\n      originClientY: 0\n    }\n\n    // The difference between the current position of the mouse and the position when it is pressed\n    this.mouseOffset = {\n      x: 0,\n      y: 0,\n      originX: 0,\n      originY: 0\n    }\n\n    this.onMousedown = this.onMousedown.bind(this)\n    this.onMousemove = this.onMousemove.bind(this)\n    this.onMouseup = this.onMouseup.bind(this)\n    this.onDblclick = this.onDblclick.bind(this)\n    this.onMousewheel = this.onMousewheel.bind(this)\n    this.onKeydown = this.onKeydown.bind(this)\n    this.onKeyup = this.onKeyup.bind(this)\n    this.onContextmenu = this.onContextmenu.bind(this)\n    this.bindEvent()\n  }\n\n  onMouseup(e: any) {\n    e = this.transformEvent(e)\n    this.isMousedown = false\n    this.mousedownPos.x = 0\n    this.mousedownPos.y = 0\n    this.emit('mouseup', e, this)\n  }\n\n  onDblclick(e: any) {\n    e = this.transformEvent(e)\n    this.emit('dblclick', e, this)\n  }\n\n  onMousewheel(e: any) {\n    e = this.transformEvent(e)\n    this.emit('mousewheel', e.originEvent.wheelDelta < 0 ? 'down' : 'up')\n  }\n\n  onContextmenu(e: any) {\n    e.stopPropagation()\n    e.preventDefault()\n    e = this.transformEvent(e)\n    this.emit('contextmenu', e, this)\n  }\n\n  onKeydown(e: any) {\n    this.emit('keydown', e, this)\n  }\n\n  onKeyup(e: any) {\n    this.emit('keyup', e, this)\n  }\n\n  onMousedown(e: any) {\n    e = this.transformEvent(e)\n    this.isMousedown = true\n    this.mousedownPos.x = e.clientX\n    this.mousedownPos.y = e.clientY\n    this.mousedownPos.unGridClientX = e.unGridClientX\n    this.mousedownPos.unGridClientY = e.unGridClientY\n    this.mousedownPos.originClientX = e.originEvent.clientX\n    this.mousedownPos.originClientY = e.originEvent.clientY\n    this.emit('mousedown', e, this)\n  }\n\n  onMousemove(e: any) {\n    e = this.transformEvent(e)\n    const x = e.clientX\n    const y = e.clientY\n    if (this.isMousedown) {\n      this.mouseOffset.x = x - this.mousedownPos.x\n      this.mouseOffset.y = y - this.mousedownPos.y\n      this.mouseOffset.originX =\n        e.originEvent.clientX - this.mousedownPos.originClientX\n      this.mouseOffset.originY =\n        e.originEvent.clientY - this.mousedownPos.originClientY\n    }\n    const curTime = Date.now()\n    this.mouseDuration = curTime - this.lastMouseTime\n    this.mouseDistance = getTowCoordinateDistance(\n      x,\n      y,\n      this.lastMousePos.x,\n      this.lastMousePos.y\n    )\n    this.mouseSpeed = this.mouseDistance / this.mouseDuration\n    this.emit('mousemove', e, this)\n    this.lastMouseTime = curTime\n    this.lastMousePos.x = x\n    this.lastMousePos.y = y\n  }\n\n  // events into coordinates, and adsorption if grid is turned on\n  transformEvent(e: { clientX: any; clientY: any }) {\n    const { calculate } = this.app\n    const wp = calculate.windowToContainer(e.clientX, e.clientY)\n    let { x, y } = calculate.reverseScale(wp.x, wp.y)\n    x = calculate.addScrollX(x)\n    y = calculate.addScrollY(y)\n    const unGridClientX = x\n    const unGridClientY = y\n    const gp = calculate.gridAdsorbent(x, y)\n    return {\n      originEvent: e,\n      unGridClientX,\n      unGridClientY,\n      clientX: gp.x,\n      clientY: gp.y\n    }\n  }\n\n  bindEvent() {\n    this.app.mountEL.addEventListener('mousedown', this.onMousedown)\n    this.app.mountEL.addEventListener('mousemove', this.onMousemove)\n    this.app.mountEL.addEventListener('mouseup', this.onMouseup)\n    this.app.mountEL.addEventListener('dblclick', this.onDblclick)\n    this.app.mountEL.addEventListener('mousewheel', this.onMousewheel)\n    this.app.mountEL.addEventListener('contextmenu', this.onContextmenu)\n    window.addEventListener('keydown', this.onKeydown)\n    window.addEventListener('keyup', this.onKeyup)\n  }\n\n  unbindEvent() {\n    this.app.mountEL.removeEventListener('mousedown', this.onMousedown)\n    this.app.mountEL.removeEventListener('mousemove', this.onMousemove)\n    this.app.mountEL.removeEventListener('mouseup', this.onMouseup)\n    this.app.mountEL.removeEventListener('dblclick', this.onDblclick)\n    this.app.mountEL.removeEventListener('mousewheel', this.onMousewheel)\n    this.app.mountEL.removeEventListener('contextmenu', this.onContextmenu)\n    window.removeEventListener('keydown', this.onKeydown)\n    window.removeEventListener('keyup', this.onKeyup)\n  }\n}\n","import { createCanvas, getMultiplexNodeRectInfo } from '../common/utils'\nimport { AppObject, Ctx, Node, NodeArray } from '../types'\nimport Background from './Background'\n\nexport default class Export {\n  public app: AppObject\n\n  public openPreview: boolean\n\n  public saveState: {\n    width: number\n    scale: number\n    scrollY: number\n    scrollX: number\n    height: number\n    ctx?: Ctx\n  }\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    this.openPreview = false\n\n    this.saveState = {\n      scale: 0,\n      scrollX: 0,\n      scrollY: 0,\n      width: 0,\n      height: 0\n    }\n  }\n\n  // Export as json data\n  exportJson() {\n    return this.app.getData()\n  }\n\n  // Draw all graphic objects\n  render(ctx: Ctx, onlySelected: boolean) {\n    ctx.save()\n    this.getNodeList(onlySelected).forEach((node: Node) => {\n      if (node.noRender) {\n        return\n      }\n      const cacheActive = node.isActive\n      const cacheSelected = node.isSelected\n      node.isActive = false\n      node.isSelected = false\n      node.render()\n      node.isActive = cacheActive\n      node.isSelected = cacheSelected\n    })\n    ctx.restore()\n  }\n\n  // Save the current state data of the app class\n  saveAppState() {\n    const { width, height, state, ctx } = this.app\n    this.saveState.width = width\n    this.saveState.height = height\n    if (state.scale) {\n      this.saveState.scale = state.scale\n    }\n    if (state.scrollX) {\n      this.saveState.scrollX = state.scrollX\n    }\n    if (state.scrollY) {\n      this.saveState.scrollY = state.scrollY\n    }\n    this.saveState.ctx = ctx\n  }\n\n  // Export as image\n  exportImage({\n    type = 'image/png',\n    renderBg = true,\n    useBlob = false,\n    paddingX = 10,\n    paddingY = 10,\n    onlySelected = true\n  } = {}) {\n    const { minX, maxX, minY, maxY } = getMultiplexNodeRectInfo(\n      this.getNodeList(onlySelected)\n    )\n    const width = maxX - minX + paddingX * 2\n    const height = maxY - minY + paddingY * 2\n    // Creating an export canvas\n    const { canvas, ctx } = createCanvas(width, height, {\n      noStyle: true,\n      noTranslate: true\n    })\n    if (!ctx) {\n      // eslint-disable-next-line no-console\n      console.error('Create Export Canvas Error')\n      return ''\n    }\n    this.show(canvas)\n    this.saveAppState()\n    this.changeAppState(minX - paddingX, minY - paddingY, ctx)\n    // Painting background colours\n    if (renderBg && this.app.state.backgroundColor && ctx) {\n      Background.canvasAddBackgroundColor(\n        ctx,\n        width,\n        height,\n        this.app.state.backgroundColor\n      )\n    }\n    // Drawing graphic objects to exported canvas\n    this.render(ctx, onlySelected)\n    this.recoveryAppState()\n\n    if (useBlob) {\n      return new Promise((resolve, reject) => {\n        canvas.toBlob((blob) => {\n          if (blob) {\n            resolve(blob)\n          } else {\n            reject()\n          }\n        }, type)\n      })\n    }\n    return canvas.toDataURL(type)\n  }\n\n  show(canvas: HTMLCanvasElement) {\n    if (this.openPreview) {\n      canvas.style.cssText = `position: absolute;left: 0;top: 0;background-color: #FFFFFF;`\n      document.body.appendChild(canvas)\n    }\n  }\n\n  // Recovery of app class status data\n  recoveryAppState() {\n    const { width, height, scale, scrollX, scrollY, ctx } = this.saveState\n    this.app.state.scale = scale\n    this.app.state.scrollX = scrollX\n    this.app.state.scrollY = scrollY\n    this.app.width = width\n    this.app.height = height\n    if (ctx) {\n      this.app.ctx = ctx\n    }\n  }\n\n  // Temporary modification of app class status data\n  changeAppState(minX: number, minY: number, ctx: Ctx) {\n    this.app.ctx = ctx\n    this.app.width = minX * 2\n    this.app.height = minY * 2\n    this.app.state.scale = 1\n    this.app.state.scrollX = 0\n    this.app.state.scrollY = 0\n  }\n\n  // Get the graphic object to be exported\n  getNodeList(onlySelected = true) {\n    // Exporting all graphic objects\n    if (!onlySelected) {\n      return this.app.nodes.nodeList\n    }\n    // Export only active or selected graphic objects\n    let selectedNodes: NodeArray = []\n    if (this.app.nodes.activeNode) {\n      selectedNodes.push(this.app.nodes.activeNode)\n    } else if (this.app.selection.hasSelectionNodes()) {\n      selectedNodes = this.app.selection.getSelectionNodes()\n    }\n    return this.app.nodes.nodeList.filter((node: Node) =>\n      selectedNodes.includes(node)\n    )\n  }\n}\n","import { createCanvas } from '../common/utils'\nimport { Ctx } from '../types'\n\nexport default class Canvas {\n  public width: number\n\n  public height: number\n\n  public el: HTMLCanvasElement | undefined\n\n  public ctx: Ctx | undefined\n\n  constructor(\n    width: number,\n    height: number,\n    opt?: { noStyle?: boolean; noTranslate?: boolean; className?: string }\n  ) {\n    this.width = width\n    this.height = height\n    const { canvas, ctx } = createCanvas(width, height, opt)\n    if (ctx) {\n      this.el = canvas\n      this.ctx = ctx\n    }\n  }\n\n  clearCanvas() {\n    const { width, height } = this\n    this.ctx?.clearRect(-width / 2, -height / 2, width, height)\n  }\n}\n","import Canvas from '../support/Canvas'\nimport { AppObject, Ctx } from '../types'\n\nexport default class Grid {\n  public app: AppObject\n\n  public canvas: any\n\n  public ctx: Ctx | null\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    this.canvas = null\n\n    this.ctx = null\n\n    this.init()\n\n    this.app.on('zoomChange', this.renderGrid, this)\n\n    this.app.on('scrollChange', this.renderGrid, this)\n  }\n\n  // plot vertical lines\n  renderVerticalLines() {\n    const { calculate, width, state } = this.app\n    const { gridConfig, scale } = state\n    let maxRight = 0\n    if (\n      typeof gridConfig === 'undefined' ||\n      typeof scale === 'undefined' ||\n      typeof gridConfig.size === 'undefined'\n    ) {\n      // eslint-disable-next-line no-console\n      console.error('gridConfig or scale or gridConfig.size is undefined')\n      return\n    }\n    for (let i = -width / 2; i < width / 2; i += gridConfig.size) {\n      this.plotVerticalLine(i)\n      maxRight = i\n    }\n    // Draws the line beyond the left side when rolling to the right\n    for (\n      let i = -width / 2 - gridConfig.size;\n      i > -calculate.subScrollX(width / scale / 2);\n      i -= gridConfig.size\n    ) {\n      this.plotVerticalLine(i)\n    }\n    // Draws the line beyond the right when rolling to the left\n    for (\n      let i = maxRight + gridConfig.size;\n      i < calculate.addScrollX(width / scale / 2);\n      i += gridConfig.size\n    ) {\n      this.plotVerticalLine(i)\n    }\n  }\n\n  // Rendering of horizontal lines\n  renderHorizontalLines() {\n    const { calculate, height, state } = this.app\n    const { gridConfig, scale } = state\n    if (\n      typeof gridConfig === 'undefined' ||\n      typeof scale === 'undefined' ||\n      typeof gridConfig.size === 'undefined'\n    ) {\n      return\n    }\n    let maxBottom = 0\n    for (let i = -height / 2; i < height / 2; i += gridConfig.size) {\n      this.plotHorizontalLine(i)\n      maxBottom = i\n    }\n    // Draws the line beyond the top when rolling downwards\n    for (\n      let i = -height / 2 - gridConfig.size;\n      i > -calculate.subScrollY(height / scale / 2);\n      i -= gridConfig.size\n    ) {\n      this.plotHorizontalLine(i)\n    }\n    // Draws the line beyond the bottom when rolling upwards\n    for (\n      let i = maxBottom + gridConfig.size;\n      i < calculate.addScrollY(height / scale / 2);\n      i += gridConfig.size\n    ) {\n      this.plotHorizontalLine(i)\n    }\n  }\n\n  renderGrid() {\n    this.canvas.clearCanvas()\n    const { gridConfig, scale, showGrid } = this.app.state\n    if (!showGrid) {\n      return\n    }\n    if (\n      this.ctx &&\n      scale &&\n      gridConfig &&\n      this.ctx.strokeStyle &&\n      this.ctx.lineWidth\n    ) {\n      this.ctx.save()\n      this.ctx.scale(scale, scale)\n      // @ts-ignore\n      this.ctx.strokeStyle = gridConfig.strokeStyle\n      // @ts-ignore\n      this.ctx.lineWidth = gridConfig.lineWidth\n    }\n\n    this.renderVerticalLines()\n\n    this.renderHorizontalLines()\n\n    this.ctx?.restore()\n  }\n\n  // Drawing horizontal lines\n  plotHorizontalLine(i: number) {\n    const { calculate, width, state } = this.app\n    if (typeof state.scale === 'undefined') {\n      return\n    }\n    const _i = calculate.subScrollY(i)\n    this.ctx?.beginPath()\n    this.ctx?.moveTo(-width / state.scale / 2, _i)\n    this.ctx?.lineTo(width / state.scale / 2, _i)\n    this.ctx?.stroke()\n  }\n\n  // plot the reset line\n  plotVerticalLine(i: number) {\n    const { calculate, height, state } = this.app\n    if (typeof state.scale === 'undefined') {\n      return\n    }\n    const _i = calculate.subScrollX(i)\n    this.ctx?.beginPath()\n    this.ctx?.moveTo(_i, -height / state.scale / 2)\n    this.ctx?.lineTo(_i, height / state.scale / 2)\n    this.ctx?.stroke()\n  }\n\n  showGrid() {\n    this.app.updateState({\n      showGrid: true\n    } as any)\n    this.renderGrid()\n  }\n\n  hideGrid() {\n    this.app.updateState({\n      showGrid: false\n    } as any)\n    this.canvas.clearCanvas()\n  }\n\n  updateGrid(config = {}) {\n    this.app.updateState({\n      gridConfig: {\n        ...this.app.state.gridConfig,\n        ...config\n      }\n    } as any)\n    if (this.app.state.showGrid) {\n      this.hideGrid()\n      this.showGrid()\n    }\n  }\n\n  init() {\n    if (this.canvas) {\n      this.app.mountEL.removeChild(this.canvas.el)\n    }\n    const { width, height } = this.app\n    this.canvas = new Canvas(width, height, {\n      className: 'grid'\n    })\n    this.ctx = this.canvas.ctx\n    this.app.mountEL.insertBefore(this.canvas.el, this.app.mountEL.children[0])\n  }\n}\n","import { deepCopy } from '../common/utils'\nimport { AppObject, LocalData } from '../types'\n\nexport default class History {\n  public app: AppObject\n\n  public historyStack: Array<LocalData>\n\n  public length: number\n\n  public index: number\n\n  public fixIndex: number\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    this.historyStack = []\n\n    this.length = 0\n\n    this.index = -1\n\n    this.fixIndex = -1\n  }\n\n  emitChange() {\n    this.app.emit('shuttle', this.index, this.length)\n  }\n\n  now() {\n    return this.historyStack[this.length - 1]\n  }\n\n  clear() {\n    this.index = -1\n    this.length = 0\n    this.historyStack = []\n    this.emitChange()\n  }\n\n  add(data: LocalData) {\n    const prev = this.length > 0 ? this.historyStack[this.length - 1] : null\n    const copyData = deepCopy(data)\n    if (copyData === prev) {\n      return\n    }\n    this.historyStack.push(copyData)\n    this.length += 1\n    this.index = this.length - 1\n    this.emitChange()\n  }\n\n  shuttle() {\n    const oldData = this.app.getData()\n    const data = this.historyStack[this.index]\n    // Avoid interference and enforce correction\n    this.fixIndex = this.index\n    const fixLength = this.length\n    this.app\n      .setData(data, true)\n      .then(() => {\n        this.index = this.fixIndex\n        this.length = fixLength\n        this.emitChange()\n        this.app.emit('change', data)\n        this.app.emitDiffNodesChange(oldData, data)\n        this.app.emitDiffStateChange(oldData, data)\n      })\n      .catch(() => {\n        // eslint-disable-next-line no-console\n        console.error('History shuttle setData error')\n      })\n  }\n\n  undo() {\n    if (this.index <= 0) {\n      return\n    }\n    this.index -= 1\n    this.shuttle()\n  }\n\n  redo() {\n    if (this.index >= this.length - 1) {\n      return\n    }\n    this.index += 1\n    this.shuttle()\n  }\n}\n","import EventEmitter from 'eventemitter3'\n\nimport { AppObject } from '../types'\n\nexport default class ImageEdit extends EventEmitter {\n  public app: AppObject\n\n  public el: HTMLInputElement | null\n\n  isReady: boolean\n\n  public previewEl: HTMLDivElement | null\n\n  public imageData: {\n    url: string\n    width: number\n    height: number\n    ratio: number\n    imageObj: HTMLInputElement\n  } | null\n\n  public maxWidth: number\n\n  public maxHeight: number\n\n  public maxRatio: number\n\n  constructor(app: AppObject) {\n    super()\n\n    this.app = app\n\n    this.el = null\n\n    this.isReady = false\n\n    this.previewEl = null\n\n    this.imageData = null\n\n    this.maxWidth = 750\n\n    this.maxHeight = 450\n\n    this.maxRatio = this.maxWidth / this.maxHeight\n\n    this.onImageSelectChange = this.onImageSelectChange.bind(this)\n  }\n\n  updatePreviewElPos(x: number, y: number) {\n    const width = 100\n    if (!this.imageData) {\n      // eslint-disable-next-line no-console\n      console.error('imageData is null')\n      return\n    }\n    const height = width / this.imageData.ratio\n    if (!this.previewEl) {\n      this.previewEl = document.createElement('div')\n      this.previewEl.style.position = 'fixed'\n      this.previewEl.style.width = `${width}px`\n      this.previewEl.style.height = `${height}px`\n      this.previewEl.style.backgroundImage = `url('${this.imageData.url}')`\n      this.previewEl.style.backgroundSize = 'cover'\n      this.previewEl.style.pointerEvents = 'none'\n      document.body.appendChild(this.previewEl)\n    }\n    const tp = this.app.calculate.mountELToWindow(x, y)\n    this.previewEl.style.left = `${tp.x - width / 2}px`\n    this.previewEl.style.top = `${tp.y - height / 2}px`\n  }\n\n  reset() {\n    if (this.el) {\n      this.el.value = ''\n    }\n    this.isReady = false\n    if (this.previewEl) {\n      document.body.removeChild(this.previewEl)\n    }\n    this.previewEl = null\n    this.imageData = null\n  }\n\n  async getImageUrl(file: Blob) {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onloadend = () => {\n        resolve(reader.result)\n      }\n      reader.onerror = () => {\n        reject()\n      }\n      reader.readAsDataURL(file)\n    })\n  }\n\n  async getImageSize(url: string): Promise<{\n    imageObj: HTMLInputElement\n    size: {\n      width: number\n      height: number\n    }\n    ratio: number\n  }> {\n    return new Promise((resolve, reject) => {\n      const img = new Image()\n      img.setAttribute('crossOrigin', 'anonymous')\n      img.onload = () => {\n        let { width } = img\n        let { height } = img\n        const ratio = img.width / img.height\n        if (img.width > this.maxWidth || img.height > this.maxHeight) {\n          if (ratio > this.maxRatio) {\n            width = this.maxWidth\n            height = this.maxWidth / ratio\n          } else {\n            height = this.maxHeight\n            width = this.maxHeight * ratio\n          }\n        }\n        resolve({\n          imageObj: img,\n          size: {\n            width,\n            height\n          },\n          ratio\n        } as any)\n      }\n      img.onerror = () => {\n        reject()\n      }\n      img.src = url\n    })\n  }\n\n  async onImageSelectChange(e: any) {\n    const url = await this.getImageUrl(e.target.files[0])\n    if (typeof url !== 'string') {\n      // eslint-disable-next-line no-console\n      console.error('url is not string')\n      return\n    }\n    const { imageObj, size, ratio } = await this.getImageSize(url)\n    this.isReady = true\n    this.imageData = {\n      url,\n      ...size,\n      ratio,\n      imageObj\n    }\n    this.emit('imageSelectChange', this.imageData)\n  }\n\n  selectImage() {\n    if (!this.el) {\n      this.el = document.createElement('input')\n      this.el.style.position = 'fixed'\n      this.el.style.left = '-9999999px'\n      this.el.type = 'file'\n      this.el.accept = 'image/*'\n      this.el.addEventListener('change', this.onImageSelectChange)\n      document.body.appendChild(this.el)\n    }\n    this.el.click()\n  }\n}\n","import { keyPosit } from '../common/constants'\nimport { AppObject, KeyPosit } from '../types'\n\nexport default class KeyCommand {\n  public app: AppObject\n\n  public keyPosit: KeyPosit\n\n  public shortcutMap: any\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    this.keyPosit = keyPosit\n\n    this.shortcutMap = {}\n\n    this.bindEvent()\n  }\n\n  // Get the array of key values corresponding to the shortcut keys\n  getKeyCodeArr(key: string) {\n    key = key.replace(/\\+\\+/, '+add')\n    const keyArr = key\n      .split(/\\s*\\+\\s*/)\n      .map((item) => (item === 'add' ? '+' : item))\n    const arr: any[] = []\n    keyArr.forEach((item) => {\n      // @ts-ignore\n      arr.push(keyPosit[item])\n    })\n    return arr\n  }\n\n  // Get an array of key values in an event object\n  getOriginEventCodeArr(e: {\n    stopPropagation?: () => void\n    preventDefault?: () => void\n    ctrlKey?: any\n    metaKey?: any\n    altKey?: any\n    shiftKey?: any\n    keyCode?: any\n  }) {\n    const arr = []\n    if (e.ctrlKey || e.metaKey) {\n      arr.push(keyPosit.Control)\n    }\n    if (e.altKey) {\n      arr.push(keyPosit.Alt)\n    }\n    if (e.shiftKey) {\n      arr.push(keyPosit.Shift)\n    }\n    if (!arr.includes(e.keyCode)) {\n      arr.push(e.keyCode)\n    }\n    return arr\n  }\n\n  // Check if the key value matches\n  checkKey(\n    e: { stopPropagation: () => void; preventDefault: () => void },\n    key: string\n  ) {\n    const o = this.getOriginEventCodeArr(e)\n    const k = this.getKeyCodeArr(key)\n    if (o.length !== k.length) {\n      return false\n    }\n    for (let i = 0; i < o.length; i += 1) {\n      const index = k.findIndex((item) => item === o[i])\n      if (index === -1) {\n        return false\n      }\n      k.splice(index, 1)\n    }\n    return true\n  }\n\n  onKeydown(e: { stopPropagation: () => void; preventDefault: () => void }) {\n    Object.keys(this.shortcutMap).forEach((key) => {\n      if (this.checkKey(e, key)) {\n        e.stopPropagation()\n        e.preventDefault()\n        this.shortcutMap[key].forEach(\n          (f: { fn: { call: (arg0: any) => void }; ctx: any }) => {\n            f.fn.call(f.ctx)\n          }\n        )\n      }\n    })\n  }\n\n  // Add shortcut command\n  addShortcut(key: string, fn: any, ctx?: any) {\n    key.split(/\\s*\\|\\s*/).forEach((item) => {\n      if (this.shortcutMap[item]) {\n        this.shortcutMap[item].push({\n          fn,\n          ctx\n        })\n      } else {\n        this.shortcutMap[item] = [\n          {\n            fn,\n            ctx\n          }\n        ]\n      }\n    })\n  }\n\n  // Remove shortcut command\n  removeShortcut(key: string, fn: any) {\n    key.split(/\\s*\\|\\s*/).forEach((item) => {\n      if (this.shortcutMap[item]) {\n        if (fn) {\n          const index = this.shortcutMap[item].findIndex(\n            (f: { fn: any }) => f.fn === fn\n          )\n          if (index !== -1) {\n            this.shortcutMap[item].splice(index, 1)\n          }\n        } else {\n          this.shortcutMap[item] = []\n          delete this.shortcutMap[item]\n        }\n      }\n    })\n  }\n\n  bindEvent() {\n    this.app.event.on('keydown', this.onKeydown, this)\n  }\n\n  unBindEvent() {\n    this.app.event.off('keydown', this.onKeydown)\n  }\n}\n","import { Node } from '../../types'\nimport { CLICK_DISTANCE } from '../constants'\nimport {\n  checkCoordinateIsInRectangle,\n  checkIsAtSegment,\n  getTowCoordinateDistance\n} from './index'\n\ntype Segments = Array<[x1: number, y1: number, x2: number, y2: number]>\ntype Rp = { xs?: number; ys?: number; x: number; y: number }\n\n// Detects if a click is inside a rectangle\nexport const checkIsAtRectangleInner = (node: any, rp: Rp) =>\n  checkCoordinateIsInRectangle(rp.x, rp.y, node as Node) ? node : null\n\n// Calculate the radius of the circle from the width and height\nexport const getCircleRadius = (width: number, height: number) =>\n  Math.min(Math.abs(width), Math.abs(height)) / 2\n\n// Detects if a click is made on the fold\nexport const checkIsAtMultiplexSegment = (segments: Segments, rp: Rp) => {\n  let res = false\n  segments.forEach((seg) => {\n    if (res) return\n    if (checkIsAtSegment(rp.x, rp.y, ...seg, CLICK_DISTANCE)) {\n      res = true\n    }\n  })\n  return res\n}\n\n// Calculate the radius of the circle from the width and height\nexport const checkIsAtCircleEdge = (node: any, rp: Rp) => {\n  const { width, height, x, y } = node as Node\n  const radius = getCircleRadius(width, height)\n  const dis = getTowCoordinateDistance(rp.x, rp.y, x + radius, y + radius)\n  const onCircle =\n    dis >= radius - CLICK_DISTANCE && dis <= radius + CLICK_DISTANCE\n  return onCircle ? node : null\n}\n\n// Detects if you click on the edge of a rectangle\nexport const checkIsAtRectangleEdge = (node: any, rp: Rp) => {\n  const { x, y, width, height } = node as Node\n  const segments: Segments = [\n    [x, y, x + width, y],\n    [x + width, y, x + width, y + height],\n    [x + width, y + height, x, y + height],\n    [x, y + height, x, y]\n  ]\n  return checkIsAtMultiplexSegment(segments, rp) ? node : null\n}\n\n// Detects if a triangle edge is clicked on\nexport const checkIsAtTriangleEdge = (node: Node, rp: Rp) => {\n  const { x, y, width, height } = node\n  const segments = [\n    [x + width / 2, y, x + width, y + height],\n    [x + width, y + height, x, y + height],\n    [x, y + height, x + width / 2, y]\n  ]\n  return checkIsAtMultiplexSegment(segments as Segments, rp) ? node : null\n}\n\n// Detects if a diamond edge is clicked on\nexport const checkIsAtDiamondEdge = (node: any, rp: Rp) => {\n  const { x, y, width, height } = node as Node\n  const segments = [\n    [x + width / 2, y, x + width, y + height / 2],\n    [x + width, y + height / 2, x + width / 2, y + height],\n    [x + width / 2, y + height, x, y + height / 2],\n    [x, y + height / 2, x + width / 2, y]\n  ]\n  return checkIsAtMultiplexSegment(segments as Segments, rp) ? node : null\n}\n\n// Detects if you click on the edge of the arrow\nexport const checkIsAtArrowEdge = (node: any, rp: Rp) => {\n  const { coordinateArr } = node as Node\n  if (typeof coordinateArr === 'undefined') {\n    return null\n  }\n  const x = coordinateArr[0][0]\n  const y = coordinateArr[0][1]\n  const tx = coordinateArr[coordinateArr.length - 1][0]\n  const ty = coordinateArr[coordinateArr.length - 1][1]\n  const segments = [[x, y, tx, ty]]\n  return checkIsAtMultiplexSegment(segments as Segments, rp) ? node : null\n}\n\n// Detects if a click is made on the edge of a free line segment\nexport const checkIsAtArbitraryPlotLineEdge = (node: Node, rp: Rp) => {\n  let res: Node | null = null\n  if (typeof node.coordinateArr === 'undefined') {\n    return null\n  }\n  node.coordinateArr.forEach((coordinate) => {\n    if (res) return\n    const dis = getTowCoordinateDistance(\n      rp.x,\n      rp.y,\n      coordinate[0],\n      coordinate[1]\n    )\n    if (dis <= CLICK_DISTANCE) {\n      res = node\n    }\n  })\n  return res\n}\n\n// Detects if a click is made on the edge of a line segment\nexport const checkIsAtLineEdge = (node: Node, rp: Rp) => {\n  const segments = []\n  if (typeof node.coordinateArr === 'undefined') {\n    return null\n  }\n  const len = node.coordinateArr.length\n  const arr = node.coordinateArr\n  for (let i = 0; i < len - 1; i += 1) {\n    segments.push([...arr[i], ...arr[i + 1]])\n  }\n  return checkIsAtMultiplexSegment(segments as Segments, rp) ? node : null\n}\n","import EventEmitter from 'eventemitter3'\n\nimport {\n  createNodeKey,\n  degToRad,\n  getNodeFourCorners,\n  getRotatedCoordinate\n} from '../common/utils'\nimport { AppObject } from '../types'\n\nexport default class BaseNode extends EventEmitter {\n  public app: AppObject\n\n  public type: string\n\n  public key: number\n\n  public isCreate: boolean\n\n  public isActive: boolean\n\n  public isSelected: boolean\n\n  public startX: number\n\n  public startY: number\n\n  x: number\n\n  y: number\n\n  width: number\n\n  height: number\n\n  public startRotate: number\n\n  public rotate: number\n\n  public noRender: boolean\n\n  public style: any\n\n  dragNode: any\n\n  constructor(options: any, app: AppObject) {\n    super()\n    this.app = app\n    // Type\n    this.type = options.type || ''\n    // key\n    this.key = createNodeKey()\n    // Is it being created\n    this.isCreate = true\n    // Activated or not\n    this.isActive = true\n    // Whether selected by multiple choice\n    this.isSelected = false\n    // Record initial position for use when dragging\n    this.startX = 0\n    this.startY = 0\n    // Real-time position, which is the coordinate of the upper left corner of the graphic object\n    this.x = options.x || 0\n    this.y = options.y || 0\n    // Width and height\n    this.width = options.width || 0\n    this.height = options.height || 0\n    // Records the initial angle for use when rotating\n    this.startRotate = 0\n    // Angle\n    this.rotate = options.rotate || 0\n    // Does not need to be rendered\n    this.noRender = false\n    // style\n    this.style = {\n      strokeStyle: this.app.state.defaultColor,\n      fillStyle: 'transparent',\n      lineWidth: 2,\n      lineDash: 0,\n      globalAlpha: 1,\n      ...(options.style || {})\n    }\n    // Example of dragging and dropping a graphic object\n    this.dragNode = undefined\n  }\n\n  // Detects if a graphic object has been hit\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  isClick(x: number, y: number) {\n    throw new Error('Subclasses need to implement this method!')\n  }\n\n  // Offsetting the angle of a graphic object\n  offsetRotate(or: number) {\n    this.updateRotate(this.startRotate + or)\n    return this\n  }\n\n  // Setting the drawing style\n  setStyle(style = {}) {\n    const _style = style as any\n    Object.keys(_style).forEach((key) => {\n      if (key === 'lineDash') {\n        if (_style.lineDash > 0) {\n          this.app.ctx.setLineDash([_style.lineDash])\n        }\n      } else if (\n        _style[key] !== undefined &&\n        _style[key] !== '' &&\n        _style[key] !== null\n      ) {\n        // @ts-ignore\n        this.app.ctx[key] = _style[key]\n      }\n    })\n    return this\n  }\n\n  // Public rendering operations\n  warpRender(renderFn: any) {\n    const { x, y, width, height, rotate, style } = this\n    const { x: tx, y: ty } = this.app.calculate.transform(x, y)\n    const halfWidth = width / 2\n    const halfHeight = height / 2\n    const cx = tx + halfWidth\n    const cy = ty + halfHeight\n    this.app.ctx.save()\n    this.app.ctx.translate(cx, cy)\n    this.app.ctx.rotate(degToRad(rotate))\n    this.setStyle(style)\n    renderFn({\n      halfWidth,\n      halfHeight,\n      tx,\n      ty,\n      cx,\n      cy\n    })\n    this.app.ctx.restore()\n    return this\n  }\n\n  // Save the initial state of the graphic object\n  saveState() {\n    const { rotate, x, y } = this\n    this.startRotate = rotate\n    this.startX = x\n    this.startY = y\n    return this\n  }\n\n  // Moving graphic objects\n  move(ox: number, oy: number) {\n    const { startX, startY } = this\n    this.x = startX + ox\n    this.y = startY + oy\n    this.emit('nodePositionChange', this.x, this.y)\n    return this\n  }\n\n  // Updating the angle of a graphic object\n  updateRotate(rotate: number) {\n    rotate %= 360\n    if (rotate < 0) {\n      rotate = 360 + rotate\n    }\n    this.rotate = rotate\n    this.app.emitNodeRotateChange(this.rotate)\n  }\n\n  // Rotate the individual coordinates of a graphic object according to the specified centre coordinates\n  rotateByCenter(rotate: number, cx: number, cy: number) {\n    this.offsetRotate(rotate)\n    const np = getRotatedCoordinate(this.startX, this.startY, cx, cy, rotate)\n    this.updatePos(np.x, np.y)\n  }\n\n  // Start adjusting graphic objects\n  startResize(resizeType: string, e: any) {\n    this.dragNode.startResize(resizeType, e)\n    return this\n  }\n\n  // Ending the adjustment of graphic objects\n  endResize() {\n    this.dragNode.endResize()\n    return this\n  }\n\n  // Adjustment in graphic objects\n  resize(...args: any[]) {\n    this.dragNode.handleResizeNode(...args)\n    return this\n  }\n\n  // Get a list of the end coordinates of the graph after the rotation has been applied\n  getEndCoordinateList() {\n    return getNodeFourCorners(this as any)\n  }\n\n  // Update graphic object enclosures\n  updateRect(x: number, y: number, width: number, height: number) {\n    this.updatePos(x, y)\n    this.updateSize(width, height)\n    return this\n  }\n\n  // Update activation of graphic object sizes\n  updateSize(width: number, height: number) {\n    this.width = width\n    this.height = height\n    this.emit('nodeSizeChange', this.width, this.height)\n    return this\n  }\n\n  // Update coordinates of active graphic objects\n  updatePos(x: number, y: number) {\n    this.x = x\n    this.y = y\n    this.emit('nodePositionChange', this.x, this.y)\n    return this\n  }\n\n  // Serialisation\n  serialize() {\n    return {\n      type: this.type,\n      width: this.width,\n      height: this.height,\n      x: this.x,\n      y: this.y,\n      rotate: this.rotate,\n      style: {\n        ...this.style\n      }\n    }\n  }\n\n  // Rendering drag-and-drop graphic objects\n  renderDragNode() {\n    if (this.isActive && !this.isCreate) {\n      this.dragNode.showAll()\n      this.dragNode.render()\n    } else if (this.isSelected) {\n      // Selected by multiple choice\n      this.dragNode.onlyShowBody()\n      this.dragNode.render()\n    }\n  }\n\n  // Rendering methods, which need to be implemented\n  render() {\n    throw new Error('Subclasses need to implement this method')\n  }\n}\n","import {\n  deepCopy,\n  getBoundingRect,\n  getNodeCenterCoordinate,\n  getRotatedCoordinate\n} from '../common/utils'\nimport { AppObject } from '../types'\nimport BaseNode from './BaseNode'\n\nexport default class BaseMultiplexCoordinateNode extends BaseNode {\n  public startCoordinateArr: any[]\n\n  public coordinateArr: any\n\n  public startWidth: number | undefined\n\n  public startHeight: number | undefined\n\n  public fictitiousCoordinate: { x: number; y: number }\n\n  constructor(opts: any, app: AppObject) {\n    super(opts, app)\n    // Record initial coordinates when dragging\n    this.startCoordinateArr = []\n    // Coordinates\n    this.coordinateArr = opts.coordinateArr || []\n    // Record initial size for use when scaling\n    this.startWidth = 0\n    this.startHeight = 0\n    // The current live position of the mouse, used to display the virtual line from the last coordinate of the line segment to the current mouse when drawing\n    this.fictitiousCoordinate = {\n      x: 0,\n      y: 0\n    }\n  }\n\n  // Update graphic object enclosures\n  updateRect(x: number, y: number, width: number, height: number) {\n    const { startWidth, startHeight, startCoordinateArr } = this\n    if (\n      typeof startWidth === 'undefined' ||\n      typeof startHeight === 'undefined'\n    ) {\n      return this\n    }\n    const scaleX = width / startWidth\n    const scaleY = height / startHeight\n    this.coordinateArr = startCoordinateArr.map((coordinate) => {\n      const nx = coordinate[0] * scaleX\n      const ny = coordinate[1] * scaleY\n      return [nx, ny, ...coordinate.slice(2)]\n    })\n    const rect: any = getBoundingRect(this.coordinateArr)\n    const offsetX = rect.x - x\n    const offsetY = rect.y - y\n    this.coordinateArr = this.coordinateArr.map(\n      (coordinate: string | any[]) => [\n        coordinate[0] - offsetX,\n        coordinate[1] - offsetY,\n        ...coordinate.slice(2)\n      ]\n    )\n    this.updatePos(x, y)\n    this.updateSize(width, height)\n    return this\n  }\n\n  // Rotate the individual coordinates of a graphic object according to the specified centre coordinates\n  rotateByCenter(rotate: number, cx: number, cy: number) {\n    this.coordinateArr = this.startCoordinateArr.map((coordinate) => {\n      const np = getRotatedCoordinate(\n        coordinate[0],\n        coordinate[1],\n        cx,\n        cy,\n        rotate\n      )\n      return [np.x, np.y, ...coordinate.slice(2)]\n    })\n    this.updateMultiplexCoordinateBoundingRect()\n  }\n\n  // Serialisation\n  serialize() {\n    const base = super.serialize()\n    return {\n      ...base,\n      coordinateArr: [...this.coordinateArr]\n    }\n  }\n\n  // Get a list of the end coordinates of the graph after the rotation has been applied\n  getEndCoordinateList() {\n    return this.coordinateArr.map((coordinate: number[]) => {\n      const center = getNodeCenterCoordinate(this as any)\n      const np = getRotatedCoordinate(\n        coordinate[0],\n        coordinate[1],\n        center.x,\n        center.y,\n        this.rotate as number\n      )\n      return {\n        x: np.x,\n        y: np.y\n      }\n    })\n  }\n\n  // Adding coordinates, graphs with multiple coordinate data, e.g. line segments, free lines\n  addCoordinate(x: number, y: number, ...args: any[]) {\n    if (!Array.isArray(this.coordinateArr)) {\n      return undefined\n    }\n    this.coordinateArr.push([x, y, ...args])\n    return this\n  }\n\n  // Update of graphical object enclosures for graphs with multiple coordinate data\n  updateMultiplexCoordinateBoundingRect() {\n    const rect: any = getBoundingRect(this.coordinateArr)\n    this.x = rect.x\n    this.y = rect.y\n    this.width = rect.width\n    this.height = rect.height\n    return this\n  }\n\n  // Update virtual coordinates coordinates\n  updateFictitiousCoordinate(x: number, y: number) {\n    this.fictitiousCoordinate.x = x\n    this.fictitiousCoordinate.y = y\n  }\n\n  // Moving graphic objects\n  move(ox: number, oy: number) {\n    this.coordinateArr = this.startCoordinateArr.map((coordinate) => [\n      coordinate[0] + ox,\n      coordinate[1] + oy,\n      ...coordinate.slice(2)\n    ])\n    const { startX, startY } = this\n    if (startX && startY) {\n      this.x = startX + ox\n      this.y = startY + oy\n    }\n    return this\n  }\n\n  // Save the initial state of the graphic object\n  saveState() {\n    const { rotate, x, y, width, height, coordinateArr } = this\n    this.startRotate = rotate\n    this.startX = x\n    this.startY = y\n    this.startCoordinateArr = deepCopy(coordinateArr)\n    this.startWidth = width\n    this.startHeight = height\n    return this\n  }\n}\n","import {\n  degToRad,\n  getFontString,\n  radToDeg,\n  splitTextLines\n} from '../common/utils'\nimport { Ctx } from '../types'\n\n// Drawing public operations\nexport const plotWrap = (ctx: Ctx, fn: any, fill = false) => {\n  ctx.beginPath()\n  fn()\n  ctx.stroke()\n  if (fill) {\n    ctx.fill()\n  }\n}\n\n// Drawing circle\nexport const plotCircle = (\n  ctx: Ctx,\n  x: number,\n  y: number,\n  r: number,\n  fill = false\n) => {\n  plotWrap(\n    ctx,\n    () => {\n      ctx.arc(x, y, r, 0, 2 * Math.PI)\n    },\n    fill\n  )\n}\n\n// Drawing arrows\nexport const plotArrow = (ctx: Ctx, coordinateArr: any[]) => {\n  const x = coordinateArr[0][0]\n  const y = coordinateArr[0][1]\n  const tx = coordinateArr[coordinateArr.length - 1][0]\n  const ty = coordinateArr[coordinateArr.length - 1][1]\n  plotWrap(\n    ctx,\n    () => {\n      ctx.moveTo(x, y)\n      ctx.lineTo(tx, ty)\n    },\n    true\n  )\n  const l = 30\n  const deg = 30\n  const lineDeg = radToDeg(Math.atan2(ty - y, tx - x))\n  plotWrap(\n    ctx,\n    () => {\n      const plusDeg = deg - lineDeg\n      const _x = tx - l * Math.cos(degToRad(plusDeg))\n      const _y = ty + l * Math.sin(degToRad(plusDeg))\n      ctx.moveTo(_x, _y)\n      ctx.lineTo(tx, ty)\n    },\n    true\n  )\n  plotWrap(ctx, () => {\n    const plusDeg = 90 - lineDeg - deg\n    const _x = tx - l * Math.sin(degToRad(plusDeg))\n    const _y = ty - l * Math.cos(degToRad(plusDeg))\n    ctx.moveTo(_x, _y)\n    ctx.lineTo(tx, ty)\n  })\n}\n\n// Drawing rectangles\nexport const plotRect = (\n  ctx: Ctx,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  fill = false\n) => {\n  plotWrap(ctx, () => {\n    ctx.rect(x, y, width, height)\n    if (fill) {\n      ctx.fillRect(x, y, width, height)\n    }\n  })\n}\n\n// Drawing a diamond\nexport const plotDiamond = (\n  ctx: Ctx,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  fill = false\n) => {\n  plotWrap(\n    ctx,\n    () => {\n      ctx.moveTo(x + width / 2, y)\n      ctx.lineTo(x + width, y + height / 2)\n      ctx.lineTo(x + width / 2, y + height)\n      ctx.lineTo(x, y + height / 2)\n      ctx.closePath()\n    },\n    fill\n  )\n}\n\n// Convert the coordinates of the brush to the coordinates of the canvas\nconst transformArbitraryLineCoordinate = (\n  coordinate: string | any[],\n  opt: {\n    app: {\n      calculate: { transform: (arg0: any, arg1: any) => { x: any; y: any } }\n    }\n    cx: number\n    cy: number\n  }\n) => {\n  const { x, y } = opt.app.calculate.transform(coordinate[0], coordinate[1])\n  return [x - opt.cx, y - opt.cy, ...coordinate.slice(2)]\n}\n\n// Drawing line segments\nexport const plotLineSegment = (\n  ctx: Ctx,\n  mx: number,\n  my: number,\n  tx: number,\n  ty: number,\n  lineWidth = 0\n) => {\n  plotWrap(ctx, () => {\n    if (lineWidth > 0) {\n      ctx.lineWidth = lineWidth\n    }\n    ctx.moveTo(mx, my)\n    ctx.lineTo(tx, ty)\n    ctx.lineCap = 'round'\n    ctx.lineJoin = 'round'\n  })\n}\n\n// Drawing triangles\nexport const plotTriangle = (\n  ctx: Ctx,\n  x: number,\n  y: number,\n  width: number,\n  height: any,\n  fill = false\n) => {\n  plotWrap(\n    ctx,\n    () => {\n      ctx.moveTo(x + width / 2, y)\n      ctx.lineTo(x + width, y + height)\n      ctx.lineTo(x, y + height)\n      ctx.closePath()\n    },\n    fill\n  )\n}\n\n// Drawing free line segments (Also known as a paintbrush)\nexport const plotArbitraryLine = (\n  ctx: Ctx,\n  coordinates: string | any[],\n  opt: any\n) => {\n  for (let i = 0; i < coordinates.length - 1; i += 1) {\n    plotWrap(\n      ctx,\n      () => {\n        const coordinate = transformArbitraryLineCoordinate(coordinates[i], opt)\n        const nextCoordinate = transformArbitraryLineCoordinate(\n          coordinates[i + 1],\n          opt\n        )\n        plotLineSegment(\n          ctx,\n          coordinate[0],\n          coordinate[1],\n          nextCoordinate[0],\n          nextCoordinate[1],\n          nextCoordinate[2]\n        )\n      },\n      true\n    )\n  }\n}\n\n// Drawing text\nexport const plotText = (ctx: Ctx, textObj: any, x: number, y: number) => {\n  const { text, style } = textObj\n  const lineHeight = style.fontSize * style.lineHeightRatio\n  plotWrap(ctx, () => {\n    ctx.font = getFontString(style.fontSize, style.fontFamily)\n    ctx.textBaseline = 'middle'\n    const textArr = splitTextLines(text)\n    textArr.forEach((textRow, index) => {\n      ctx.fillText(textRow, x, y + (index * lineHeight + lineHeight / 2))\n    })\n  })\n}\n\n// Drawing pictures\nexport const plotImage = (\n  ctx: Ctx,\n  node: any,\n  x: number,\n  y: number,\n  width: number,\n  height: number\n) => {\n  plotWrap(ctx, () => {\n    const ratio = width / height\n    let showWidth = 0\n    let showHeight = 0\n    if (ratio > node.ratio) {\n      showHeight = height\n      showWidth = node.ratio * height\n    } else {\n      showWidth = width\n      showHeight = width / node.ratio\n    }\n    ctx.drawImage(node.imageObj, x, y, showWidth, showHeight)\n  })\n}\n\n// Draw the line\nexport const plotLine = (ctx: Ctx, coordinates: any[]) => {\n  plotWrap(ctx, () => {\n    let first = true\n    coordinates.forEach((coordinate) => {\n      if (first) {\n        first = false\n        ctx.moveTo(coordinate[0], coordinate[1])\n      } else {\n        ctx.lineTo(coordinate[0], coordinate[1])\n      }\n    })\n  })\n}\n","import { DRAG_NODE_PARTS, FOUR_CORNER } from '../common/constants'\nimport {\n  checkCoordinateIsInRectangle,\n  getNodeCenterCoordinate,\n  getNodeRotatedFourCornerCoordinate,\n  getRotatedCoordinate,\n  getTowCoordinateDistance,\n  getTowCoordinateRotate,\n  transformCoordinateOnNode,\n  transformCoordinateReverseRotate\n} from '../common/utils'\nimport { AppObject, Node } from '../types'\nimport BaseNode from './BaseNode'\nimport { plotCircle, plotRect } from './plot'\n\nexport default class DragNode extends BaseNode {\n  public options: Node\n\n  public node: any\n\n  public offset: number\n\n  public size: number\n\n  public resizeType: string\n\n  public diagonalCoordinate: { x: number; y: number }\n\n  public mousedownPosAndNodePosOffset: { x: number; y: number }\n\n  public nodeRatio: number\n\n  public hideParts: any[]\n\n  constructor(node: any, app: AppObject, options = {}) {\n    super(\n      {\n        type: 'dragNode',\n        notNeedDragNode: true\n      },\n      app\n    )\n\n    // @ts-ignore\n    this.options = {\n      lockRatio: false,\n      ...options\n    }\n\n    this.style = {\n      strokeStyle: '#666',\n      fillStyle: 'transparent',\n      lineWidth: 'small',\n      lineDash: 0,\n      globalAlpha: 1\n    }\n\n    // Attribution Nodes\n    this.node = node\n\n    // Distance to graphic objects\n    this.offset = 5\n\n    // Drag handle size\n    this.size = 10\n\n    // What adjustment operation is currently in progress\n    this.resizeType = ''\n\n    // Diagonal coordinates of the coordinates of the graphical object currently dragged with the mouse held down\n    this.diagonalCoordinate = {\n      x: 0,\n      y: 0\n    }\n\n    // The difference between the coordinates of the current mouse press and the coordinates of the dragged graphic object\n    this.mousedownPosAndNodePosOffset = {\n      x: 0,\n      y: 0\n    }\n\n    // Aspect ratio of graphical objects\n    this.nodeRatio = 0\n\n    // The hidden part\n    this.hideParts = []\n\n    this.x = 0\n    this.y = 0\n  }\n\n  // Start adjusting graphic objects\n  // @ts-ignore\n  startResize(resizeType: string, e: any) {\n    this.resizeType = resizeType\n    if (this.options.lockRatio) {\n      this.nodeRatio = this.node.width / this.node.height\n    }\n    if (resizeType === DRAG_NODE_PARTS.BODY) {\n      this.node.saveState()\n    } else if (resizeType === DRAG_NODE_PARTS.ROTATE) {\n      this.node.saveState()\n    } else if (resizeType === DRAG_NODE_PARTS.TOP_LEFT_BUTTON) {\n      this.handleDragMousedown(e, FOUR_CORNER.TOP_LEFT)\n    } else if (resizeType === DRAG_NODE_PARTS.TOP_RIGHT_BUTTON) {\n      this.handleDragMousedown(e, FOUR_CORNER.TOP_RIGHT)\n    } else if (resizeType === DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON) {\n      this.handleDragMousedown(e, FOUR_CORNER.BOTTOM_RIGHT)\n    } else if (resizeType === DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON) {\n      this.handleDragMousedown(e, FOUR_CORNER.BOTTOM_LEFT)\n    }\n  }\n\n  // Ending the adjustment of graphic objects\n  // @ts-ignore\n  endResize() {\n    this.resizeType = ''\n    this.diagonalCoordinate = {\n      x: 0,\n      y: 0\n    }\n    this.mousedownPosAndNodePosOffset = {\n      x: 0,\n      y: 0\n    }\n    this.nodeRatio = 0\n  }\n\n  // Handling of four retractable handle events for dragging graphic objects by pressing\n  handleDragMousedown(e: { clientX: number; clientY: number }, corner: string) {\n    const centerPos = getNodeCenterCoordinate(this.node)\n    const pos: any = getNodeRotatedFourCornerCoordinate(this.node, corner)\n    this.diagonalCoordinate.x = 2 * centerPos.x - pos.x\n    this.diagonalCoordinate.y = 2 * centerPos.y - pos.y\n    this.mousedownPosAndNodePosOffset.x = e.clientX - pos.x\n    this.mousedownPosAndNodePosOffset.y = e.clientY - pos.y\n    this.node.saveState()\n  }\n\n  // Adjusting graphic objects\n  handleResizeNode(\n    e: any,\n    mx: number,\n    my: number,\n    offsetX: number,\n    offsetY: number\n  ) {\n    const { resizeType } = this\n    if (resizeType === DRAG_NODE_PARTS.BODY) {\n      this.handleMoveNode(offsetX, offsetY)\n    } else if (resizeType === DRAG_NODE_PARTS.ROTATE) {\n      this.handleRotateNode(e, mx, my)\n    } else if (resizeType === DRAG_NODE_PARTS.TOP_LEFT_BUTTON) {\n      this.handleStretchNode(\n        e,\n        (\n          newCenter: { x: number; y: number },\n          rp: { x: number; y: number }\n        ) => ({\n          width: (newCenter.x - rp.x) * 2,\n          height: (newCenter.y - rp.y) * 2\n        }),\n        (rp: { x: any; y: any }) => ({\n          x: rp.x,\n          y: rp.y\n        }),\n        (\n          newRatio: number,\n          newRect: { x?: any; width?: any; height?: any; y?: any }\n        ) => {\n          let { x } = newRect\n          let { y } = newRect\n          if (newRatio > this.nodeRatio) {\n            x = newRect.x + newRect.width - this.nodeRatio * newRect.height\n          } else if (newRatio < this.nodeRatio) {\n            y = newRect.y + (newRect.height - newRect.width / this.nodeRatio)\n          }\n          return {\n            x,\n            y\n          }\n        }\n      )\n    } else if (resizeType === DRAG_NODE_PARTS.TOP_RIGHT_BUTTON) {\n      this.handleStretchNode(\n        e,\n        (\n          newCenter: { x: number; y: number },\n          rp: { x: number; y: number }\n        ) => ({\n          width: (rp.x - newCenter.x) * 2,\n          height: (newCenter.y - rp.y) * 2\n        }),\n        (rp: { x: number; y: any }, newSize: { width: number }) => ({\n          x: rp.x - newSize.width,\n          y: rp.y\n        }),\n        (\n          newRatio: number,\n          newRect: { x?: any; height?: any; width?: any; y?: any }\n        ) => {\n          let { x } = newRect\n          let { y } = newRect\n          if (newRatio > this.nodeRatio) {\n            x = newRect.x + this.nodeRatio * newRect.height\n          } else if (newRatio < this.nodeRatio) {\n            x = newRect.x + newRect.width\n            y = newRect.y + (newRect.height - newRect.width / this.nodeRatio)\n          }\n          return {\n            x,\n            y\n          }\n        }\n      )\n    } else if (resizeType === DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON) {\n      this.handleStretchNode(\n        e,\n        (\n          newCenter: { x: number; y: number },\n          rp: { x: number; y: number }\n        ) => ({\n          width: (rp.x - newCenter.x) * 2,\n          height: (rp.y - newCenter.y) * 2\n        }),\n        (\n          rp: { x: number; y: number },\n          newSize: { width: number; height: number }\n        ) => ({\n          x: rp.x - newSize.width,\n          y: rp.y - newSize.height\n        }),\n        (\n          newRatio: number,\n          newRect: { x?: any; height?: any; y?: any; width?: any }\n        ) => {\n          let { x } = newRect\n          let { y } = newRect\n          if (newRatio > this.nodeRatio) {\n            x = newRect.x + this.nodeRatio * newRect.height\n            y = newRect.y + newRect.height\n          } else if (newRatio < this.nodeRatio) {\n            x = newRect.x + newRect.width\n            y = newRect.y + newRect.width / this.nodeRatio\n          }\n          return {\n            x,\n            y\n          }\n        }\n      )\n    } else if (resizeType === DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON) {\n      this.handleStretchNode(\n        e,\n        (\n          newCenter: { x: number; y: number },\n          rp: { x: number; y: number }\n        ) => ({\n          width: (newCenter.x - rp.x) * 2,\n          height: (rp.y - newCenter.y) * 2\n        }),\n        (rp: { x: number; y: number }, newSize: { height: number }) => ({\n          x: rp.x,\n          y: rp.y - newSize.height\n        }),\n        (\n          newRatio: number,\n          newRect: { x?: any; width?: any; height?: any; y?: any }\n        ) => {\n          let { x } = newRect\n          let { y } = newRect\n          if (newRatio > this.nodeRatio) {\n            x = newRect.x + newRect.width - this.nodeRatio * newRect.height\n            y = newRect.y + newRect.height\n          } else if (newRatio < this.nodeRatio) {\n            y = newRect.y + newRect.width / this.nodeRatio\n          }\n          return {\n            x,\n            y\n          }\n        }\n      )\n    }\n  }\n\n  // Move the graphic object as a whole\n  handleMoveNode(offsetX: number, offsetY: number) {\n    this.node.move(offsetX, offsetY)\n  }\n\n  // Rotating graphic objects\n  handleRotateNode(\n    e: { clientX: number; clientY: number },\n    mx: number,\n    my: number\n  ) {\n    const centerPos = getNodeCenterCoordinate(this.node)\n    const rotate = getTowCoordinateRotate(\n      centerPos.x,\n      centerPos.y,\n      e.clientX,\n      e.clientY,\n      mx,\n      my\n    )\n    this.node.offsetRotate(rotate)\n  }\n\n  // Set the hidden section\n  setHideParts(parts = []) {\n    this.hideParts = parts\n  }\n\n  // Show all sections\n  showAll() {\n    this.setHideParts([])\n  }\n\n  // Only the main part is displayed\n  onlyShowBody() {\n    this.setHideParts([\n      DRAG_NODE_PARTS.ROTATE,\n      DRAG_NODE_PARTS.TOP_LEFT_BUTTON,\n      DRAG_NODE_PARTS.TOP_RIGHT_BUTTON,\n      DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON,\n      DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON\n    ] as any)\n  }\n\n  // Update data\n  update() {\n    this.x = this.node.x - this.offset\n    this.y = this.node.y - this.offset\n    this.width = this.node.width + this.offset * 2\n    this.height = this.node.height + this.offset * 2\n    this.rotate = this.node.rotate\n  }\n\n  // Scaling calculations\n  stretchCalc(\n    x: number,\n    y: number,\n    calcSize: (\n      arg0: { x: number; y: number },\n      arg1: { x: number; y: number }\n    ) => any,\n    calcPos: (arg0: { x: number; y: number }, arg1: any) => any\n  ) {\n    const newCenter = {\n      x: (x + this.diagonalCoordinate.x) / 2,\n      y: (y + this.diagonalCoordinate.y) / 2\n    }\n    const rp = transformCoordinateReverseRotate(\n      x,\n      y,\n      newCenter.x,\n      newCenter.y,\n      this.node.rotate\n    )\n    const newSize = calcSize(newCenter, rp)\n    let isWidthReverse = false\n    if (newSize.width < 0) {\n      newSize.width = 0\n      isWidthReverse = true\n    }\n    let isHeightReverse = false\n    if (newSize.height < 0) {\n      newSize.height = 0\n      isHeightReverse = true\n    }\n    const newPos = calcPos(rp, newSize)\n    const newRect = {\n      x: newPos.x,\n      y: newPos.y,\n      width: newSize.width,\n      height: newSize.height\n    }\n    if (isWidthReverse || isHeightReverse) {\n      newRect.x = this.node.x\n      newRect.y = this.node.y\n    }\n    return {\n      newRect,\n      newCenter\n    }\n  }\n\n  // Stretching graphic objects\n  handleStretchNode(\n    e: { clientX: number; clientY: number },\n    calcSize: any,\n    calcPos: any,\n    fixPos: any\n  ) {\n    const actClientX = e.clientX - this.mousedownPosAndNodePosOffset.x\n    const actClientY = e.clientY - this.mousedownPosAndNodePosOffset.y\n    const { newRect, newCenter } = this.stretchCalc(\n      actClientX,\n      actClientY,\n      calcSize,\n      calcPos\n    )\n    if (this.options.lockRatio) {\n      this.fixStretch(newRect, newCenter, calcSize, calcPos, fixPos)\n      return\n    }\n    this.node.updateRect(newRect.x, newRect.y, newRect.width, newRect.height)\n  }\n\n  // Correction of new graphics when aspect ratio is locked\n  fixStretch(\n    newRect: { x?: any; y?: any; width: any; height: any },\n    newCenter: { x: any; y: any },\n    calcSize: {\n      (newCenter: { x: number; y: number }, rp: { x: number; y: number }): {\n        width: number\n        height: number\n      }\n      (newCenter: { x: number; y: number }, rp: { x: number; y: number }): {\n        width: number\n        height: number\n      }\n      (newCenter: { x: number; y: number }, rp: { x: number; y: number }): {\n        width: number\n        height: number\n      }\n      (newCenter: { x: number; y: number }, rp: { x: number; y: number }): {\n        width: number\n        height: number\n      }\n      (arg0: { x: number; y: number }, arg1: { x: number; y: number }): any\n      (arg0: { x: number; y: number }, arg1: { x: number; y: number }): any\n    },\n    calcPos: {\n      (rp: { x: any; y: any }): { x: any; y: any }\n      (rp: { x: number; y: any }, newSize: { width: number }): {\n        x: number\n        y: any\n      }\n      (\n        rp: { x: number; y: number },\n        newSize: { width: number; height: number }\n      ): { x: number; y: number }\n      (rp: { x: number; y: number }, newSize: { height: number }): {\n        x: number\n        y: number\n      }\n      (arg0: { x: number; y: number }, arg1: any): any\n      (arg0: { x: number; y: number }, arg1: any): any\n    },\n    fixPos: {\n      (\n        newRatio: number,\n        newRect: { x?: any; width?: any; height?: any; y?: any }\n      ): { x: any; y: any }\n      (\n        newRatio: number,\n        newRect: { x?: any; height?: any; width?: any; y?: any }\n      ): { x: any; y: any }\n      (\n        newRatio: number,\n        newRect: { x?: any; height?: any; y?: any; width?: any }\n      ): { x: any; y: any }\n      (\n        newRatio: number,\n        newRect: { x?: any; width?: any; height?: any; y?: any }\n      ): { x: any; y: any }\n      (arg0: number, arg1: any): any\n    }\n  ) {\n    const newRatio = newRect.width / newRect.height\n    const fp = fixPos(newRatio, newRect)\n    const rp = getRotatedCoordinate(\n      fp.x,\n      fp.y,\n      newCenter.x,\n      newCenter.y,\n      this.node.rotate\n    )\n    const fixNewRect = this.stretchCalc(rp.x, rp.y, calcSize, calcPos).newRect\n    if (fixNewRect.width === 0 && fixNewRect.height === 0) {\n      return\n    }\n    this.node.updateRect(\n      fixNewRect.x,\n      fixNewRect.y,\n      fixNewRect.width,\n      fixNewRect.height\n    )\n  }\n\n  render() {\n    this.update()\n    const { width, height } = this\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      this.app.ctx.save()\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.BODY)) {\n        this.app.ctx.setLineDash([5])\n        plotRect(this.app.ctx, -halfWidth, -halfHeight, width, height)\n        this.app.ctx.restore()\n      }\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.TOP_LEFT_BUTTON)) {\n        plotRect(\n          this.app.ctx,\n          -halfWidth - this.size,\n          -halfHeight - this.size,\n          this.size,\n          this.size\n        )\n      }\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.TOP_RIGHT_BUTTON)) {\n        plotRect(\n          this.app.ctx,\n          -halfWidth + this.node.width + this.size,\n          -halfHeight - this.size,\n          this.size,\n          this.size\n        )\n      }\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON)) {\n        plotRect(\n          this.app.ctx,\n          -halfWidth + this.node.width + this.size,\n          -halfHeight + this.node.height + this.size,\n          this.size,\n          this.size\n        )\n      }\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON)) {\n        plotRect(\n          this.app.ctx,\n          -halfWidth - this.size,\n          -halfHeight + this.node.height + this.size,\n          this.size,\n          this.size\n        )\n      }\n      if (!this.hideParts.includes(DRAG_NODE_PARTS.ROTATE)) {\n        plotCircle(\n          this.app.ctx,\n          -halfWidth + this.node.width / 2 + this.size / 2,\n          -halfHeight - this.size * 2,\n          this.size\n        )\n      }\n    })\n  }\n\n  // Detects which part of a dragged graphic object a coordinate is on\n  checkCoordinateInDragNodeWhere(x: number, y: number) {\n    let part = ''\n    const rp = transformCoordinateOnNode(x, y, this.node)\n    if (checkCoordinateIsInRectangle(rp.x, rp.y, this as any)) {\n      part = DRAG_NODE_PARTS.BODY\n    } else if (\n      getTowCoordinateDistance(\n        rp.x,\n        rp.y,\n        this.x + this.width / 2,\n        this.y - this.size * 2\n      ) <= this.size\n    ) {\n      part = DRAG_NODE_PARTS.ROTATE\n    } else if (\n      this._checkCoordinateIsInButton(rp.x, rp.y, FOUR_CORNER.TOP_LEFT)\n    ) {\n      part = DRAG_NODE_PARTS.TOP_LEFT_BUTTON\n    } else if (\n      this._checkCoordinateIsInButton(rp.x, rp.y, FOUR_CORNER.TOP_RIGHT)\n    ) {\n      part = DRAG_NODE_PARTS.TOP_RIGHT_BUTTON\n    } else if (\n      this._checkCoordinateIsInButton(rp.x, rp.y, FOUR_CORNER.BOTTOM_RIGHT)\n    ) {\n      part = DRAG_NODE_PARTS.BOTTOM_RIGHT_BUTTON\n    } else if (\n      this._checkCoordinateIsInButton(rp.x, rp.y, FOUR_CORNER.BOTTOM_LEFT)\n    ) {\n      part = DRAG_NODE_PARTS.BOTTOM_LEFT_BUTTON\n    }\n    if (this.hideParts.includes(part)) {\n      part = ''\n    }\n    return part\n  }\n\n  // Detects if the coordinates are within a drag and drop button\n  _checkCoordinateIsInButton(x: number, y: number, dir: string) {\n    let _x = 0\n    let _y = 0\n    switch (dir) {\n      case FOUR_CORNER.TOP_LEFT:\n        _x = this.x - this.size\n        _y = this.y - this.size\n        break\n      case FOUR_CORNER.TOP_RIGHT:\n        _x = this.x + this.width\n        _y = this.y - this.size\n        break\n      case FOUR_CORNER.BOTTOM_RIGHT:\n        _x = this.x + this.width\n        _y = this.y + this.height\n        break\n      case FOUR_CORNER.BOTTOM_LEFT:\n        _x = this.x - this.size\n        _y = this.y + this.height\n        break\n      default:\n        break\n    }\n    return checkCoordinateIsInRectangle(x, y, _x, _y, this.size, this.size)\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtArbitraryPlotLineEdge } from '../common/utils/checkClick'\nimport BaseMultiplexCoordinateNode from '../support/BaseMultiplexCoordinateNode'\nimport DragNode from '../support/DragNode'\nimport { plotArbitraryLine, plotLineSegment } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class ArbitraryPlot extends BaseMultiplexCoordinateNode {\n  public lastLineWidth: number\n\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app)\n\n    // The third number of the coordinates [x,y,speed] is the line width\n    this.lastLineWidth = -1\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtArbitraryPlotLineEdge(this as any, rp)\n  }\n\n  // Rendering of a single line segment\n  singleRender(\n    mx: number,\n    my: number,\n    tx: number,\n    ty: number,\n    lineWidth: number | undefined\n  ) {\n    this.app.ctx.save()\n    plotLineSegment(this.app.ctx, mx, my, tx, ty, lineWidth)\n    this.app.ctx.restore()\n  }\n\n  render() {\n    const { coordinateArr }: any = this\n    this.warpRender(({ cx, cy }: any) => {\n      plotArbitraryLine(this.app.ctx, coordinateArr, {\n        app: this.app,\n        cx,\n        cy\n      })\n    })\n    this.renderDragNode()\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtArrowEdge } from '../common/utils/checkClick'\nimport BaseMultiplexCoordinateNode from '../support/BaseMultiplexCoordinateNode'\nimport DragNode from '../support/DragNode'\nimport { plotArrow } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Arrow extends BaseMultiplexCoordinateNode {\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, app)\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtArrowEdge(this, rp)\n  }\n\n  render() {\n    const { coordinateArr, fictitiousCoordinate }: any = this\n    this.warpRender(({ cx, cy }: { cx: number; cy: number }) => {\n      // Plus the current live position of the mouse\n      let realtimeCoordinate: any[][] = []\n      if (coordinateArr.length > 0 && this.isCreate) {\n        const { x: fx, y: fy } = this.app.calculate.transform(\n          fictitiousCoordinate.x - cx,\n          fictitiousCoordinate.y - cy\n        )\n        realtimeCoordinate = [[fx, fy]]\n      }\n      plotArrow(\n        this.app.ctx,\n        coordinateArr\n          .map((coordinate: any[]) => {\n            const { x, y } = this.app.calculate.transform(\n              coordinate[0],\n              coordinate[1]\n            )\n            return [x - cx, y - cy]\n          })\n          .concat(realtimeCoordinate)\n      )\n    })\n    this.renderDragNode()\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport {\n  checkIsAtCircleEdge,\n  getCircleRadius\n} from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotCircle } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Circle extends BaseNode {\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app, {\n      lockRatio: true\n    })\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtCircleEdge(this, rp)\n  }\n\n  render() {\n    const { width, height }: any = this\n    this.warpRender(() => {\n      plotCircle(this.app.ctx, 0, 0, getCircleRadius(width, height), true)\n    })\n    this.renderDragNode()\n  }\n}\n","import {\n  getNodeCenterCoordinate,\n  getRotatedCoordinate,\n  transformCoordinateOnNode\n} from '../common/utils'\nimport { checkIsAtDiamondEdge } from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotDiamond } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Diamond extends BaseNode {\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app)\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtDiamondEdge(this, rp)\n  }\n\n  // Get a list of the end coordinates of the graph after the rotation has been applied\n  getEndCoordinateList() {\n    const { x, y, width, height, rotate }: any = this\n    const coordinates = [\n      [x + width / 2, y],\n      [x + width, y + height / 2],\n      [x + width / 2, y + height],\n      [x, y + height / 2]\n    ]\n    const center = getNodeCenterCoordinate(this)\n    return coordinates.map((coordinate) =>\n      getRotatedCoordinate(\n        coordinate[0],\n        coordinate[1],\n        center.x,\n        center.y,\n        rotate\n      )\n    )\n  }\n\n  render() {\n    const { width, height }: any = this\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      plotDiamond(this.app.ctx, -halfWidth, -halfHeight, width, height, true)\n    })\n    this.renderDragNode()\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtRectangleInner } from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotImage } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Image extends BaseNode {\n  public url: string\n\n  public imageObj: null\n\n  public ratio: number\n\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app, {\n      lockRatio: true\n    })\n\n    const { url, imageObj, ratio }: any = options\n\n    this.url = url || ''\n\n    this.imageObj = imageObj || null\n\n    this.ratio = ratio || 1\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtRectangleInner(this, rp)\n  }\n\n  // Serialisation\n  serialize() {\n    const base = super.serialize()\n    return {\n      ...base,\n      url: this.url,\n      ratio: this.ratio\n    }\n  }\n\n  render() {\n    const { width, height }: any = this\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      plotImage(this.app.ctx, this, -halfWidth, -halfHeight, width, height)\n    })\n    this.renderDragNode()\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtLineEdge } from '../common/utils/checkClick'\nimport BaseMultiplexCoordinateNode from '../support/BaseMultiplexCoordinateNode'\nimport DragNode from '../support/DragNode'\nimport { plotLine } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Line extends BaseMultiplexCoordinateNode {\n  public isSingle: boolean\n\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app)\n\n    // Is it a single line segment, otherwise it is a folded line consisting of multiple line segments\n    const { isSingle = false }: any = options\n\n    this.isSingle = isSingle\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtLineEdge(this as any, rp)\n  }\n\n  render() {\n    const { coordinateArr, fictitiousCoordinate }: any = this\n    this.warpRender(({ cx, cy }: any) => {\n      // Plus the current live position of the mouse\n      let realtimeCoordinate: any[][] = []\n      if (coordinateArr.length > 0 && this.isCreate) {\n        const { x: fx, y: fy } = this.app.calculate.transform(\n          fictitiousCoordinate.x - cx,\n          fictitiousCoordinate.y - cy\n        )\n        realtimeCoordinate = [[fx, fy]]\n      }\n      plotLine(\n        this.app.ctx,\n        coordinateArr\n          .map((coordinate: any[]) => {\n            const { x, y } = this.app.calculate.transform(\n              coordinate[0],\n              coordinate[1]\n            )\n            return [x - cx, y - cy]\n          })\n          .concat(realtimeCoordinate)\n      )\n    })\n    this.renderDragNode()\n  }\n}\n","import { transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtRectangleEdge } from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotRect } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Rectangle extends BaseNode {\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app)\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtRectangleEdge(this, rp)\n  }\n\n  render() {\n    const { width, height }: any = this\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      plotRect(this.app.ctx, -halfWidth, -halfHeight, width, height, true)\n    })\n    this.renderDragNode()\n  }\n}\n","import { splitTextLines, transformCoordinateOnNode } from '../common/utils'\nimport { checkIsAtRectangleInner } from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotText } from '../support/plot'\nimport { AppObject, Node } from '../types'\n\nexport default class Text extends BaseNode {\n  public text: string\n\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app, {\n      lockRatio: true\n    })\n\n    this.text = options?.text || ''\n\n    this.style.fillStyle = options?.style?.fillStyle || '#000000'\n\n    this.style.fontSize = options?.style?.fontSize || 18\n\n    this.style.lineHeightRatio = options?.style?.lineHeightRatio || 1.5\n\n    this.style.fontFamily =\n      options?.style?.fontFamily || 'Microsoft YaHei, sans-serif'\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtRectangleInner(this, rp)\n  }\n\n  // Update the wrap-around box\n  // @ts-ignore\n  updateRect(x: number, y: number, width: number, height: number) {\n    const { text, style } = this\n    this.style.fontSize = Math.floor(\n      height / splitTextLines(text).length / style.lineHeightRatio\n    )\n    super.updateRect(x, y, width, height)\n  }\n\n  serialize() {\n    const base = super.serialize()\n    return {\n      ...base,\n      text: this.text\n    }\n  }\n\n  render() {\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      plotText(this.app.ctx, this, -halfWidth, -halfHeight)\n    })\n    this.renderDragNode()\n  }\n}\n","import {\n  getNodeCenterCoordinate,\n  getRotatedCoordinate,\n  transformCoordinateOnNode\n} from '../common/utils'\nimport { checkIsAtTriangleEdge } from '../common/utils/checkClick'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { plotTriangle } from '../support/plot'\nimport { AppObject } from '../types'\n\nexport default class Triangle extends BaseNode {\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this, this.app)\n  }\n\n  // Get a list of the end coordinates of the graph after the rotation has been applied\n  getEndCoordinateList() {\n    const { x, y, width, height, rotate }: any = this\n    const coordinates = [\n      [x + width / 2, y],\n      [x + width, y + height],\n      [x, y + height]\n    ]\n    const center = getNodeCenterCoordinate(this)\n    return coordinates.map((coordinate) =>\n      getRotatedCoordinate(\n        coordinate[0],\n        coordinate[1],\n        center.x,\n        center.y,\n        rotate\n      )\n    )\n  }\n\n  isClick(x: number, y: number) {\n    const rp = transformCoordinateOnNode(x, y, this)\n    return checkIsAtTriangleEdge(this as any, rp)\n  }\n\n  render() {\n    const { width, height }: any = this\n    this.warpRender(({ halfWidth, halfHeight }: any) => {\n      plotTriangle(this.app.ctx, -halfWidth, -halfHeight, width, height, true)\n    })\n    this.renderDragNode()\n  }\n}\n","import { DRAG_NODE_PARTS } from '../common/constants'\nimport {\n  computedLineWidthBySpeed,\n  createImageObj,\n  getNodeID,\n  getTowCoordinateDistance,\n  throttle\n} from '../common/utils'\nimport ArbitraryPlot from '../components/ArbitraryPlot'\nimport Arrow from '../components/Arrow'\nimport Circle from '../components/Circle'\nimport Diamond from '../components/Diamond'\nimport Image from '../components/Image'\nimport Line from '../components/Line'\nimport Rectangle from '../components/Rectangle'\nimport Text from '../components/Text'\nimport Triangle from '../components/Triangle'\nimport { AppObject, Ctx, Node, NodeArray, PlotType } from '../types'\n\nexport default class Nodes {\n  public app: AppObject\n\n  public nodeList: NodeArray\n\n  activeNode: Node | undefined\n\n  public isCreateNode: boolean\n\n  public isResize: boolean\n\n  public resizeNode: Node | null\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    // All graphic objects\n    this.nodeList = []\n\n    // Currently active graphic object\n    this.activeNode = undefined\n\n    // A new graphic object is currently being created\n    this.isCreateNode = false\n\n    // The graphic object is currently being adjusted\n    this.isResize = false\n\n    // The graphic object currently being adjusted\n    this.resizeNode = null\n\n    // A little relief from lag\n    this.handleResize = throttle(this.handleResize, this as any, 15)\n  }\n\n  createNode(\n    options: any,\n    callback: (...args: any) => void = () => {},\n    ctx?: Ctx,\n    notActive?: boolean\n  ) {\n    if (this.hasActiveNode() || this.isCreateNode) {\n      return this\n    }\n    options.id = getNodeID()\n    const node: any = this.pureCreateNode(options)\n    if (!node) {\n      return this\n    }\n    this.addNode(node)\n    if (!notActive) {\n      this.setActiveNode(node)\n    }\n    this.isCreateNode = true\n    // @ts-ignore\n    callback.call(ctx, node)\n    return this\n  }\n\n  copyNode(node: Node, notActive?: boolean, pos?: { x: number; y: number }) {\n    return new Promise<any>(async (resolve) => {\n      if (!node) {\n        return\n      }\n      const data: any = node.serialize?.()\n      if (data.type === 'image' && data.url != null) {\n        data.imageObj = (await createImageObj(data.url)) as HTMLInputElement\n      }\n      this.createNode(\n        data,\n        (node: any) => {\n          node.startResize(DRAG_NODE_PARTS.BODY)\n          let ox = 20\n          let oy = 20\n          if (pos) {\n            ox = pos.x - node.x - node.width / 2\n            oy = pos.y - node.y - node.height / 2\n          }\n          const gridAdsorbentPos = this.app.calculate.gridAdsorbent(ox, oy)\n          node.resize(null, null, null, gridAdsorbentPos.x, gridAdsorbentPos.y)\n          node.isCreate = false\n          if (notActive) {\n            node.isActive = false\n          }\n          this.isCreateNode = false\n          resolve(node)\n        },\n        this as unknown as Ctx,\n        notActive\n      )\n    })\n  }\n\n  // Rectangle-like graphic object being created\n  createRectangleLikeNode(\n    type: PlotType,\n    x: number,\n    y: number,\n    offsetX: number,\n    offsetY: number\n  ) {\n    this.createNode({\n      type,\n      x,\n      y,\n      width: offsetX,\n      height: offsetY\n    })\n    this.activeNode?.updateSize?.(offsetX, offsetY)\n  }\n\n  // Circular graphic object being created\n  createCircle(x: number, y: number, e: { clientX: any; clientY: any }) {\n    this.createNode({\n      type: 'circle',\n      x,\n      y\n    })\n    const radius = getTowCoordinateDistance(e.clientX, e.clientY, x, y)\n    this.activeNode?.updateSize?.(radius, radius)\n  }\n\n  // Freehand brush graphic object being created\n  createArbitraryPlot(\n    e: { clientX: any; clientY: any },\n    event: { mouseSpeed: number; lastMousePos: { x: number; y: number } }\n  ) {\n    this.createNode({\n      type: 'arbitrary-plot'\n    })\n    const node = this.activeNode\n    // Calculating brush thickness\n    const lineWidth = computedLineWidthBySpeed(\n      event.mouseSpeed,\n      <number>node?.lastLineWidth\n    )\n    if (node?.lastLineWidth) {\n      node.lastLineWidth = lineWidth\n    }\n    node?.addCoordinate?.(e.clientX, e.clientY, lineWidth)\n    // The brush is not repainted and incremental painting is used, otherwise it will lag\n    const { calculate, ctx, state } = this.app\n    const tfp = calculate.transformToCanvasCalculate(\n      calculate.subScrollX(event.lastMousePos.x),\n      calculate.subScrollY(event.lastMousePos.y)\n    )\n    const ttp = calculate.transformToCanvasCalculate(\n      calculate.subScrollX(e.clientX),\n      calculate.subScrollY(e.clientY)\n    )\n    ctx.save()\n    ctx.scale(<number>state.scale, <number>state.scale)\n    node?.singleRender?.(tfp.x, tfp.y, ttp.x, ttp.y, lineWidth)\n    ctx.restore()\n  }\n\n  // Image graphic object being created\n  createImage(\n    e: { unGridClientX: number; unGridClientY: number },\n    {\n      width,\n      height,\n      imageObj,\n      url,\n      ratio\n    }: {\n      width: number\n      height: number\n      imageObj: HTMLInputElement\n      url: string\n      ratio: number\n    }\n  ) {\n    const gp = this.app.calculate.gridAdsorbent(\n      e.unGridClientX - width / 2,\n      e.unGridClientY - height / 2\n    )\n    this.createNode({\n      type: 'image',\n      x: gp.x,\n      y: gp.y,\n      url,\n      imageObj,\n      width,\n      height,\n      ratio\n    })\n  }\n\n  // Text graphic object being edited\n  editingText(node: Node) {\n    if (node.type !== 'text') {\n      return\n    }\n    node.noRender = true\n    this.setActiveNode(node)\n  }\n\n  // Complete editing of text graphic objects\n  completeEditingText() {\n    const node = this.activeNode\n    if (!node || node.type !== 'text') {\n      return\n    }\n    if (!node?.text?.trim()) {\n      this.deleteNode(node)\n      this.setActiveNode()\n      return\n    }\n    node.noRender = false\n  }\n\n  // Complete the creation of the arrow graphic object\n  completeCreateArrow(e: { clientX: number; clientY: number }) {\n    this.activeNode?.addCoordinate?.(e.clientX, e.clientY)\n  }\n\n  // Arrowhead graphic object being created\n  createArrow(x: number, y: number, e: { clientX: any; clientY: any }) {\n    this.createNode(\n      {\n        type: 'arrow',\n        x,\n        y\n      },\n      (node) => {\n        node.addCoordinate(x, y)\n      }\n    )\n    this.activeNode?.updateFictitiousCoordinate?.(e.clientX, e.clientY)\n  }\n\n  // Line/line graphical object being created\n  createLine(\n    x: number | undefined,\n    y: number | undefined,\n    e: { clientX: number; clientY: number },\n    isSingle = false,\n    notCreate = false\n  ) {\n    if (!notCreate) {\n      this.createNode(\n        {\n          type: 'line',\n          x,\n          y,\n          isSingle\n        },\n        (node) => {\n          node.addCoordinate(x, y)\n        }\n      )\n    }\n    const node = this.activeNode\n    if (node) {\n      node.updateFictitiousCoordinate?.(e.clientX, e.clientY)\n    }\n  }\n\n  insertNode(node: Node, index: number) {\n    this.nodeList.splice(index, 0, node)\n  }\n\n  addNode(node: Node) {\n    this.nodeList.push(node)\n    return this\n  }\n\n  getNodesNum() {\n    return this.nodeList.length\n  }\n\n  hasNodes() {\n    return this.nodeList.length > 0\n  }\n\n  unshiftNode(node: Node) {\n    this.nodeList.unshift(node)\n    return this\n  }\n\n  // Deleting graphic objects\n  deleteNode(node: Node) {\n    const index = this.getNodeIndex(node)\n    if (index !== -1) {\n      this.nodeList.splice(index, 1)\n      if (node.isActive) {\n        this.cancelActiveNode()\n      }\n    }\n    return this\n  }\n\n  // Delete all graphic objects\n  deleteAllNodes() {\n    this.activeNode = undefined\n    this.nodeList = []\n    this.isCreateNode = false\n    this.isResize = false\n    this.resizeNode = null\n    return this\n  }\n\n  // Get the index of the graphic object in the list of graphic objects\n  getNodeIndex(node: Node) {\n    return this.nodeList.findIndex((item) => item === node)\n  }\n\n  // Create graphic objects from graphic object data\n  createNodesFromData(nodes: NodeArray) {\n    nodes.forEach((node) => {\n      const nodeObject: any = this.pureCreateNode(node)\n      nodeObject.isActive = false\n      nodeObject.isCreate = false\n      this.addNode(nodeObject as Node)\n    })\n    return this\n  }\n\n  // Presence or absence of active graphic objects\n  hasActiveNode() {\n    return this.activeNode\n  }\n\n  // Setting the activation of graphic objects\n  setActiveNode(node?: Node) {\n    this.cancelActiveNode()\n    this.activeNode = node\n    if (node) {\n      node.isActive = true\n    }\n    this.app.emit('activeNodeChange', this.activeNode)\n    return this\n  }\n\n  // Cancel the currently active graphic object\n  cancelActiveNode() {\n    if (!this.hasActiveNode()) {\n      return this\n    }\n    if (this.activeNode) {\n      this.activeNode.isActive = false\n      this.activeNode = undefined\n    }\n    this.app.emit('activeNodeChange', this.activeNode)\n    return this\n  }\n\n  // Detects if a graphic object is selected by a coordinate click\n  checkIsClickNode(e: any) {\n    const x = e.unGridClientX\n    const y = e.unGridClientY\n    for (let i = this.nodeList.length - 1; i >= 0; i -= 1) {\n      const node = this.nodeList[i]\n      if (node.isClick?.(x, y)) {\n        return node\n      }\n    }\n    return null\n  }\n\n  pureCreateNode(options: any = {}) {\n    switch (options.type) {\n      case 'rectangle':\n        return new Rectangle(options, this.app)\n      case 'diamond':\n        return new Diamond(options, this.app)\n      case 'triangle':\n        return new Triangle(options, this.app)\n      case 'circle':\n        return new Circle(options, this.app)\n      case 'arbitrary-plot':\n        return new ArbitraryPlot(options, this.app)\n      case 'image':\n        return new Image(options, this.app)\n      case 'arrow':\n        return new Arrow(options, this.app)\n      case 'line':\n        return new Line(options, this.app)\n      case 'text':\n        return new Text(options, this.app)\n      default:\n        return null\n    }\n  }\n\n  // Complete the creation of line/dash graphical objects\n  completeCreateLine(\n    e: { clientX: number; clientY: number },\n    completeCallback = () => {}\n  ) {\n    let node = this.activeNode\n    const x = e.clientX\n    const y = e.clientY\n    if (node && node.isSingle) {\n      node.addCoordinate?.(x, y)\n      completeCallback()\n    } else {\n      this.createNode({\n        type: 'line',\n        isSingle: false\n      })\n      node = this.activeNode\n      node?.addCoordinate?.(x, y)\n      node?.updateFictitiousCoordinate?.(x, y)\n    }\n  }\n\n  // Creation of graphic objects complete\n  completeCreateNode() {\n    this.isCreateNode = false\n    const node: any = this.activeNode\n    if (!node) {\n      return this\n    }\n    if (['arbitrary-plot', 'arrow', 'line'].includes(node.type)) {\n      node.updateMultiplexCoordinateBoundingRect()\n    }\n    node.isCreate = false\n    this.app.emitChange()\n    return this\n  }\n\n  // Styling of active graphic objects\n  setActiveNodeStyle(style = {}) {\n    if (!this.hasActiveNode()) {\n      return this\n    }\n    Object.keys(style).forEach((key) => {\n      // @ts-ignore\n      this.activeNode.style[key] = style[key]\n    })\n    return this\n  }\n\n  // Detects if the specified position is on the graphic object adjustment handle\n  checkInResizeHand(x: any, y: any) {\n    const node = this.activeNode\n    const hand = node?.dragNode?.checkCoordinateInDragNodeWhere?.(x, y)\n    if (hand) {\n      return {\n        node,\n        hand\n      }\n    }\n    return null\n  }\n\n  // Check if a graphic object adjustment operation is required\n  checkIsResize(x: number, y: number, e: any) {\n    if (!this.hasActiveNode()) {\n      return false\n    }\n    const res = this.checkInResizeHand(x, y)\n    if (res) {\n      this.isResize = true\n      if (res.node) {\n        this.resizeNode = res.node\n        this.resizeNode.startResize?.(res.hand, e)\n      }\n      this.app.cursor.setResize(res.hand)\n      return true\n    }\n    return false\n  }\n\n  // Performing graphic object adjustment operations\n  handleResize(...args: any[]) {\n    if (!this.isResize) {\n      return\n    }\n    this.resizeNode?.resize?.(...args)\n  }\n\n  // Ending a graphic object adjustment operation\n  endResize() {\n    this.isResize = false\n    this.resizeNode?.endResize?.()\n    this.resizeNode = null\n  }\n\n  // Serialize all graphic objects on the current canvas\n  serialize(stringify = false) {\n    const data = this.nodeList.map((node) => node.serialize?.())\n    return stringify ? JSON.stringify(data) : data\n  }\n}\n","import { getMultiplexNodeRectInfo } from '../common/utils'\nimport { AppObject } from '../types'\n\nexport default class Render {\n  public app: AppObject\n\n  public beingCopyActiveNode: null\n\n  public beingCopySelectedNodes: any[]\n\n  public beingCopyNode: undefined\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    // The active graphic object that will be copied\n    this.beingCopyActiveNode = null\n\n    // The selected graphic object that will be copied\n    this.beingCopySelectedNodes = []\n\n    this.registerShortcutKeys()\n  }\n\n  // Styling of active graphic objects\n  setActiveNodeStyle(style = {}) {\n    if (!this.app.nodes.hasActiveNode()) {\n      return this\n    }\n    this.app.nodes.setActiveNodeStyle(style)\n    this.render()\n    if (!this.app.nodes.isCreateNode) {\n      this.app.emitChange()\n    }\n    return this\n  }\n\n  // Set the style for the currently active or selected graphic object\n  setCurrentNodesStyle(style = {}) {\n    this.setActiveNodeStyle(style)\n    this.app.selection.setSelectedNodeStyle(style)\n  }\n\n  clearCanvas() {\n    const { width, height } = this.app\n    this.app.ctx.clearRect(-width / 2, -height / 2, width, height)\n    return this\n  }\n\n  render() {\n    const { state } = this.app\n    this.clearCanvas()\n    this.app.ctx.save()\n    this.app.ctx.scale(<number>state.scale, <number>state.scale)\n    this.app.nodes.nodeList.forEach((node: any) => {\n      if (node.noRender) {\n        return\n      }\n      node.render()\n    })\n    this.app.ctx.restore()\n    return this\n  }\n\n  registerShortcutKeys() {\n    // Select all\n    this.app.keyCommand.addShortcut('Control+a', () => {\n      this.selectAll()\n    })\n    // Resetting scaling\n    this.app.keyCommand.addShortcut('Control+0', () => {\n      this.setZoom(1)\n    })\n    // Delete the currently active graphic object\n    this.app.keyCommand.addShortcut('Del|Backspace', () => {\n      this.deleteCurrentNodes()\n    })\n    // Copying graphic objects\n    this.app.keyCommand.addShortcut('Control+c', () => {\n      this.copyCurrentNode()\n    })\n    // Cutting graphic objects\n    this.app.keyCommand.addShortcut('Control+x', () => {\n      this.cutCurrentNode()\n    })\n    // Withdrawn\n    this.app.keyCommand.addShortcut('Control+z', () => {\n      this.app.history.undo()\n    })\n    // Show or hide the grid\n    this.app.keyCommand.addShortcut(\"Control+'\", () => {\n      if (this.app.state.showGrid) {\n        this.app.grid.hideGrid()\n      } else {\n        this.app.grid.showGrid()\n      }\n    })\n    // Redo\n    this.app.keyCommand.addShortcut('Control+y', () => {\n      this.app.history.redo()\n    })\n    // Paste graphic objects\n    this.app.keyCommand.addShortcut('Control+v', () => {\n      this.pasteCurrentNode(true)\n    })\n  }\n\n  // Copy the currently active or selected graphic object\n  copyCurrentNode() {\n    if (this.app.nodes.activeNode) {\n      this.beingCopySelectedNodes = []\n      this.beingCopyNode = this.app.nodes.activeNode\n    } else if (this.app.selection.hasSelectionNodes()) {\n      this.beingCopyNode = undefined\n      this.beingCopySelectedNodes = this.app.selection.getSelectionNodes()\n    }\n  }\n\n  // Cuts the currently active or selected graphic object\n  cutCurrentNode() {\n    if (this.app.nodes.activeNode) {\n      this.copyCurrentNode()\n      this.deleteCurrentNodes()\n    } else if (this.app.selection.hasSelectionNodes()) {\n      this.copyCurrentNode()\n      this.deleteCurrentNodes()\n      this.app.selection.setMultiplexSelectNodes(this.beingCopySelectedNodes)\n      this.app.selection.emitChange()\n    }\n  }\n\n  // Paste the copied or cut graphic object\n  pasteCurrentNode(useCurrentEventPos = false) {\n    let pos = null\n    if (useCurrentEventPos) {\n      const { x } = this.app.event.lastMousePos\n      const { y } = this.app.event.lastMousePos\n      pos = {\n        x,\n        y\n      }\n    }\n    if (this.beingCopyNode) {\n      this.copyNode(this.beingCopyNode, false, pos as any).then(() => {})\n    } else if (this.beingCopySelectedNodes.length > 0) {\n      this.app.selection.copySelectionNodes(useCurrentEventPos ? pos : null)\n    }\n  }\n\n  // Deleting graphic objects\n  deleteNode(node: any) {\n    this.app.nodes.deleteNode(node)\n    this.render()\n    this.app.emitChange()\n  }\n\n  // Copy and paste graphic objects\n  async copyNode(node: any, notActive?: boolean, pos?: { x: any; y: any }) {\n    this.app.nodes.cancelActiveNode()\n    await this.app.nodes.copyNode(node, notActive, pos)\n    this.render()\n    this.app.emitChange()\n  }\n\n  // Delete the currently active graphic object\n  deleteActiveNode() {\n    if (!this.app.nodes.hasActiveNode()) {\n      return\n    }\n    this.deleteNode(this.app.nodes.activeNode)\n  }\n\n  // Delete the currently active or selected graphic object\n  deleteCurrentNodes() {\n    this.deleteActiveNode()\n    this.app.selection.deleteSelectedNodes()\n  }\n\n  // Cancel the currently active graphic object\n  cancelActiveNode() {\n    if (!this.app.nodes.hasActiveNode()) {\n      return this\n    }\n    this.app.nodes.cancelActiveNode()\n    this.render()\n    return this\n  }\n\n  // Update the position of the currently active graphic object\n  updateActiveNodePosition(x: number, y: number) {\n    if (!this.app.nodes.hasActiveNode()) {\n      return this\n    }\n    this.app.nodes.activeNode.updatePos(x, y)\n    this.render()\n    return this\n  }\n\n  // Update the size of the currently active graphic object\n  updateActiveNodeSize(width: number, height: number) {\n    if (!this.app.nodes.hasActiveNode()) {\n      return this\n    }\n    this.app.nodes.activeNode.updateSize(width, height)\n    this.render()\n    return this\n  }\n\n  // Update the rotation angle of the currently active graphic object\n  updateActiveNodeRotate(rotate: number) {\n    if (!this.app.nodes.hasActiveNode()) {\n      return this\n    }\n    this.app.nodes.activeNode.updateRotate(rotate)\n    this.render()\n    return this\n  }\n\n  // Emptying a graphic object\n  empty() {\n    this.app.nodes.deleteAllNodes()\n    this.render()\n    this.app.emitChange()\n  }\n\n  // Enlarge\n  zoomIn(num = 0.1) {\n    if (this.app.state.scale) {\n      this.app.updateState({\n        scale: this.app.state.scale + num\n      } as any)\n      this.render()\n      this.app.emit('zoomChange', this.app.state.scale)\n    }\n  }\n\n  // Reduction\n  zoomOut(num = 0.1) {\n    if (this.app.state.scale) {\n      this.app.updateState({\n        scale: this.app.state.scale - num > 0 ? this.app.state.scale - num : 0\n      } as any)\n      this.render()\n      this.app.emit('zoomChange', this.app.state.scale)\n    }\n  }\n\n  // Set the specified zoom value\n  setZoom(zoom: number) {\n    if (zoom < 0 || zoom > 1) {\n      return\n    }\n    this.app.updateState({\n      scale: zoom\n    } as any)\n    this.render()\n    this.app.emit('zoomChange', this.app.state.scale)\n  }\n\n  // Scaling to fit all graphic objects\n  fit() {\n    if (!this.app.nodes.hasNodes()) {\n      return\n    }\n    this.scrollToCenter()\n    const { minX, maxX, minY, maxY } = getMultiplexNodeRectInfo(\n      this.app.nodes.nodeList\n    )\n    const width = maxX - minX\n    const height = maxY - minY\n    const maxScale = Math.min(this.app.width / width, this.app.height / height)\n    this.setZoom(maxScale)\n  }\n\n  // Scroll to the specified position\n  scrollTo(scrollX: number, scrollY: number) {\n    this.app.updateState({\n      scrollX,\n      scrollY\n    } as any)\n    this.render()\n    this.app.emit(\n      'scrollChange',\n      this.app.state.scrollX,\n      this.app.state.scrollY\n    )\n  }\n\n  // Scroll to centre, i.e. back to the centre of all graphic objects\n  scrollToCenter() {\n    if (!this.app.nodes.hasNodes()) {\n      this.scrollTo(0, 0)\n      return\n    }\n    const { minX, maxX, minY, maxY } = getMultiplexNodeRectInfo(\n      this.app.nodes.nodeList\n    )\n    const width = maxX - minX\n    const height = maxY - minY\n    this.scrollTo(\n      minX - (this.app.width - width) / 2,\n      minY - (this.app.height - height) / 2\n    )\n  }\n\n  // Copy and paste the current graphic object\n  copyPasteCurrentNodes() {\n    this.copyCurrentNode()\n    this.pasteCurrentNode()\n  }\n\n  // Set the background colour\n  setBackgroundColor(color: string) {\n    this.app.updateState({\n      backgroundColor: color\n    } as any)\n    this.app.background.set()\n  }\n\n  // Select all graphic objects\n  selectAll() {\n    this.app.selection.selectNodes(this.app.nodes.nodeList)\n  }\n}\n","import { AppObject } from '../../types'\n\nexport default class Calculate {\n  private readonly app: AppObject\n\n  constructor(app: AppObject) {\n    this.app = app\n  }\n\n  // Conversion of screen coordinates to canvas coordinates\n  transformToCanvasCalculate(x: number, y: number) {\n    x -= this.app.width / 2\n    y -= this.app.height / 2\n    return {\n      x,\n      y\n    }\n  }\n\n  // Object position attached to grid\n  gridAdsorbent(x: number, y: number) {\n    const { gridConfig, showGrid } = this.app.state\n    if (typeof gridConfig === 'undefined') {\n      return {}\n    }\n    if (!showGrid) {\n      return {\n        x,\n        y\n      }\n    }\n    const gridSize = gridConfig.size\n    if (typeof gridSize === 'undefined') {\n      return {}\n    }\n    return {\n      x: x - (x % gridSize),\n      y: y - (y % gridSize)\n    }\n  }\n\n  // Add vertical scroll distance\n  addScrollY(y: number) {\n    if (typeof this.app.state.scrollY === 'undefined') {\n      return 0\n    }\n    return this.app.state.scrollY + y\n  }\n\n  // Add horizontal scroll distance\n  addScrollX(x: number) {\n    if (typeof this.app.state.scrollX === 'undefined') {\n      return 0\n    }\n    return this.app.state.scrollX + x\n  }\n\n  // minus vertical scroll distance\n  subScrollY(y: number) {\n    if (typeof this.app.state.scrollY === 'undefined') {\n      return 0\n    }\n    return y - this.app.state.scrollY\n  }\n\n  // minus horizontal rolling distance\n  subScrollX(x: number) {\n    if (typeof this.app.state.scrollX === 'undefined') {\n      return 0\n    }\n    return x - this.app.state.scrollX\n  }\n\n  // Canvas conversion to screen coordinates\n  transformToScreenCalculate(x: number, y: number) {\n    x += this.app.width / 2\n    y += this.app.height / 2\n    return {\n      x,\n      y\n    }\n  }\n\n  // Integrated conversion, screen coordinates to canvas coordinates minus scroll values\n  transform(x: number, y: number) {\n    const t = this.transformToCanvasCalculate(x, y)\n    return {\n      x: this.subScrollX(t.x),\n      y: this.subScrollY(t.y)\n    }\n  }\n\n  // For when the container is not full screen, convert coordinates relative to the container to relative to the window\n  mountELToWindow(x: number, y: number) {\n    return {\n      x: x + this.app.left,\n      y: y + this.app.top\n    }\n  }\n\n  // For when the container is not full screen, Convert coordinates relative to the window to relative to the container\n  windowToContainer(x: number, y: number) {\n    return {\n      x: x - this.app.left,\n      y: y - this.app.top\n    }\n  }\n\n  // The position of the screen coordinates after applying canvas scaling\n  scale(x: number, y: number) {\n    const { state } = this.app\n    if (typeof state.scale === 'undefined') {\n      return {}\n    }\n    const wp = this.transformToCanvasCalculate(x, y)\n    const sp = this.transformToScreenCalculate(\n      wp.x * state.scale,\n      wp.y * state.scale\n    )\n    return {\n      x: sp.x,\n      y: sp.y\n    }\n  }\n\n  // The position of the screen coordinates after applying the canvas zoom in reverse\n  reverseScale(x: number, y: number) {\n    const { state } = this.app\n    if (typeof state.scale === 'undefined') {\n      return {}\n    }\n    const tp = this.transformToCanvasCalculate(x, y)\n    const sp = this.transformToScreenCalculate(\n      tp.x / state.scale,\n      tp.y / state.scale\n    )\n    return {\n      x: sp.x,\n      y: sp.y\n    }\n  }\n}\n","import {\n  getMultiplexNodeRectInfo,\n  getNodeCenterCoordinate,\n  getTowCoordinateRotate\n} from '../common/utils'\nimport BaseNode from '../support/BaseNode'\nimport DragNode from '../support/DragNode'\nimport { AppObject, Node, NodeArray } from '../types'\n\nexport default class MultiplexSelectNode extends BaseNode {\n  selectedNodeList: NodeArray\n\n  public wholeCenterPos: { x: number; y: number }\n\n  constructor(options: Node, app: AppObject) {\n    super(options, app)\n\n    this.dragNode = new DragNode(this as any, this.app)\n\n    this.selectedNodeList = []\n\n    this.wholeCenterPos = { x: 0, y: 0 }\n  }\n\n  // Filtering out deleted graphic objects\n  updateNodes(nodes: NodeArray) {\n    const exists: NodeArray = []\n    this.selectedNodeList.forEach((node) => {\n      if (nodes.includes(node)) {\n        exists.push(node)\n      }\n    })\n    this.setSelectedNodeList(exists)\n  }\n\n  // Calculate size and position\n  // @ts-ignore\n  updateRect() {\n    if (this.selectedNodeList.length <= 0) {\n      super.updateRect(0, 0, 0, 0)\n      return\n    }\n    const { minX, maxX, minY, maxY } = getMultiplexNodeRectInfo(\n      this.selectedNodeList\n    )\n    super.updateRect(minX, minY, maxX - minX, maxY - minY)\n  }\n\n  // In adjustment\n  // @ts-ignore\n  resize(...args: any) {\n    this.selectedNodeList.forEach((node: Node) => {\n      if (node.dragNode && node.dragNode.resizeType === 'rotate') {\n        // \n        this.handleRotate(node, ...args)\n      } else {\n        node?.resize?.(...args)\n      }\n    })\n  }\n\n  // Rotating graphic objects\n  handleRotate(node: Node, e?: any, mx?: number, my?: number) {\n    const rotate = getTowCoordinateRotate(\n      this.wholeCenterPos.x,\n      this.wholeCenterPos.y,\n      e.clientX,\n      e.clientY,\n      <number>mx,\n      <number>my\n    )\n    node.rotateByCenter?.(rotate, this.wholeCenterPos.x, this.wholeCenterPos.y)\n  }\n\n  // End of adjustment\n  // @ts-ignore\n  endResize() {\n    this.selectedNodeList.forEach((node) => {\n      node.endResize?.()\n    })\n  }\n\n  // Set the selected graphic object list\n  setSelectedNodeList(list: NodeArray) {\n    this.selectedNodeList.forEach((node) => {\n      node.isSelected = false\n    })\n    this.selectedNodeList = list\n    this.selectedNodeList.forEach((node) => {\n      node.isSelected = true\n    })\n  }\n\n  // Start of adjustment\n  // @ts-ignore\n  startResize(...args: any) {\n    this.selectedNodeList.forEach((node) => {\n      if (args[0] === 'rotate') {\n        // \n        this.wholeCenterPos = getNodeCenterCoordinate(this as any)\n      }\n      node.startResize?.(...args)\n    })\n  }\n\n  render() {\n    if (this.width && this.height && this.selectedNodeList.length > 0) {\n      if (this.width <= 0 || this.height <= 0) {\n        return\n      }\n      this.dragNode.render()\n    }\n  }\n}\n","import { DRAG_NODE_PARTS } from '../common/constants'\nimport { getBoundingRect, throttle } from '../common/utils'\nimport Calculate from '../common/utils/Calculate'\nimport MultiplexSelectNode from '../components/MultiplexSelectNode'\nimport Rectangle from '../components/Rectangle'\nimport Canvas from '../support/Canvas'\nimport { AppObject, Ctx, Node, NodeArray, State } from '../types'\n\nexport default class Selection {\n  public app: AppObject\n\n  public canvas: any\n\n  public ctx: Ctx | undefined\n\n  public createSelection: boolean\n\n  hasSelection: boolean\n\n  public isResize: boolean\n\n  public state: State\n\n  public width: number\n\n  public height: number\n\n  public calculate: Calculate\n\n  public rectangle: Rectangle\n\n  public multiplexSelectNode: MultiplexSelectNode\n\n  constructor(app: AppObject) {\n    this.app = app\n\n    this.canvas = null\n\n    this.ctx = undefined\n\n    // Is a selection currently being created\n    this.createSelection = false\n\n    // Whether there is currently a multiple selection of graphic objects\n    this.hasSelection = false\n\n    // Whether the selected graphic object is currently being adjusted\n    this.isResize = false\n\n    this.state = this.app.state\n\n    this.width = this.app.width\n\n    this.height = this.app.height\n\n    this.calculate = new Calculate(this as unknown as AppObject)\n\n    // Selection Rectangle\n    this.rectangle = new Rectangle(\n      {\n        type: 'rectangle',\n        style: {\n          strokeStyle: 'rgba(9,132,227,0.3)',\n          fillStyle: 'rgba(9,132,227,0.3)'\n        }\n      } as any,\n      this as any\n    )\n\n    // Virtual graphic object of the selected graphic object for displaying the drag and drop box\n    this.multiplexSelectNode = new MultiplexSelectNode(\n      {\n        type: 'multiplexSelectNode'\n      } as any,\n      this as any\n    )\n\n    // @ts-ignore\n    this.checkInNodes = throttle(this.checkInNodes, this, 20)\n\n    // A little relief from lag\n    this.handleResize = throttle(this.handleResize, this as any, 15)\n\n    this.init()\n\n    this.bindEvent()\n  }\n\n  // Detection of nodes in the selection\n  checkInNodes(e: any, event: any) {\n    const minX = Math.min(event.mousedownPos.x, e.clientX)\n    const minY = Math.min(event.mousedownPos.y, e.clientY)\n    const maxX = Math.max(event.mousedownPos.x, e.clientX)\n    const maxY = Math.max(event.mousedownPos.y, e.clientY)\n    const selectedNodeList: any[] | undefined = []\n    this.app.nodes.nodeList.forEach((node: Node) => {\n      let _minX = Infinity\n      let _maxX = -Infinity\n      let _minY = Infinity\n      let _maxY = -Infinity\n      const endCoordinateList = node?.getEndCoordinateList?.()\n      const rect: any = getBoundingRect(\n        endCoordinateList.map((coordinate: { x: number; y: number }) => [\n          coordinate.x,\n          coordinate.y\n        ]),\n        true\n      )\n      rect.forEach(({ x, y }: any) => {\n        if (x < _minX) {\n          _minX = x\n        }\n        if (x > _maxX) {\n          _maxX = x\n        }\n        if (y < _minY) {\n          _minY = y\n        }\n        if (y > _maxY) {\n          _maxY = y\n        }\n      })\n      if (_minX >= minX && _maxX <= maxX && _minY >= minY && _maxY <= maxY) {\n        selectedNodeList.push(node)\n      }\n    })\n    this.setMultiplexSelectNodes(selectedNodeList, true)\n    this.app.render.render()\n  }\n\n  // Detects if the specified position is on the graphic object adjustment handle\n  checkInResizeHand(x: any, y: any) {\n    return this.multiplexSelectNode.dragNode.checkCoordinateInDragNodeWhere(\n      x,\n      y\n    )\n  }\n\n  // Delete the currently selected graphic object\n  deleteSelectedNodes() {\n    this.getSelectionNodes().forEach((node: Node) => {\n      this.app.nodes.deleteNode(node)\n    })\n    this.selectNodes([])\n    this.app.emitChange()\n  }\n\n  // Whether the selected graphic object currently exists\n  hasSelectionNodes() {\n    return this.getSelectionNodes().length > 0\n  }\n\n  // Get the currently selected graphic object\n  getSelectionNodes() {\n    return this.multiplexSelectNode.selectedNodeList\n  }\n\n  // Copy the currently selected graphic objects\n  async copySelectionNodes(pos: { x: number; y: number }) {\n    const task = this.getSelectionNodes().map((node) =>\n      this.app.nodes.copyNode(node, true)\n    )\n    const nodes = await Promise.all(task)\n    this.setMultiplexSelectNodes(nodes)\n    // Paste to the specified location\n    if (pos) {\n      this.multiplexSelectNode.startResize(DRAG_NODE_PARTS.BODY)\n      if (\n        !this.multiplexSelectNode.x ||\n        !this.multiplexSelectNode.y ||\n        !this.multiplexSelectNode.width ||\n        !this.multiplexSelectNode.height\n      ) {\n        // eslint-disable-next-line no-console\n        console.error('multiplexSelectNode x or y or width or height is null')\n        return\n      }\n      const ox =\n        pos.x - this.multiplexSelectNode.x - this.multiplexSelectNode.width / 2\n      const oy =\n        pos.y - this.multiplexSelectNode.y - this.multiplexSelectNode.height / 2\n      // If the grid is turned on, then the coordinates are to be attached to the grid\n      const gridAdsorbentPos = this.app.calculate.gridAdsorbent(ox, oy)\n      this.multiplexSelectNode.resize(\n        null,\n        null,\n        null,\n        gridAdsorbentPos.x,\n        gridAdsorbentPos.y\n      )\n      this.multiplexSelectNode.endResize()\n      this.multiplexSelectNode.updateRect()\n    }\n    this.app.render.render()\n    this.renderSelection()\n    this.app.emitChange()\n  }\n\n  // Check if a graphic object adjustment operation is required\n  checkIsResize(x: number, y: number, e: any) {\n    if (!this.hasSelection) {\n      return false\n    }\n    const hand =\n      this.multiplexSelectNode.dragNode.checkCoordinateInDragNodeWhere(x, y)\n    if (hand) {\n      this.isResize = true\n      this.multiplexSelectNode.startResize(hand, e)\n      this.app.cursor.setResize(hand)\n      return true\n    }\n    return false\n  }\n\n  // Performing graphic object adjustment operations\n  handleResize(...args: any[]) {\n    if (!this.isResize) {\n      return\n    }\n    this.multiplexSelectNode.resize(...args)\n    this.app.render.render()\n    this.multiplexSelectNode.updateRect()\n    this.renderSelection()\n  }\n\n  // Ending a graphic object adjustment operation\n  endResize() {\n    this.isResize = false\n    this.multiplexSelectNode.endResize()\n  }\n\n  // Styling of multi-selected graphic objects\n  setSelectedNodeStyle(style = {}) {\n    if (!this.hasSelectionNodes()) {\n      return\n    }\n    Object.keys(style).forEach((key) => {\n      this.getSelectionNodes().forEach((node) => {\n        // @ts-ignore\n        node.style[key] = style[key]\n      })\n    })\n    this.app.render.render()\n    this.app.emitChange()\n  }\n\n  // Select the specified graphic object\n  selectNodes(nodes = []) {\n    this.hasSelection = nodes.length > 0\n    this.setMultiplexSelectNodes(nodes)\n    this.app.render.render()\n    this.renderSelection()\n    this.emitChange()\n  }\n\n  cancelSelectNodes() {\n    this.selectNodes([])\n  }\n\n  // Set the selected graphic object\n  setMultiplexSelectNodes(nodes: NodeArray = [], notUpdateRect?: boolean) {\n    this.multiplexSelectNode.setSelectedNodeList(nodes)\n    if (!notUpdateRect) {\n      this.multiplexSelectNode.updateRect()\n    }\n  }\n\n  emitChange() {\n    this.app.emit('multiplexSelectChange', this.getSelectionNodes())\n  }\n\n  bindEvent() {\n    this.app.on('change', () => {\n      this.state = this.app.state\n      this.multiplexSelectNode.updateNodes(this.app.nodes.nodeList)\n      this.renderSelection()\n    })\n    this.app.on('scrollChange', () => {\n      this.renderSelection()\n    })\n    this.app.on('zoomChange', () => {\n      this.renderSelection()\n    })\n  }\n\n  onMousedown(\n    e: { originEvent: { which: number } },\n    event: { mousedownPos: { x: number; y: number } }\n  ) {\n    if (e.originEvent.which !== 1) {\n      return\n    }\n    this.createSelection = true\n    this.rectangle.updatePos(event.mousedownPos.x, event.mousedownPos.y)\n  }\n\n  onMousemove(e: number, event: { mouseOffset: { x: number; y: number } }) {\n    if (\n      Math.abs(event.mouseOffset.x) <= 10 &&\n      Math.abs(event.mouseOffset.y) <= 10\n    ) {\n      return\n    }\n    this.onMove(e, event)\n  }\n\n  onMouseup() {\n    this.createSelection = false\n    this.rectangle.updateRect(0, 0, 0, 0)\n    // \n    this.hasSelection = this.hasSelectionNodes()\n    this.multiplexSelectNode.updateRect()\n    this.renderSelection()\n    this.emitChange()\n  }\n\n  // Mouse movement events\n  onMove(e: number, event: { mouseOffset: { x: number; y: number } }) {\n    this.rectangle.updateSize(event.mouseOffset.x, event.mouseOffset.y)\n    this.renderSelection()\n    this.checkInNodes(e, event)\n  }\n\n  reset() {\n    this.setMultiplexSelectNodes([])\n    this.hasSelection = false\n    this.renderSelection()\n    this.emitChange()\n  }\n\n  renderSelection() {\n    this.canvas.clearCanvas()\n    this.ctx?.save()\n    if (this.app.state.scale) {\n      this.ctx?.scale(this.app.state.scale, this.app.state.scale)\n    }\n    this.rectangle.render()\n    this.multiplexSelectNode.render()\n    this.ctx?.restore()\n  }\n\n  init() {\n    if (this.canvas) {\n      this.app.mountEL.removeChild(this.canvas.el)\n    }\n    this.width = this.app.width\n    this.height = this.app.height\n    this.canvas = new Canvas(this.width, this.height, {\n      className: 'selection'\n    })\n    this.ctx = this.canvas.ctx\n    this.app.mountEL.appendChild(this.canvas.el)\n  }\n}\n","import EventEmitter from 'eventemitter3'\n\nimport { getFontString, getTextNodeSize } from '../common/utils'\nimport { AppObject } from '../types'\n\nexport default class TextEdit extends EventEmitter {\n  private readonly app: AppObject\n\n  private editable: undefined | HTMLTextAreaElement\n\n  isEditing: boolean\n\n  constructor(app: AppObject) {\n    super()\n    this.app = app\n    this.editable = undefined\n    this.isEditing = false\n    this.onTextInput = this.onTextInput.bind(this)\n    this.onTextBlur = this.onTextBlur.bind(this)\n  }\n\n  // Show text edit box\n  showTextEdit() {\n    if (!this.editable) {\n      this.crateTextInputEl()\n    } else {\n      this.editable.style.display = 'block'\n    }\n    if (typeof this.editable === 'undefined') {\n      return\n    }\n    this.updateTextInputStyle()\n    this.editable.focus()\n    this.editable.select()\n    this.isEditing = true\n  }\n\n  // Text input events\n  onTextInput() {\n    const { activeNode } = this.app.nodes\n    if (!activeNode) {\n      return\n    }\n    if (typeof this.editable === 'undefined') {\n      return\n    }\n    activeNode.text = this.editable.value\n    const { width, height } = getTextNodeSize(activeNode)\n    activeNode.width = width\n    activeNode.height = height\n    this.updateTextInputStyle()\n  }\n\n  // Text box out-of-focus event\n  onTextBlur() {\n    if (typeof this.editable === 'undefined') {\n      return\n    }\n    this.editable.style.display = 'none'\n    this.editable.value = ''\n    this.emit('blur')\n    this.isEditing = false\n  }\n\n  // Create text input box graphic objects\n  crateTextInputEl() {\n    this.editable = document.createElement('textarea')\n    this.editable.dir = 'auto'\n    this.editable.tabIndex = 0\n    this.editable.wrap = 'off'\n    this.editable.className = 'textInput'\n    Object.assign(this.editable.style, {\n      position: 'fixed',\n      display: 'block',\n      minHeight: '1em',\n      backfaceVisibility: 'hidden',\n      margin: 0,\n      padding: 0,\n      border: 0,\n      outline: 0,\n      resize: 'none',\n      background: 'transparent',\n      overflow: 'hidden',\n      whiteSpace: 'pre'\n    })\n    this.editable.addEventListener('input', this.onTextInput)\n    this.editable.addEventListener('blur', this.onTextBlur)\n    document.body.appendChild(this.editable)\n  }\n\n  // Update the style of the text input box according to the style of the current text graphic object\n  updateTextInputStyle() {\n    const { activeNode } = this.app.nodes\n    if (!activeNode) {\n      return\n    }\n    if (typeof this.editable === 'undefined') {\n      return\n    }\n    let { x, y }: any = activeNode\n    const { width, height, style, text, rotate }: any = activeNode\n    const { calculate, state } = this.app\n    this.editable.value = text\n    x = calculate.subScrollX(x)\n    y = calculate.subScrollY(y)\n    if (typeof state.scale === 'undefined') {\n      return\n    }\n    // Screen coordinates to canvas coordinates\n    const sp = calculate.scale(x, y)\n    const tp = calculate.mountELToWindow(sp.x, sp.y)\n    const fontSize = style.fontSize * state.scale\n    const styles = {\n      font: getFontString(fontSize, style.fontFamily),\n      lineHeight: `${fontSize * style.lineHeightRatio}px`,\n      left: `${tp.x}px`,\n      top: `${tp.y}px`,\n      color: style.fillStyle,\n      width: `${Math.max(width, 100) * state.scale}px`,\n      height: `${height * state.scale}px`,\n      transform: `rotate(${rotate}deg)`,\n      opacity: style.globalAlpha\n    }\n    Object.assign(this.editable.style, styles)\n  }\n}\n","import ArbitraryPlot from './ArbitraryPlot'\nimport Arrow from './Arrow'\nimport Circle from './Circle'\nimport Diamond from './Diamond'\nimport Image from './Image'\nimport Line from './Line'\nimport MultiplexSelectNode from './MultiplexSelectNode'\nimport Rectangle from './Rectangle'\nimport Text from './Text'\nimport Triangle from './Triangle'\n\nexport default {\n  ArbitraryPlot,\n  Arrow,\n  Circle,\n  Diamond,\n  Image,\n  Line,\n  MultiplexSelectNode,\n  Rectangle,\n  Text,\n  Triangle\n}\n","import EventEmitter from 'eventemitter3'\nimport { diff, patch } from 'jsondiffpatch'\n\nimport Author from './classFile/Author'\nimport Background from './classFile/Background'\nimport Cursor from './classFile/Cursor'\nimport Event from './classFile/Event'\nimport Export from './classFile/Export'\nimport Grid from './classFile/Grid'\nimport History from './classFile/History'\nimport ImageEdit from './classFile/ImageEdit'\nimport KeyCommand from './classFile/KeyCommand'\nimport Nodes from './classFile/Nodes'\nimport Render from './classFile/Render'\nimport Selection from './classFile/Selection'\nimport TextEdit from './classFile/TextEdit'\nimport {\n  createCanvas,\n  createImageObj,\n  getTowCoordinateDistance,\n  throttle\n} from './common/utils'\nimport * as utils from './common/utils'\nimport Calculate from './common/utils/Calculate'\nimport * as checkClick from './common/utils/checkClick'\nimport nodes from './components'\nimport * as plot from './support/plot'\nimport {\n  Ctx,\n  LocalData,\n  Node,\n  NodeArray,\n  OnCallBack,\n  PlotType,\n  State\n} from './types'\n\ntype Options = {\n  mountEL: HTMLElement | HTMLDivElement\n  plotType?: PlotType\n  state?: State\n}\n\nclass CreatLoader extends EventEmitter {\n  public options: Options\n\n  public readonly mountEL: HTMLElement | HTMLDivElement\n\n  public plotType: any\n\n  public width: number\n\n  public height: number\n\n  public left: number\n\n  public top: number\n\n  public canvas: HTMLCanvasElement | undefined\n\n  public ctx: Ctx | undefined\n\n  public state: State\n\n  public calculate: Calculate\n\n  public event: Event\n\n  public keyCommand: KeyCommand\n\n  public imageEdit: ImageEdit\n\n  public textEdit: TextEdit\n\n  public cursor: Cursor\n\n  public history: History\n\n  public export: Export\n\n  public background: Background\n\n  public selection: Selection\n\n  public grid: Grid\n\n  public author: Author\n\n  public nodes: any\n\n  public render: Render\n\n  public watch: any\n\n  static utils: any\n\n  static checkClick: any\n\n  static plot: any\n\n  static nodes: any\n\n  constructor(options: Options) {\n    super()\n\n    this.options = options\n\n    this.mountEL = options.mountEL\n\n    this.plotType = options.plotType || 'selection'\n\n    // Container width and height position information\n    this.width = 0\n    this.height = 0\n    this.left = 0\n    this.top = 0\n\n    // Main rendering canvas graphics objects\n    this.canvas = undefined\n\n    // canvas drawing context\n    this.ctx = undefined\n\n    // Canvas state\n    this.state = {\n      // resizing\n      scale: 1,\n      // Scroll offset in horizontal direction\n      scrollX: 0,\n      // Scroll offset in vertical direction\n      scrollY: 0,\n      // Rolling step\n      scrollStep: 25,\n      // Background colour\n      backgroundColor: '',\n      // Whether to display the grid or not\n      showGrid: false,\n      // Is it read-only mode\n      readonly: false,\n      // Default colour\n      defaultColor: '#000000',\n      // Grid configuration\n      gridConfig: {\n        // Grid size\n        size: 20,\n        // Grid line colours\n        strokeStyle: '#dfe0e1',\n        // Mesh line width\n        lineWidth: 1\n      },\n      // Coverage\n      ...(options.state || {})\n    } as any\n\n    this.initCanvas()\n\n    this.calculate = new Calculate(this as any)\n\n    this.event = new Event(this as any)\n    this.event.on('mousedown', this.onMousedown, this)\n    this.event.on('mousemove', this.onMousemove, this)\n    this.event.on('mouseup', this.onMouseup, this)\n    this.event.on('dblclick', this.onDblclick, this)\n    this.event.on('mousewheel', this.onMousewheel, this)\n    this.event.on('contextmenu', this.onContextmenu, this)\n\n    this.keyCommand = new KeyCommand(this as any)\n\n    this.imageEdit = new ImageEdit(this as any)\n    this.imageEdit.on('imageSelectChange', this.onImageSelectChange, this)\n\n    this.textEdit = new TextEdit(this as any)\n    this.textEdit.on('blur', this.onTextInputBlur, this)\n\n    this.cursor = new Cursor(this as any)\n\n    this.history = new History(this as any)\n\n    this.export = new Export(this as any)\n\n    this.background = new Background(this as any)\n\n    this.selection = new Selection(this as any)\n\n    this.grid = new Grid(this as any)\n\n    this.nodes = new Nodes(this as any)\n\n    this.render = new Render(this as any)\n\n    this.author = new Author(this as any)\n\n    this.mountFunction()\n\n    this.checkIsOnNode = throttle(this.checkIsOnNode, this as any)\n\n    this.emitChange()\n\n    this.helpUpdate()\n\n    this.watch = {\n      zoomChange: (callback: OnCallBack) => this.on('zoomChange', callback),\n      scrollChange: (callback: OnCallBack) => this.on('scrollChange', callback),\n      currentTypeChange: (callback: OnCallBack) =>\n        this.on('currentTypeChange', callback),\n      shuttle: (callback: OnCallBack) => this.on('shuttle', callback),\n      activeNodeChange: (callback: OnCallBack) =>\n        this.on('activeNodeChange', callback),\n      multiplexSelectChange: (callback: OnCallBack) =>\n        this.on('multiplexSelectChange', callback),\n      contextmenu: (callback: OnCallBack) => this.on('contextmenu', callback),\n      diffNodesChange: (callback: OnCallBack) =>\n        this.on('diffNodesChange', callback),\n      diffStateChange: (callback: OnCallBack) =>\n        this.on('diffStateChange', callback),\n      localDataChange: (callback: OnCallBack) => this.on('change', callback),\n      nodeRotateChange: (callback: OnCallBack) =>\n        this.on('nodeRotateChange', callback)\n    }\n  }\n\n  mountFunction() {\n    ;['exportImage', 'exportJson'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.export[method].bind(this.export)\n    })\n    ;['showGrid', 'hideGrid', 'updateGrid'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.grid[method].bind(this.grid)\n    })\n    ;['setEditAuthor', 'setReadonlyAuthor'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.author[method].bind(this.author)\n    })\n    ;['undo', 'redo'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.history[method].bind(this.history)\n    })\n    ;['unBindEvent', 'bindEvent'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.keyCommand[method].bind(this.keyCommand)\n    })\n    ;['setSelectedNodeStyle', 'cancelSelectNodes'].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.selection[method].bind(this.selection)\n    })\n    ;[\n      'updateActiveNodeRotate',\n      'updateActiveNodeSize',\n      'updateActiveNodePosition',\n      'cancelActiveNode',\n      'scrollToCenter',\n      'copyPasteCurrentNodes',\n      'empty',\n      'zoomIn',\n      'zoomOut',\n      'setZoom',\n      'selectAll',\n      'fit',\n      'deleteActiveNode',\n      'deleteCurrentNodes',\n      'setBackgroundColor',\n      'copyNode',\n      'copyCurrentNode',\n      'deleteNode',\n      'setActiveNodeStyle',\n      'setCurrentNodesStyle',\n      'scrollTo',\n      'cutCurrentNode',\n      'pasteCurrentNode'\n    ].forEach((method) => {\n      // @ts-ignore\n      this[method] = this.render[method].bind(this.render)\n    })\n  }\n\n  // Access to data, including state data and graphical object data\n  getData() {\n    return {\n      state: {\n        ...this.state\n      },\n      nodes: this.nodes.serialize()\n    }\n  }\n\n  // Image selection events\n  onImageSelectChange() {\n    this.cursor.hide()\n  }\n\n  // Get container size location information\n  getContainerRectInfo() {\n    const { width, height, left, top } = this.mountEL.getBoundingClientRect()\n    this.width = width\n    this.height = height\n    this.left = left\n    this.top = top\n  }\n\n  // Rendering as necessary\n  helpUpdate() {\n    if (this.state.readonly) {\n      // @ts-ignore\n      this.setReadonlyAuthor()\n    }\n    if (this.state.showGrid) {\n      this.grid.showGrid()\n    }\n    this.background.set()\n  }\n\n  // Setting data, including status data and graphic object data\n  async setData(\n    { state = {}, nodes = [] }: any,\n    noEmitChange: boolean,\n    noDiffData?: boolean\n  ) {\n    this.state = state\n\n    const nowNs = nodes.map(async (node: Node) => {\n      if (node.type === 'image') {\n        return {\n          ...node,\n          imageObj: await createImageObj(<string>node.url)\n        }\n      }\n      return node\n    })\n\n    const nNS: any[] = []\n\n    for (const n of nowNs) {\n      // eslint-disable-next-line no-await-in-loop\n      nNS.push(await n)\n    }\n\n    this.helpUpdate()\n    this.nodes.deleteAllNodes().createNodesFromData(nNS)\n    this.render.render()\n    if (!noEmitChange) {\n      this.emitChange(noDiffData)\n    }\n  }\n\n  initCanvas() {\n    this.getContainerRectInfo()\n    if (this.canvas) {\n      this.mountEL.removeChild(this.canvas)\n    }\n    const { canvas, ctx }: any = createCanvas(this.width, this.height, {\n      className: 'main'\n    })\n    this.canvas = canvas\n    this.ctx = ctx\n    this.mountEL.appendChild(this.canvas as any)\n  }\n\n  // Container resizing\n  resize() {\n    this.initCanvas()\n    this.render.render()\n    this.selection.init()\n    this.grid.init()\n    this.grid.renderGrid()\n  }\n\n  // Updating the state data only updates the state data and does not trigger a render\n  updateState(data = {}) {\n    this.state = {\n      ...this.state,\n      ...data\n    }\n    this.emitChange(undefined, true)\n  }\n\n  // Update current drawing type\n  updateCurrentType(plotType: PlotType) {\n    this.plotType = plotType\n    if (this.plotType === 'image') {\n      this.imageEdit.selectImage()\n    }\n    if (this.plotType === 'eraser') {\n      this.cursor.setEraser()\n      // @ts-ignore\n      this.cancelActiveNode()\n    } else if (this.plotType === 'text') {\n      this.cursor.setText()\n    } else if (this.plotType !== 'selection') {\n      this.cursor.setCrossHair()\n    } else {\n      this.cursor.reset()\n    }\n    this.emit('currentTypeChange', this.plotType)\n  }\n\n  // Mouse press event\n  onMousedown(\n    e: {\n      unGridClientX?: number\n      unGridClientY?: number\n      originEvent?: { which: number }\n    },\n    event: { mousedownPos: any }\n  ) {\n    if (this.state.readonly || this.author.isDragAuthor) {\n      this.author.onStart()\n      return\n    }\n    if (!this.nodes.isCreateNode && !this.textEdit.isEditing) {\n      const clickNode = this.nodes.checkIsClickNode(e)\n      if (this.plotType === 'selection') {\n        if (this.nodes.hasActiveNode()) {\n          const isResize = this.nodes.checkIsResize(\n            event.mousedownPos.unGridClientX,\n            event.mousedownPos.unGridClientY,\n            e\n          )\n          if (!isResize) {\n            this.nodes.setActiveNode(clickNode as any)\n            this.render.render()\n          }\n        } else if (this.selection.hasSelection) {\n          const isResize = this.selection.checkIsResize(\n            event.mousedownPos.unGridClientX,\n            event.mousedownPos.unGridClientY,\n            e\n          )\n          if (!isResize) {\n            this.selection.reset()\n            this.nodes.setActiveNode(clickNode as any)\n            this.render.render()\n          }\n        } else if (clickNode) {\n          this.nodes.setActiveNode(clickNode)\n          this.render.render()\n          this.onMousedown(e, event)\n        } else {\n          this.selection.onMousedown(e as any, event)\n        }\n      } else if (this.plotType === 'eraser') {\n        // @ts-ignore\n        this.deleteNode(clickNode)\n      }\n    }\n  }\n\n  // Mouse movement events\n  onMousemove(e: any, event: any) {\n    // TODO : Real-time synchronisation, currently on mouse up, expected to be on mouse over\n    if (this.state.readonly || this.author.isDragAuthor) {\n      if (event.isMousedown) {\n        this.author.onMove(e, event)\n      }\n      return\n    }\n    if (event.isMousedown) {\n      const mx = event.mousedownPos.x\n      const my = event.mousedownPos.y\n      const offsetX = Math.max(event.mouseOffset.x, 0)\n      const offsetY = Math.max(event.mouseOffset.y, 0)\n      if (this.plotType === 'selection') {\n        if (this.selection.isResize) {\n          this.selection.handleResize(\n            e,\n            mx,\n            my,\n            event.mouseOffset.x,\n            event.mouseOffset.y\n          )\n        } else if (this.selection.createSelection) {\n          this.selection.onMousemove(e, event)\n        } else {\n          this.nodes.handleResize(\n            e,\n            mx,\n            my,\n            event.mouseOffset.x,\n            event.mouseOffset.y\n          )\n          this.render.render()\n        }\n      } else if (['rectangle', 'diamond', 'triangle'].includes(this.plotType)) {\n        this.nodes.createRectangleLikeNode(\n          this.plotType,\n          mx,\n          my,\n          offsetX,\n          offsetY\n        )\n        this.render.render()\n      } else if (this.plotType === 'circle') {\n        this.nodes.createCircle(mx, my, e)\n        this.render.render()\n      } else if (this.plotType === 'arbitrary-plot') {\n        this.nodes.createArbitraryPlot(e, event)\n      } else if (this.plotType === 'arrow') {\n        this.nodes.createArrow(mx, my, e)\n        this.render.render()\n      } else if (this.plotType === 'line') {\n        if (getTowCoordinateDistance(mx, my, e.clientX, e.clientY) > 3) {\n          this.nodes.createLine(mx, my, e, true)\n          this.render.render()\n        }\n      }\n    } else if (this.imageEdit.isReady) {\n      this.cursor.hide()\n      this.imageEdit.updatePreviewElPos(\n        e.originEvent.clientX,\n        e.originEvent.clientY\n      )\n    } else if (this.plotType === 'selection') {\n      if (this.nodes.hasActiveNode()) {\n        const handData: any = ''\n        const h = this.nodes.checkInResizeHand(e.unGridClientX, e.unGridClientY)\n        if (h) {\n          this.cursor.setResize(handData.hand)\n        } else {\n          // @ts-ignore\n          this.checkIsOnNode(e)\n        }\n      } else if (this.selection.hasSelection) {\n        const hand = this.selection.checkInResizeHand(\n          e.unGridClientX,\n          e.unGridClientY\n        )\n        if (hand) {\n          this.cursor.setResize(hand)\n        } else {\n          // @ts-ignore\n          this.checkIsOnNode(e)\n        }\n      } else {\n        // @ts-ignore\n        this.checkIsOnNode(e)\n      }\n    } else if (this.plotType === 'line') {\n      this.nodes.createLine(undefined, undefined, e, false, true)\n      this.render.render()\n    }\n  }\n\n  // Detects if a graphic object has been slid over\n  checkIsOnNode(e: { unGridClientX: number; unGridClientY: number }) {\n    const clickNode = this.nodes.checkIsClickNode(e)\n    if (clickNode) {\n      this.cursor.setMove()\n    } else {\n      this.cursor.reset()\n    }\n  }\n\n  // Reset current type to selection mode\n  resetCurrentType() {\n    if (this.plotType !== 'selection') {\n      this.plotType = 'selection'\n      this.emit('currentTypeChange', 'selection')\n    }\n  }\n\n  // Creation of new graphic objects complete\n  completeCreateNewNode() {\n    this.resetCurrentType()\n    this.nodes.completeCreateNode()\n    this.render.render()\n  }\n\n  // Mouse release event\n  onMouseup(e: any) {\n    if (this.state.readonly || this.author.isDragAuthor) {\n      return\n    }\n    if (this.plotType === 'text') {\n      if (!this.textEdit.isEditing) {\n        this.createTextNode(e)\n        this.resetCurrentType()\n      }\n    } else if (this.imageEdit.isReady) {\n      this.nodes.createImage(e, this.imageEdit.imageData as any)\n      this.completeCreateNewNode()\n      this.cursor.reset()\n      this.imageEdit.reset()\n    } else if (this.plotType === 'arrow') {\n      this.nodes.completeCreateArrow(e)\n      this.completeCreateNewNode()\n    } else if (this.plotType === 'line') {\n      this.nodes.completeCreateLine(e, () => {\n        this.completeCreateNewNode()\n      })\n      this.render.render()\n    } else if (this.nodes.isCreateNode) {\n      if (this.plotType === 'arbitrary-plot') {\n        this.nodes.completeCreateNode()\n        this.nodes.setActiveNode()\n      } else {\n        this.completeCreateNewNode()\n      }\n    } else if (this.nodes.isResize) {\n      this.nodes.endResize()\n      this.emitChange()\n    } else if (this.selection.createSelection) {\n      this.selection.onMouseup()\n    } else if (this.selection.isResize) {\n      this.selection.endResize()\n      this.emitChange()\n    }\n  }\n\n  // Double click event\n  onDblclick(e: { unGridClientX: number; unGridClientY: number }) {\n    if (this.plotType === 'line') {\n      this.completeCreateNewNode()\n    } else {\n      const clickNode = this.nodes.checkIsClickNode(e)\n      if (clickNode) {\n        if (clickNode.type === 'text') {\n          this.nodes.editingText(clickNode)\n          this.render.render()\n          this.keyCommand.unBindEvent()\n          this.textEdit.showTextEdit()\n        }\n      } else if (!this.textEdit.isEditing) {\n        // @ts-ignore\n        this.createTextNode(e)\n      }\n    }\n  }\n\n  // Text box out-of-focus event\n  onTextInputBlur() {\n    this.keyCommand.bindEvent()\n    this.nodes.completeEditingText()\n    this.render.render()\n    this.emitChange()\n  }\n\n  // Creating text graphic objects\n  createTextNode(e: { clientX: any; clientY: any }) {\n    this.nodes.createNode({\n      type: 'text',\n      x: e.clientX,\n      y: e.clientY\n    })\n    this.keyCommand.unBindEvent()\n    this.textEdit.showTextEdit()\n  }\n\n  // Mouse scroll event\n  onMousewheel(dir: string) {\n    if (\n      typeof this.state.scrollStep === 'undefined' ||\n      typeof this.state.scale === 'undefined'\n    ) {\n      return\n    }\n    const stepNum = this.state.scrollStep / this.state.scale\n    const step = dir === 'down' ? stepNum : -stepNum\n    // @ts-ignore\n    this.scrollTo(this.state.scrollX, this.state.scrollY + step)\n  }\n\n  // Right-click menu events\n  onContextmenu(e: { originEvent: any }) {\n    let el: any\n    if (this.nodes.hasActiveNode()) {\n      el = [this.nodes.activeNode]\n    } else if (this.selection.hasSelectionNodes()) {\n      el = this.selection.getSelectionNodes()\n    }\n    this.emit('contextmenu', e.originEvent, el)\n  }\n\n  unBindEvent() {\n    this.keyCommand.unBindEvent()\n  }\n\n  bindEvent() {\n    this.keyCommand.bindEvent()\n  }\n\n  emitNodeRotateChange(rotate: number) {\n    this.emit('nodeRotateChange', rotate)\n  }\n\n  // Triggering update events\n  emitChange(noDiffData?: boolean, noHistory?: boolean) {\n    const data = this.getData()\n    const oldData = this.history.now()\n    if (\n      (typeof oldData === 'undefined' && data.nodes.length !== 0) ||\n      (typeof oldData !== 'undefined' && !noHistory)\n    ) {\n      this.history.add(<LocalData>data)\n    }\n    if (!noDiffData) {\n      if (typeof oldData === 'undefined' && typeof data === 'undefined') {\n        return\n      }\n      if (data && oldData && 'nodes' in data && 'nodes' in oldData) {\n        this.emitDiffNodesChange(oldData.nodes, data.nodes)\n      }\n      if (data && oldData && 'state' in data && 'state' in oldData) {\n        this.emitDiffStateChange(oldData.state, data.state)\n      }\n    }\n    this.emit('change', data)\n  }\n\n  // Customised data object update triggers with diff algorithm processing\n  emitDiffNodesChange(oldNodes: NodeArray, nowNodes: NodeArray) {\n    const delta = diff(oldNodes, nowNodes)\n    if (delta) {\n      this.emit('diffNodesChange', { type: 'diffNodesChange', delta })\n    }\n  }\n\n  // Customised data state update triggers with diff algorithm processing\n  emitDiffStateChange(oldState: State, nowState: State) {\n    const delta = diff(oldState, nowState)\n    if (delta) {\n      this.emit('diffNodesChange', { type: 'diffStateChange', delta })\n    }\n  }\n\n  async parseSetDiffData(config: { type: string; delta: any }) {\n    const oldData = this.getData()\n    if (config.type === 'diffNodesChange') {\n      this.setData(\n        { state: oldData.state, nodes: patch(oldData, config.delta) },\n        true,\n        true\n      )\n    } else if (config.type === 'diffStateChange') {\n      this.setData(\n        { state: patch(oldData, config.delta), nodes: oldData.nodes },\n        true,\n        true\n      )\n    }\n  }\n}\n\nCreatLoader.utils = utils\nCreatLoader.checkClick = checkClick\nCreatLoader.plot = plot\nCreatLoader.nodes = nodes\n\nexport default CreatLoader\n","import CreatLoader from './API'\nimport { AppResponse, AppState } from './types'\n\nexport default function creatLoader(state: AppState) {\n  function mount(mountEl: string | Object | HTMLElement): AppResponse {\n    // get DOM\n    const el =\n      typeof mountEl === 'string' ? document.querySelector(mountEl) : mountEl\n    // check\n    if (!el || !(el instanceof HTMLElement)) {\n      throw new Error('mountEl is not a HTMLElement !')\n    }\n    if (\n      !['absolute', 'fixed', 'relative'].includes(\n        window.getComputedStyle(<HTMLElement>el).position\n      )\n    ) {\n      throw new Error(\n        'The DOM being mounted needs to be set to absolute/fixed/relative positioning!'\n      )\n    }\n    // init\n    return new CreatLoader({\n      mountEL: el as any,\n      plotType: state.plotType,\n      state\n    }) as unknown as AppResponse\n  }\n  return { mount }\n}\n"],"names":["keyPosit","0","1","2","3","4","5","6","7","8","9","Backspace","Tab","Enter","Shift","Control","Alt","CapsLock","Esc","Space","PageUp","PageDown","End","Home","Insert","Left","Up","Right","Down","Del","NumLock","Cmd","CmdFF","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","`","=","+","-","'","/",".","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CLICK_DISTANCE","FOUR_CORNER","TOP_LEFT","TOP_RIGHT","BOTTOM_RIGHT","BOTTOM_LEFT","DRAG_NODE_PARTS","BODY","ROTATE","TOP_LEFT_BUTTON","TOP_RIGHT_BUTTON","BOTTOM_RIGHT_BUTTON","BOTTOM_LEFT_BUTTON","getNodeID","Math","floor","random","Date","getTime","toString","let","nodeKeyIndex","createNodeKey","deepCopy","JSON","parse","stringify","obj","downloadFile","file","fileName","document","createElement","href","download","click","throttle","fn","ctx","time","_timer","args","setTimeout","call","getFontString","fontSize","fontFamily","splitTextLines","text","replace","split","radToDeg","rad","PI","degToRad","deg","createCanvas","width","height","option","noStyle","noTranslate","className","canvas","style","cssText","getContext","translate","getTowCoordinateDistance","x1","y1","x2","y2","sqrt","getCoordinateToLineDistance","abs","A","B","checkIsAtSegment","dis","dis1","dis2","dis3","max","getTowCoordinateRotate","cx","cy","tx","ty","fx","fy","atan2","getRotatedCoordinate","rotate","del","cos","sin","getNodeCenterCoordinate","node","transformCoordinateReverseRotate","rp","transformCoordinateOnNode","center","getNodeFourCornerCoordinate","dir","getBoundingRect","coordinateArr","returnFourCorners","minX","Infinity","maxX","minY","maxY","forEach","coordinate","getNodeRotatedFourCornerCoordinate","dirPos","checkCoordinateIsInRectangle","rx","ry","rw","rh","getMultiplexNodeRectInfo","nodeList","length","getEndCoordinateList","textCheckEl","getTextActWidth","position","left","body","appendChild","innerText","getBoundingClientRect","getNodeFourCorners","bottomRight","createImageObj","Promise","img","Image","setAttribute","onload","resolve","onerror","src","url","getMaxFontSizeInWidth","getWrapTextActWidth","textArr","maxWidth","textRow","getWrapTextMaxRowTextNumber","maxNumber","getTextNodeSize","lineHeightRatio","computedLineWidthBySpeed","speed","lastLineWidth","baseLineWidth","lineWidth","maxLineWidth","Author","app","startScrollX","startScrollY","isDragAuthor","constructor","this","onMove","bindEvent","onStart","state","scrollX","scrollY","event","scale","scrollTo","mouseOffset","originX","originY","on","keyCode","cursor","set","setEditAuthor","updateState","readonly","setReadonlyAuthor","cancelActiveNode","Background","backgroundColor","addBackgroundColor","remove","mountEL","canvasAddBackgroundColor","save","rect","fillStyle","fill","restore","Cursor","currentType","type","setEraser","setText","setMove","hide","reset","setCrossHair","setResize","direction","Event","EventEmitter","calculate","lastMousePos","mouseDistance","lastMouseTime","mouseDuration","mouseSpeed","isMousedown","mousedownPos","super","now","unGridClientX","unGridClientY","originClientX","originClientY","onMousedown","bind","onMousemove","onMouseup","onDblclick","onMousewheel","onKeydown","onKeyup","onContextmenu","transformEvent","emit","originEvent","wheelDelta","stopPropagation","preventDefault","clientX","clientY","curTime","wp","windowToContainer","reverseScale","addScrollX","addScrollY","gp","gridAdsorbent","addEventListener","window","unbindEvent","removeEventListener","Export","openPreview","saveState","exportJson","getData","render","onlySelected","getNodeList","cacheActive","cacheSelected","noRender","isActive","isSelected","saveAppState","exportImage","renderBg","useBlob","paddingX","paddingY","show","changeAppState","recoveryAppState","reject","toBlob","blob","toDataURL","console","error","nodes","selectedNodes","activeNode","push","selection","hasSelectionNodes","getSelectionNodes","filter","includes","Canvas","el","opt","clearCanvas","clearRect","Grid","init","renderGrid","renderVerticalLines","gridConfig","maxRight","size","plotVerticalLine","subScrollX","renderHorizontalLines","maxBottom","plotHorizontalLine","subScrollY","showGrid","strokeStyle","_i","beginPath","moveTo","lineTo","stroke","hideGrid","updateGrid","config","removeChild","insertBefore","children","History","historyStack","index","fixIndex","emitChange","clear","add","data","prev","copyData","shuttle","oldData","fixLength","setData","then","emitDiffNodesChange","emitDiffStateChange","catch","undo","redo","ImageEdit","isReady","previewEl","imageData","maxHeight","maxRatio","onImageSelectChange","updatePreviewElPos","ratio","backgroundImage","backgroundSize","pointerEvents","tp","mountELToWindow","top","value","getImageUrl","reader","FileReader","onloadend","result","readAsDataURL","getImageSize","imageObj","await","target","files","selectImage","accept","KeyCommand","shortcutMap","getKeyCodeArr","key","keyArr","map","item","arr","getOriginEventCodeArr","ctrlKey","metaKey","altKey","shiftKey","checkKey","findIndex","splice","Object","keys","addShortcut","removeShortcut","unBindEvent","off","checkIsAtRectangleInner","getCircleRadius","min","checkIsAtMultiplexSegment","segments","res","seg","checkIsAtCircleEdge","radius","checkIsAtRectangleEdge","checkIsAtTriangleEdge","checkIsAtDiamondEdge","checkIsAtArrowEdge","checkIsAtArbitraryPlotLineEdge","checkIsAtLineEdge","len","BaseNode","isCreate","startX","startY","startRotate","dragNode","options","defaultColor","lineDash","globalAlpha","undefined","isClick","Error","offsetRotate","or","updateRotate","setStyle","_style","setLineDash","warpRender","renderFn","transform","halfWidth","halfHeight","move","ox","oy","emitNodeRotateChange","rotateByCenter","np","updatePos","startResize","resizeType","endResize","resize","handleResizeNode","updateRect","updateSize","serialize","renderDragNode","showAll","onlyShowBody","BaseMultiplexCoordinateNode","startCoordinateArr","startWidth","startHeight","fictitiousCoordinate","opts","scaleX","scaleY","slice","offsetX","offsetY","updateMultiplexCoordinateBoundingRect","addCoordinate","Array","isArray","updateFictitiousCoordinate","plotWrap","plotCircle","arc","plotArrow","lineDeg","plusDeg","_x","_y","plotRect","fillRect","plotDiamond","closePath","transformArbitraryLineCoordinate","plotLineSegment","mx","my","lineCap","lineJoin","plotTriangle","plotArbitraryLine","coordinates","nextCoordinate","plotText","textObj","lineHeight","font","textBaseline","fillText","plotImage","showWidth","showHeight","drawImage","plotLine","first","DragNode","offset","diagonalCoordinate","mousedownPosAndNodePosOffset","nodeRatio","hideParts","notNeedDragNode","lockRatio","handleDragMousedown","corner","centerPos","pos","handleMoveNode","handleRotateNode","handleStretchNode","newCenter","newRatio","newRect","newSize","setHideParts","parts","update","stretchCalc","calcSize","calcPos","isWidthReverse","isHeightReverse","newPos","fixPos","actClientX","actClientY","fixStretch","fp","fixNewRect","checkCoordinateInDragNodeWhere","part","_checkCoordinateIsInButton","ArbitraryPlot","singleRender","Arrow","realtimeCoordinate","concat","Circle","Diamond","Line","isSingle","Rectangle","Text","Triangle","Nodes","isCreateNode","isResize","resizeNode","handleResize","createNode","callback","notActive","hasActiveNode","id","pureCreateNode","addNode","setActiveNode","copyNode","async","gridAdsorbentPos","createRectangleLikeNode","createCircle","createArbitraryPlot","tfp","transformToCanvasCalculate","ttp","createImage","editingText","completeEditingText","trim","deleteNode","completeCreateArrow","createArrow","createLine","notCreate","insertNode","getNodesNum","hasNodes","unshiftNode","unshift","getNodeIndex","deleteAllNodes","createNodesFromData","nodeObject","checkIsClickNode","completeCreateLine","completeCallback","completeCreateNode","setActiveNodeStyle","checkInResizeHand","hand","checkIsResize","Render","beingCopyActiveNode","beingCopySelectedNodes","beingCopyNode","registerShortcutKeys","setCurrentNodesStyle","setSelectedNodeStyle","keyCommand","selectAll","setZoom","deleteCurrentNodes","copyCurrentNode","cutCurrentNode","history","grid","pasteCurrentNode","setMultiplexSelectNodes","useCurrentEventPos","copySelectionNodes","deleteActiveNode","deleteSelectedNodes","updateActiveNodePosition","updateActiveNodeSize","updateActiveNodeRotate","empty","zoomIn","num","zoomOut","zoom","fit","maxScale","scrollToCenter","copyPasteCurrentNodes","setBackgroundColor","color","background","selectNodes","Calculate","gridSize","transformToScreenCalculate","sp","MultiplexSelectNode","selectedNodeList","wholeCenterPos","updateNodes","exists","setSelectedNodeList","handleRotate","list","Selection","createSelection","hasSelection","rectangle","multiplexSelectNode","checkInNodes","_minX","_maxX","_minY","_maxY","endCoordinateList","task","all","renderSelection","cancelSelectNodes","notUpdateRect","which","TextEdit","editable","isEditing","onTextInput","onTextBlur","showTextEdit","display","crateTextInputEl","updateTextInputStyle","focus","select","tabIndex","wrap","assign","minHeight","backfaceVisibility","margin","padding","border","outline","overflow","whiteSpace","styles","opacity","CreatLoader","plotType","imageEdit","textEdit","export","author","watch","utils","checkClick","plot","scrollStep","initCanvas","onTextInputBlur","mountFunction","checkIsOnNode","helpUpdate","zoomChange","scrollChange","currentTypeChange","activeNodeChange","multiplexSelectChange","contextmenu","diffNodesChange","diffStateChange","localDataChange","nodeRotateChange","method","getContainerRectInfo","noEmitChange","noDiffData","nNS","updateCurrentType","clickNode","resetCurrentType","completeCreateNewNode","createTextNode","stepNum","noHistory","oldNodes","nowNodes","delta","diff","oldState","nowState","parseSetDiffData","patch","creatLoader","mount","mountEl","querySelector","HTMLElement","getComputedStyle"],"mappings":"8EAGO,MAAMA,SAAqB,CAChCC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,EAAK,GACLC,UAAW,EACXC,IAAK,EACLC,MAAO,GACPC,MAAO,GACPC,QAAS,GACTC,IAAK,GACLC,SAAU,GACVC,IAAK,GACLC,MAAO,GACPC,OAAQ,GACRC,SAAU,GACVC,IAAK,GACLC,KAAM,GACNC,OAAQ,GACRC,KAAM,GACNC,GAAI,GACJC,MAAO,GACPC,KAAM,GACNC,IAAK,GACLC,QAAS,IACTC,IAAK,GACLC,MAAO,IACPC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,IAAK,IACLC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,GACHC,EAAG,IAGQC,eAAiB,GAGjBC,YAAc,CACzBC,SAAU,UACVC,UAAW,WACXC,aAAc,cACdC,YAAa,cAIFC,gBAAkB,CAC7BC,KAAM,OACNC,OAAQ,SACRC,gBAAiB,gBACjBC,iBAAkB,iBAClBC,oBAAqB,oBACrBC,mBAAoB,6BCjGNC,YAEd,OADgD,IAAnCC,KAAKC,MAAsB,KAAhBD,KAAKE,OAAM,CAAS,GAAU,IAAIC,MAAOC,QAAO,GAC5DC,SAAS,EAAE,CACzB,CAGAC,IAAIC,aAAe,WACHC,gBAEd,OADAD,cAAgB,CAElB,CAEO,MAAME,SAAW,GAAoBC,KAAKC,MAAMD,KAAKE,UAAUC,CAAG,CAAC,EAG7DC,aAAe,CAACC,EAAcC,KACzC,IAAMxD,EAAIyD,SAASC,cAAc,GAAG,EACpC1D,EAAE2D,KAAOJ,EACTvD,EAAE4D,SAAWJ,EACbxD,EAAE6D,MAAK,CACT,EAGaC,SAAW,CAACC,EAASC,EAAUC,EAAO,MACjDnB,IAAIoB,EAAc,KAClB,MAAO,IAAIC,KACLD,EAAAA,GAGKE,WAAW,KAClBL,EAAGM,KAAKL,EAAK,GAAGG,CAAI,EACpBD,EAAS,IACV,EAAED,CAAI,CACT,CACF,EAGaK,cAAgB,CAACC,EAAkBC,IAC3CD,EAAH,MAAiBC,EAGNC,eAAiB,GAC5BC,EAAKC,QAAQ,SAAU,IAAI,EAAEC,MAAM,IAAI,EAG5BC,SAAW,GAAiBC,GAAO,IAAMtC,KAAKuC,IAG9CC,SAAW,GAAiBC,GAAOzC,KAAKuC,GAAK,KAE7CG,aAAe,CAC1BC,EACAC,EACAC,EAA2E,CACzEC,QAAS,CAAA,EACTC,YAAa,CAAA,EACbC,UAAW,EACZ,KAED,IAAMC,EAAShC,SAASC,cAAc,QAAQ,EAQxCM,GAPDqB,EAAOC,UACVG,EAAOC,MAAMC,QAAU,sCAErBN,EAAOG,YACTC,EAAOD,UAAYH,EAAOG,WAGhBC,EAAOG,WAAW,IAAI,GAOlC,OANAH,EAAON,MAAQA,EACfM,EAAOL,OAASA,EAEXC,EAAOE,aACVvB,GAAK6B,UAAUJ,EAAON,MAAQ,EAAGM,EAAOL,OAAS,CAAC,EAE7C,CACLK,OAAAA,EACAzB,IAAAA,EAEJ,EAGa8B,yBAA2B,CACtCC,EACAC,EACAC,EACAC,IACG1D,KAAK2D,MAAMJ,EAAKE,IAAO,GAAKD,EAAKE,IAAO,CAAC,EAGjCE,4BAA8B,CACzC7E,EACAC,EACAuE,EACAC,EACAC,EACAC,KAGA,OAAIH,IAAOE,EACFzD,KAAK6D,IAAI9E,EAAIwE,CAAE,GAGlBO,GAAKN,EAAKE,IAAOD,EAAKF,GAErBvD,KAAK6D,KAAKC,EAAI/E,GAAIgF,CAAI/E,GADnB,EAAI+E,CAAIP,EAAKM,EAAIP,IACWvD,KAAK2D,KAAKG,EAAIA,EAAIC,CAAK,CAAC,EAChE,EAGaC,iBAAmB,CAC9BjF,EACAC,EACAuE,EACAC,EACAC,EACAC,EACAO,EAAM,MAEN,IAMMC,EANN,OAAkB,KAAA,IAAPT,GAAoC,KAAA,IAAPC,GAGpCE,EAAAA,4BAA4B7E,EAAGC,EAAGuE,EAAIC,EAAIC,EAAIC,CAAE,EAAIO,KAGlDC,EAAOZ,yBAAyBvE,EAAGC,EAAGuE,EAAIC,CAAE,EAC5CW,EAAOb,yBAAyBvE,EAAGC,EAAGyE,EAAIC,CAAE,EAC5CU,EAAOd,yBAAyBC,EAAIC,EAAIC,EAAIC,CAAE,EAE7CQ,IADDG,EAAMrE,KAAK2D,KAAKM,EAAMA,EAAMG,EAAOA,CAAI,KACvBD,GAAQE,CAChC,EAGaC,uBAAyB,CACpCC,EACAC,EACAC,EACAC,EACAC,EACAC,IACGvC,SAASrC,KAAK6E,MAAMH,EAAKF,EAAIC,EAAKF,CAAE,EAAIvE,KAAK6E,MAAMD,EAAKJ,EAAIG,EAAKJ,CAAE,CAAC,EAG5DO,qBAAuB,CAClC/F,EACAC,EACAuF,EACAC,EACAO,KAGMC,EADM3C,SAASrC,KAAK6E,MAAM7F,EAAIwF,EAAIzF,EAAIwF,CAAE,CAAC,EAC7BQ,EACZd,EAAMX,yBAAyBvE,EAAGC,EAAGuF,EAAIC,CAAE,EACjD,MAAO,CACLzF,EAAGiB,KAAKiF,IAAIzC,SAASwC,CAAG,CAAC,EAAIf,EAAMM,EACnCvF,EAAGgB,KAAKkF,IAAI1C,SAASwC,CAAG,CAAC,EAAIf,EAAMO,EAEvC,EAGaW,wBAA0B,IACrC,GAAM,CAAEpG,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,CAAM,EAAUwC,EACrC,MAAO,CACLrG,EAAGA,EAAI4D,EAAQ,EACf3D,EAAGA,EAAI4D,EAAS,EAEpB,EAGayC,iCAAmC,CAC9CtG,EACAC,EACAuF,EACAC,EACAO,KAOA,OALe,IAAXA,IAEFhG,GADMuG,EAAKR,qBAAqB/F,EAAGC,EAAGuF,EAAIC,EAAI,CAACO,CAAM,GAC9ChG,EACPC,EAAIsG,EAAGtG,GAEF,CACLD,EAAAA,EACAC,EAAAA,EAEJ,EAGauG,0BAA4B,CAACxG,EAAWC,EAAWoG,KAC9D,IAAMI,EAASL,wBAAwBC,CAAY,EACnD,OAAOC,iCACLtG,EACAC,EACAwG,EAAOzG,EACPyG,EAAOxG,EACCoG,EAAKL,MAAM,CAEvB,EAGaU,4BAA8B,CAACL,EAAYM,KACtD,GAAM,CAAE3G,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,CAAM,EAAUwC,EACrC,OAAQM,GACN,IAAK,UACH,MAAO,CACL3G,EAAAA,EACAC,EAAAA,GAEJ,IAAK,WACH,MAAO,CACLD,EAAGA,EAAI4D,EACP3D,EAAAA,GAEJ,IAAK,cACH,MAAO,CACLD,EAAGA,EAAI4D,EACP3D,EAAGA,EAAI4D,GAEX,IAAK,aACH,MAAO,CACL7D,EAAAA,EACAC,EAAGA,EAAI4D,EAIZ,CACD,MAAO,EACT,EAGa+C,gBAAkB,CAC7BC,EAAgB,GAChBC,EAAoB,CAAA,KAEpBvF,IAAIwF,EAAOC,EAAAA,EACPC,EAAQD,CAAAA,EAAAA,EACRE,EAAOF,EAAAA,EACPG,EAAQH,CAAAA,EAAAA,EACZH,EAAcO,QAAQ,IACpB,GAAM,CAACpH,EAAGC,GAAoBoH,EAC1BrH,EAAI+G,IACNA,EAAO/G,GAELA,EAAIiH,IACNA,EAAOjH,GAELC,EAAIiH,IACNA,EAAOjH,GAELA,EAAIkH,IACNA,EAAOlH,EAEX,CAAC,EACD,IAAMD,EAAI+G,EACJ9G,EAAIiH,EACJtD,EAAQqD,EAAOF,EACflD,EAASsD,EAAOD,EAEtB,OAAIJ,EACK,CACL,CACE9G,EAAAA,EACAC,EAAAA,CACD,EACD,CACED,EAAGA,EAAI4D,EACP3D,EAAAA,CACD,EACD,CACED,EAAGA,EAAI4D,EACP3D,EAAGA,EAAI4D,CACR,EACD,CACE7D,EAAAA,EACAC,EAAGA,EAAI4D,CACR,GAGE,CACL7D,EAAAA,EACAC,EAAAA,EACA2D,MAAAA,EACAC,OAAAA,EAEJ,EAGayD,mCAAqC,CAACjB,EAAYM,KAC7D,IAAMF,EAASL,wBAAwBC,CAAI,EACrCkB,EAASb,4BAA4BL,EAAMM,CAAG,EACpD,OAAKY,GAAWA,EAAOvH,GAAMuH,EAAOtH,EAG7B8F,qBACLwB,EAAOvH,EACPuH,EAAOtH,EACPwG,EAAOzG,EACPyG,EAAOxG,EACCoG,EAAKL,MAAM,EAPZ,CASX,EAGawB,6BAA+B,CAC1CxH,EACAC,EACAwH,EACAC,EACAC,EACAC,KAEA,IACQvB,EAMR,MAPkB,UAAd,OAAOoB,IAETA,GADMpB,EAAOoB,GACHzH,EACV0H,EAAKrB,EAAKpG,EACV0H,EAAKtB,EAAKzC,MACVgE,EAAKvB,EAAKxC,QAGI,KAAA,IAAP6D,GACO,KAAA,IAAPC,GACO,KAAA,IAAPC,GAIGH,GAALzH,GAAWA,GAAKyH,EAAKE,GAAWD,GAALzH,GAAWA,GAAKyH,EAAKE,CACzD,EAGaC,yBAA2B,CAACC,EAAsB,MAC7D,GAAIA,EAASC,QAAU,EACrB,MAAO,CACLhB,KAAM,EACNE,KAAM,EACNC,KAAM,EACNC,KAAM,GAGV5F,IAAIwF,EAAOC,EAAAA,EACPC,EAAQD,CAAAA,EAAAA,EACRE,EAAOF,EAAAA,EACPG,EAAQH,CAAAA,EAAAA,EAkBZ,OAjBAc,EAASV,QAAQ,KACQf,GAAM2B,0BACdZ,QAAQ,CAAA,CAAGpH,EAAAA,EAAGC,EAAAA,CAA6B,KACpDD,EAAI+G,IACNA,EAAO/G,GAELA,EAAIiH,IACNA,EAAOjH,GAELC,EAAIiH,IACNA,EAAOjH,GAELA,EAAIkH,IACNA,EAAOlH,EAEX,CAAC,CACH,CAAC,EACM,CACL8G,KAAAA,EACAE,KAAAA,EACAC,KAAAA,EACAC,KAAAA,EAEJ,EAGA5F,IAAI0G,YAAqC,KAClC,MAAMC,gBAAkB,CAAC/E,EAAcgB,KACvC8D,eACHA,YAAc/F,SAASC,cAAc,KAAK,GAC9BgC,MAAMgE,SAAW,QAC7BF,YAAY9D,MAAMiE,KAAO,WACzBlG,SAASmG,KAAKC,YAAYL,WAAW,GAEvC,GAAM,CAAEjF,SAAAA,EAAUC,WAAAA,CAAY,EAAGkB,EAIzBP,GAHRqE,YAAYM,UAAYpF,EACxB8E,YAAY9D,MAAMnB,SAAcA,EAAH,KAC7BiF,YAAY9D,MAAMlB,WAAaA,EACbgF,YAAYO,sBAAqB,GAA3C5E,SACR,OAAOA,CACT,EAGa6E,mBAAqB,IAChC,IAAMC,EAAcpB,mCAAmCjB,EAAM,aAAa,EAI1E,MAAO,CAHSiB,mCAAmCjB,EAAM,SAAS,EACjDiB,mCAAmCjB,EAAM,UAAU,EACjDiB,mCAAmCjB,EAAM,YAAY,EACjCqC,EACzC,EAGaC,eAAiB,GAC5B,IAAIC,QAAQ,IACV,MAAMC,EAAM,IAAIC,MAChBD,EAAIE,aAAa,cAAe,WAAW,EAC3CF,EAAIG,OAAS,KACXC,EAAQJ,CAAG,CACb,EACAA,EAAIK,QAAU,KACZD,EAAQ,IAAI,CACd,EACAJ,EAAIM,IAAMC,CACZ,CAAC,EAGUC,sBAAwB,CACnClG,EACAS,EACAO,KAEA5C,IAAIyB,EAAW,GACf,KACEkF,gBAAgB/E,EAAM,CACpB,GAAGgB,EACHnB,SAAUA,EAAW,CACtB,CAAA,EAAIY,GAELZ,GAAY,EAEd,OAAOA,CACT,EAGasG,oBAAsB,IACjC,IAAQnG,EAAckD,EAAdlD,QACFoG,EAAUrG,eAAeC,CAAI,EACnC5B,IAAIiI,EAAYxC,CAAAA,EAAAA,EAOhB,OANAuC,EAAQnC,QAAQ,IACRxD,EAAQsE,gBAAgBuB,EAAcpD,EAAKlC,KAAK,EAClDP,EAAQ4F,IACVA,EAAW5F,EAEf,CAAC,EACM4F,CACT,EAGaE,4BAA8B,IACnCH,EAAUrG,eAAeC,CAAI,EACnC5B,IAAIoI,EAAa3C,CAAAA,EAAAA,EAMjB,OALAuC,EAAQnC,QAAQ,IACVqC,EAAQ1B,OAAS4B,IACnBA,EAAYF,EAAQ1B,OAExB,CAAC,EACM4B,CACT,EAGaC,gBAAkB,IAC7B,GAAM,CAAEzG,KAAAA,EAAMgB,MAAAA,CAAO,EAAQkC,EAK7B,MAAO,CACLzC,MALY0F,oBAAoBjD,CAAI,EAMpCxC,OALY5C,KAAKqE,IAAIpC,eAAeC,CAAI,EAAE4E,OAAQ,CAAC,GAClC5D,EAAMnB,SAAWmB,EAAM0F,iBAM5C,EAGaC,yBAA2B,CACtCC,EACAC,EACAC,EAAgB,KAEhB1I,IAAI2I,EAAY,EAChB,IAAMC,EAAeF,EAAgB,EAcrC,MAHsB,CAAC,IAAnBD,IACFA,EAAgBG,GAEC,IAVjBD,EAHe,IAEbH,EACUE,EACHF,GAHM,GAIHI,EAAe,EAGzBA,GAAiBJ,EAPJ,IAOyB,IAAwBI,GAKzB,GAAhBH,CAC3B,8uCCneqBI,OACZC,IAEAC,aAEAC,aAEPC,aAEAC,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAKJ,aAAe,EACpBI,KAAKH,aAAe,EAEpBG,KAAKF,aAAe,CAAA,EAEpBE,KAAKC,OAASpI,SAASmI,KAAKC,OAAQD,KAAa,EAAE,EACnDA,KAAKE,UAAS,CACf,CAGDC,UACEH,KAAKJ,aAAeI,KAAKL,IAAIS,MAAMC,QACnCL,KAAKH,aAAeG,KAAKL,IAAIS,MAAME,OACpC,CAGDL,OAAO9L,EAAQoM,GAEkB,KAAA,IAAtBP,KAAKJ,cACiB,KAAA,IAAtBI,KAAKH,cACoB,KAAA,IAAzBG,KAAKL,IAAIS,MAAMI,OAEtBR,KAAKL,IAAIc,SACPT,KAAKJ,aAAeW,EAAMG,YAAYC,QAAUX,KAAKL,IAAIS,MAAMI,MAC/DR,KAAKH,aAAeU,EAAMG,YAAYE,QAAUZ,KAAKL,IAAIS,MAAMI,KAAK,CAGzE,CAEDN,YACEF,KAAKL,IAAIY,MAAMM,GAAG,UAAW,IACvB1M,EAAE2M,UAAYnQ,SAASmB,QACzBkO,KAAKF,aAAe,CAAA,EACpBE,KAAKL,IAAIoB,OAAOC,IAAI,MAAM,EAE9B,CAAC,EACDhB,KAAKL,IAAIY,MAAMM,GAAG,QAAS,KACrBb,KAAKF,eACPE,KAAKF,aAAe,CAAA,EACpBE,KAAKL,IAAIoB,OAAOC,IAAI,SAAS,EAEjC,CAAC,CACF,CAGDC,gBACEjB,KAAKL,IAAIoB,OAAOC,IAAI,SAAS,EAC7BhB,KAAKL,IAAIuB,YAAY,CACnBC,SAAU,CAAA,CACX,CAAA,CACF,CAGDC,oBACEpB,KAAKL,IAAIoB,OAAOC,IAAI,MAAM,EAC1BhB,KAAKL,IAAI0B,mBACTrB,KAAKL,IAAIuB,YAAY,CACnBC,SAAU,CAAA,CACX,CAAA,CACF,CACF,OC1EoBG,WACZ3B,IAEPI,YAAYJ,GACVK,KAAKL,IAAMA,CACZ,CAGDqB,MACMhB,KAAKL,IAAIS,MAAMmB,gBACjBvB,KAAKwB,mBAAkB,EAEvBxB,KAAKyB,OAAM,CAEd,CAGDD,qBACExB,KAAKL,IAAI+B,QAAQjI,MAAM8H,gBACrBvB,KAAKL,IAAIS,MAAqB,eAEjC,CAGDqB,SACEzB,KAAKL,IAAI+B,QAAQjI,MAAM8H,gBAAkB,EAC1C,CAGDI,gCACE5J,EACAmB,EACAC,EACAoI,GAEAxJ,EAAI6J,KAAI,EACR7J,EAAI8J,KAAK,EAAG,EAAG3I,EAAOC,CAAM,EAC5BpB,EAAI+J,UAAYP,EAChBxJ,EAAIgK,KAAI,EACRhK,EAAIiK,QAAO,CACZ,CACF,OCxCoBC,OACZtC,IAEAuC,YAEPnC,YAAYJ,GACVK,KAAKL,IAAMA,EACXK,KAAKkC,YAAc,SACpB,CAGDlB,IAAImB,EAAO,WAETtL,IAAI4C,EAIS,UALbuG,KAAKkC,YAAcC,GAMT,smBAJG,WAATA,EACM,ktBAFEA,EAOZnC,KAAKL,IAAI+B,QAAQjI,MAAMsH,OAAStH,CACjC,CAED2I,YACEpC,KAAKgB,IAAI,QAAQ,CAClB,CAEDqB,UACErC,KAAKgB,IAAI,MAAM,CAChB,CAEDsB,UACEtC,KAAKgB,IAAI,MAAM,CAChB,CAEDuB,OACEvC,KAAKgB,IAAI,MAAM,CAChB,CAEDwB,QACExC,KAAKgB,IAAG,CACT,CAEDyB,eACEzC,KAAKgB,IAAI,WAAW,CACrB,CAGD0B,UAAUC,GACR9L,IAAIsL,EAAO,GACX,OAAQQ,GACN,KAAK5M,gBAAgBC,KACnBmM,EAAO,OACP,MACF,KAAKpM,gBAAgBE,OACnBkM,EAAO,OACP,MACF,KAAKpM,gBAAgBG,gBACnBiM,EAAO,YACP,MACF,KAAKpM,gBAAgBI,iBACnBgM,EAAO,YACP,MACF,KAAKpM,gBAAgBK,oBACnB+L,EAAO,YACP,MACF,KAAKpM,gBAAgBM,mBACnB8L,EAAO,WAIV,CACDnC,KAAKgB,IAAImB,CAAI,CACd,CACF,OCxEoBS,cAAcC,aAC1BlD,IAEAmD,UAEAC,aAEAC,cAEAC,cAEAC,cAEAC,WAEAC,YAEAC,aASA3C,YAOPX,YAAYJ,GACV2D,QACAtD,KAAKL,IAAMA,EACXK,KAAK8C,UAAYnD,EAAImD,UAGrB9C,KAAK+C,aAAe,CAClBzN,EAAG,EACHC,EAAG,GAILyK,KAAKgD,cAAgB,EAGrBhD,KAAKiD,cAAgBvM,KAAK6M,MAG1BvD,KAAKkD,cAAgB,EAGrBlD,KAAKmD,WAAa,EAGlBnD,KAAKoD,YAAc,CAAA,EAGnBpD,KAAKqD,aAAe,CAClB/N,EAAG,EACHC,EAAG,EACHiO,cAAe,EACfC,cAAe,EACfC,cAAe,EACfC,cAAe,GAIjB3D,KAAKU,YAAc,CACjBpL,EAAG,EACHC,EAAG,EACHoL,QAAS,EACTC,QAAS,GAGXZ,KAAK4D,YAAc5D,KAAK4D,YAAYC,KAAK7D,IAAI,EAC7CA,KAAK8D,YAAc9D,KAAK8D,YAAYD,KAAK7D,IAAI,EAC7CA,KAAK+D,UAAY/D,KAAK+D,UAAUF,KAAK7D,IAAI,EACzCA,KAAKgE,WAAahE,KAAKgE,WAAWH,KAAK7D,IAAI,EAC3CA,KAAKiE,aAAejE,KAAKiE,aAAaJ,KAAK7D,IAAI,EAC/CA,KAAKkE,UAAYlE,KAAKkE,UAAUL,KAAK7D,IAAI,EACzCA,KAAKmE,QAAUnE,KAAKmE,QAAQN,KAAK7D,IAAI,EACrCA,KAAKoE,cAAgBpE,KAAKoE,cAAcP,KAAK7D,IAAI,EACjDA,KAAKE,UAAS,CACf,CAED6D,UAAU5P,GACRA,EAAI6L,KAAKqE,eAAelQ,CAAC,EACzB6L,KAAKoD,YAAc,CAAA,EACnBpD,KAAKqD,aAAa/N,EAAI,EACtB0K,KAAKqD,aAAa9N,EAAI,EACtByK,KAAKsE,KAAK,UAAWnQ,EAAG6L,IAAI,CAC7B,CAEDgE,WAAW7P,GACTA,EAAI6L,KAAKqE,eAAelQ,CAAC,EACzB6L,KAAKsE,KAAK,WAAYnQ,EAAG6L,IAAI,CAC9B,CAEDiE,aAAa9P,GACXA,EAAI6L,KAAKqE,eAAelQ,CAAC,EACzB6L,KAAKsE,KAAK,aAAcnQ,EAAEoQ,YAAYC,WAAa,EAAI,OAAS,IAAI,CACrE,CAEDJ,cAAcjQ,GACZA,EAAEsQ,gBAAe,EACjBtQ,EAAEuQ,eAAc,EAChBvQ,EAAI6L,KAAKqE,eAAelQ,CAAC,EACzB6L,KAAKsE,KAAK,cAAenQ,EAAG6L,IAAI,CACjC,CAEDkE,UAAU/P,GACR6L,KAAKsE,KAAK,UAAWnQ,EAAG6L,IAAI,CAC7B,CAEDmE,QAAQhQ,GACN6L,KAAKsE,KAAK,QAASnQ,EAAG6L,IAAI,CAC3B,CAED4D,YAAYzP,GACVA,EAAI6L,KAAKqE,eAAelQ,CAAC,EACzB6L,KAAKoD,YAAc,CAAA,EACnBpD,KAAKqD,aAAa/N,EAAInB,EAAEwQ,QACxB3E,KAAKqD,aAAa9N,EAAIpB,EAAEyQ,QACxB5E,KAAKqD,aAAaG,cAAgBrP,EAAEqP,cACpCxD,KAAKqD,aAAaI,cAAgBtP,EAAEsP,cACpCzD,KAAKqD,aAAaK,cAAgBvP,EAAEoQ,YAAYI,QAChD3E,KAAKqD,aAAaM,cAAgBxP,EAAEoQ,YAAYK,QAChD5E,KAAKsE,KAAK,YAAanQ,EAAG6L,IAAI,CAC/B,CAED8D,YAAY3P,GAEV,IAAMmB,GADNnB,EAAI6L,KAAKqE,eAAelQ,CAAC,GACbwQ,QACNpP,EAAIpB,EAAEyQ,QASNC,GARF7E,KAAKoD,cACPpD,KAAKU,YAAYpL,EAAIA,EAAI0K,KAAKqD,aAAa/N,EAC3C0K,KAAKU,YAAYnL,EAAIA,EAAIyK,KAAKqD,aAAa9N,EAC3CyK,KAAKU,YAAYC,QACfxM,EAAEoQ,YAAYI,QAAU3E,KAAKqD,aAAaK,cAC5C1D,KAAKU,YAAYE,QACfzM,EAAEoQ,YAAYK,QAAU5E,KAAKqD,aAAaM,eAE9BjN,KAAK6M,OACrBvD,KAAKkD,cAAgB2B,EAAU7E,KAAKiD,cACpCjD,KAAKgD,cAAgBnJ,yBACnBvE,EACAC,EACAyK,KAAK+C,aAAazN,EAClB0K,KAAK+C,aAAaxN,CAAC,EAErByK,KAAKmD,WAAanD,KAAKgD,cAAgBhD,KAAKkD,cAC5ClD,KAAKsE,KAAK,YAAanQ,EAAG6L,IAAI,EAC9BA,KAAKiD,cAAgB4B,EACrB7E,KAAK+C,aAAazN,EAAIA,EACtB0K,KAAK+C,aAAaxN,EAAIA,CACvB,CAGD8O,eAAelQ,GACb,IAAQ2O,EAAc9C,KAAKL,IAAnBmD,aACFgC,EAAKhC,EAAUiC,kBAAkB5Q,EAAEwQ,QAASxQ,EAAEyQ,OAAO,EACvD,CAAEtP,EAAAA,EAAGC,EAAAA,CAAC,EAAKuN,EAAUkC,aAAaF,EAAGxP,EAAGwP,EAAGvP,CAAC,EAG1CiO,EAAgBlO,EAFlBwN,EAAUmC,WAAW3P,CAAC,EAGpBmO,EAAgBlO,EAFlBuN,EAAUoC,WAAW3P,CAAC,EAGpB4P,EAAKrC,EAAUsC,cAAc9P,EAAGC,CAAC,EACvC,MAAO,CACLgP,YAAapQ,EACbqP,cAAAA,EACAC,cAAAA,EACAkB,QAASQ,EAAG7P,EACZsP,QAASO,EAAG5P,EAEf,CAED2K,YACEF,KAAKL,IAAI+B,QAAQ2D,iBAAiB,YAAarF,KAAK4D,WAAW,EAC/D5D,KAAKL,IAAI+B,QAAQ2D,iBAAiB,YAAarF,KAAK8D,WAAW,EAC/D9D,KAAKL,IAAI+B,QAAQ2D,iBAAiB,UAAWrF,KAAK+D,SAAS,EAC3D/D,KAAKL,IAAI+B,QAAQ2D,iBAAiB,WAAYrF,KAAKgE,UAAU,EAC7DhE,KAAKL,IAAI+B,QAAQ2D,iBAAiB,aAAcrF,KAAKiE,YAAY,EACjEjE,KAAKL,IAAI+B,QAAQ2D,iBAAiB,cAAerF,KAAKoE,aAAa,EACnEkB,OAAOD,iBAAiB,UAAWrF,KAAKkE,SAAS,EACjDoB,OAAOD,iBAAiB,QAASrF,KAAKmE,OAAO,CAC9C,CAEDoB,cACEvF,KAAKL,IAAI+B,QAAQ8D,oBAAoB,YAAaxF,KAAK4D,WAAW,EAClE5D,KAAKL,IAAI+B,QAAQ8D,oBAAoB,YAAaxF,KAAK8D,WAAW,EAClE9D,KAAKL,IAAI+B,QAAQ8D,oBAAoB,UAAWxF,KAAK+D,SAAS,EAC9D/D,KAAKL,IAAI+B,QAAQ8D,oBAAoB,WAAYxF,KAAKgE,UAAU,EAChEhE,KAAKL,IAAI+B,QAAQ8D,oBAAoB,aAAcxF,KAAKiE,YAAY,EACpEjE,KAAKL,IAAI+B,QAAQ8D,oBAAoB,cAAexF,KAAKoE,aAAa,EACtEkB,OAAOE,oBAAoB,UAAWxF,KAAKkE,SAAS,EACpDoB,OAAOE,oBAAoB,QAASxF,KAAKmE,OAAO,CACjD,CACF,OCzMoBsB,OACZ9F,IAEA+F,YAEAC,UASP5F,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAK0F,YAAc,CAAA,EAEnB1F,KAAK2F,UAAY,CACfnF,MAAO,EACPH,QAAS,EACTC,QAAS,EACTpH,MAAO,EACPC,OAAQ,EAEX,CAGDyM,aACE,OAAO5F,KAAKL,IAAIkG,SACjB,CAGDC,OAAO/N,EAAUgO,GACfhO,EAAI6J,KAAI,EACR5B,KAAKgG,YAAYD,CAAY,EAAErJ,QAAQ,IACrC,IAGMuJ,EACAC,EAJFvK,EAAKwK,WAGHF,EAActK,EAAKyK,SACnBF,EAAgBvK,EAAK0K,WAC3B1K,EAAKyK,SAAW,CAAA,EAChBzK,EAAK0K,WAAa,CAAA,EAClB1K,EAAKmK,OAAM,EACXnK,EAAKyK,SAAWH,EAChBtK,EAAK0K,WAAaH,EACpB,CAAC,EACDnO,EAAIiK,QAAO,CACZ,CAGDsE,eACE,GAAM,CAAEpN,MAAAA,EAAOC,OAAAA,EAAQiH,MAAAA,EAAOrI,IAAAA,CAAK,EAAGiI,KAAKL,IAC3CK,KAAK2F,UAAUzM,MAAQA,EACvB8G,KAAK2F,UAAUxM,OAASA,EACpBiH,EAAMI,QACRR,KAAK2F,UAAUnF,MAAQJ,EAAMI,OAE3BJ,EAAMC,UACRL,KAAK2F,UAAUtF,QAAUD,EAAMC,SAE7BD,EAAME,UACRN,KAAK2F,UAAUrF,QAAUF,EAAME,SAEjCN,KAAK2F,UAAU5N,IAAMA,CACtB,CAGDwO,YAAY,CACVpE,KAAAA,EAAO,YACPqE,SAAAA,EAAW,CAAA,EACXC,QAAAA,EAAU,CAAA,EACVC,SAAAA,EAAW,GACXC,SAAAA,EAAW,GACXZ,aAAAA,EAAe,CAAA,CAChB,EAAG,IACF,GAAM,CAAE1J,KAAAA,EAAME,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,CAAI,EAAKU,yBACjC6C,KAAKgG,YAAYD,CAAY,CAAC,EAE1B7M,EAAQqD,EAAOF,EAAkB,EAAXqK,EACtBvN,EAASsD,EAAOD,EAAkB,EAAXmK,EAE7B,KAAM,CAAEnN,OAAAA,EAAQzB,IAAAA,CAAG,EAAKkB,aAAaC,EAAOC,EAAQ,CAClDE,QAAS,CAAA,EACTC,YAAa,CAAA,CACd,CAAA,EACD,OAAKvB,GAKLiI,KAAK4G,KAAKpN,CAAM,EAChBwG,KAAKsG,aAAY,EACjBtG,KAAK6G,eAAexK,EAAOqK,EAAUlK,EAAOmK,EAAU5O,CAAG,EAErDyO,GAAYxG,KAAKL,IAAIS,MAAMmB,iBAAmBxJ,GAChDuJ,WAAWK,yBACT5J,EACAmB,EACAC,EACA6G,KAAKL,IAAIS,MAAMmB,eAAe,EAIlCvB,KAAK8F,OAAO/N,EAAKgO,CAAY,EAC7B/F,KAAK8G,iBAAgB,EAEjBL,EACK,IAAIvI,QAAQ,CAACK,EAASwI,KAC3BvN,EAAOwN,OAAO,IACRC,EACF1I,EAAQ0I,CAAI,EAEZF,GAEH,EAAE5E,CAAI,CACT,CAAC,EAEI3I,EAAO0N,UAAU/E,CAAI,IA9B1BgF,QAAQC,MAAM,4BAA4B,EACnC,GA8BV,CAEDR,KAAKpN,GACCwG,KAAK0F,cACPlM,EAAOC,MAAMC,QAAU,+DACvBlC,SAASmG,KAAKC,YAAYpE,CAAM,EAEnC,CAGDsN,mBACE,GAAM,CAAE5N,MAAAA,EAAOC,OAAAA,EAAQqH,MAAAA,EAAOH,QAAAA,EAASC,QAAAA,EAASvI,IAAAA,CAAG,EAAKiI,KAAK2F,UAC7D3F,KAAKL,IAAIS,MAAMI,MAAQA,EACvBR,KAAKL,IAAIS,MAAMC,QAAUA,EACzBL,KAAKL,IAAIS,MAAME,QAAUA,EACzBN,KAAKL,IAAIzG,MAAQA,EACjB8G,KAAKL,IAAIxG,OAASA,EACdpB,IACFiI,KAAKL,IAAI5H,IAAMA,EAElB,CAGD8O,eAAexK,EAAcG,EAAczE,GACzCiI,KAAKL,IAAI5H,IAAMA,EACfiI,KAAKL,IAAIzG,MAAe,EAAPmD,EACjB2D,KAAKL,IAAIxG,OAAgB,EAAPqD,EAClBwD,KAAKL,IAAIS,MAAMI,MAAQ,EACvBR,KAAKL,IAAIS,MAAMC,QAAU,EACzBL,KAAKL,IAAIS,MAAME,QAAU,CAC1B,CAGD0F,YAAYD,EAAe,CAAA,GAEzB,GAAI,CAACA,EACH,OAAO/F,KAAKL,IAAI0H,MAAMjK,SAGxBvG,IAAIyQ,EAA2B,GAM/B,OALItH,KAAKL,IAAI0H,MAAME,WACjBD,EAAcE,KAAKxH,KAAKL,IAAI0H,MAAME,UAAU,EACnCvH,KAAKL,IAAI8H,UAAUC,kBAAiB,IAC7CJ,EAAgBtH,KAAKL,IAAI8H,UAAUE,kBAAiB,GAE/C3H,KAAKL,IAAI0H,MAAMjK,SAASwK,OAAO,GACpCN,EAAcO,SAASlM,CAAI,CAAC,CAE/B,CACF,OC1KoBmM,OACZ5O,MAEAC,OAEA4O,GAEAhQ,IAEPgI,YACE7G,EACAC,EACA6O,GAEAhI,KAAK9G,MAAQA,EACb8G,KAAK7G,OAASA,EACd,GAAM,CAAEK,OAAAA,EAAQzB,IAAAA,CAAK,EAAGkB,aAAaC,EAAOC,EAAQ6O,CAAG,EACnDjQ,IACFiI,KAAK+H,GAAKvO,EACVwG,KAAKjI,IAAMA,EAEd,CAEDkQ,cACE,GAAM,CAAE/O,MAAAA,EAAOC,OAAAA,CAAQ,EAAG6G,KAC1BA,KAAKjI,KAAKmQ,UAAU,CAAChP,EAAQ,EAAG,CAACC,EAAS,EAAGD,EAAOC,CAAM,CAC3D,CACF,OC3BoBgP,KACZxI,IAEAnG,OAEAzB,IAEPgI,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAKxG,OAAS,KAEdwG,KAAKjI,IAAM,KAEXiI,KAAKoI,KAAI,EAETpI,KAAKL,IAAIkB,GAAG,aAAcb,KAAKqI,WAAYrI,IAAI,EAE/CA,KAAKL,IAAIkB,GAAG,eAAgBb,KAAKqI,WAAYrI,IAAI,CAClD,CAGDsI,sBACE,GAAM,CAAExF,UAAAA,EAAW5J,MAAAA,EAAOkH,MAAAA,CAAK,EAAKJ,KAAKL,IACnC,CAAE4I,WAAAA,EAAY/H,MAAAA,CAAO,EAAGJ,EAC9BvJ,IAAI2R,EAAW,EACf,GACwB,KAAA,IAAfD,GACU,KAAA,IAAV/H,GACoB,KAAA,IAApB+H,EAAWE,KAGlBtB,QAAQC,MAAM,qDAAqD,MANrE,CASA,IAAKvQ,IAAItC,EAAI,CAAC2E,EAAQ,EAAG3E,EAAI2E,EAAQ,EAAG3E,GAAKgU,EAAWE,KACtDzI,KAAK0I,iBAAiBnU,CAAC,EACvBiU,EAAWjU,EAGb,IACEsC,IAAItC,EAAI,CAAC2E,EAAQ,EAAIqP,EAAWE,KAChClU,EAAI,CAACuO,EAAU6F,WAAWzP,EAAQsH,EAAQ,CAAC,EAC3CjM,GAAKgU,EAAWE,KAEhBzI,KAAK0I,iBAAiBnU,CAAC,EAGzB,IACEsC,IAAItC,EAAIiU,EAAWD,EAAWE,KAC9BlU,EAAIuO,EAAUmC,WAAW/L,EAAQsH,EAAQ,CAAC,EAC1CjM,GAAKgU,EAAWE,KAEhBzI,KAAK0I,iBAAiBnU,CAAC,CAnBxB,CAqBF,CAGDqU,wBACE,GAAM,CAAE9F,UAAAA,EAAW3J,OAAAA,EAAQiH,MAAAA,CAAK,EAAKJ,KAAKL,IACpC,CAAE4I,WAAAA,EAAY/H,MAAAA,CAAO,EAAGJ,EAC9B,GACwB,KAAA,IAAfmI,GACU,KAAA,IAAV/H,GACoB,KAAA,IAApB+H,EAAWE,KAHpB,CAOA5R,IAAIgS,EAAY,EAChB,IAAKhS,IAAItC,EAAI,CAAC4E,EAAS,EAAG5E,EAAI4E,EAAS,EAAG5E,GAAKgU,EAAWE,KACxDzI,KAAK8I,mBAAmBvU,CAAC,EACzBsU,EAAYtU,EAGd,IACEsC,IAAItC,EAAI,CAAC4E,EAAS,EAAIoP,EAAWE,KACjClU,EAAI,CAACuO,EAAUiG,WAAW5P,EAASqH,EAAQ,CAAC,EAC5CjM,GAAKgU,EAAWE,KAEhBzI,KAAK8I,mBAAmBvU,CAAC,EAG3B,IACEsC,IAAItC,EAAIsU,EAAYN,EAAWE,KAC/BlU,EAAIuO,EAAUoC,WAAW/L,EAASqH,EAAQ,CAAC,EAC3CjM,GAAKgU,EAAWE,KAEhBzI,KAAK8I,mBAAmBvU,CAAC,CApB1B,CAsBF,CAED8T,aACErI,KAAKxG,OAAOyO,cACZ,GAAM,CAAEM,WAAAA,EAAY/H,MAAAA,EAAOwI,SAAAA,CAAU,EAAGhJ,KAAKL,IAAIS,MAC5C4I,IAIHhJ,KAAKjI,KACLyI,GACA+H,GACAvI,KAAKjI,IAAIkR,aACTjJ,KAAKjI,IAAIyH,YAETQ,KAAKjI,IAAI6J,OACT5B,KAAKjI,IAAIyI,MAAMA,EAAOA,CAAK,EAE3BR,KAAKjI,IAAIkR,YAAcV,EAAWU,YAElCjJ,KAAKjI,IAAIyH,UAAY+I,EAAW/I,WAGlCQ,KAAKsI,oBAAmB,EAExBtI,KAAK4I,sBAAqB,EAE1B5I,KAAKjI,KAAKiK,UACX,CAGD8G,mBAAmBvU,GACjB,GAAM,CAAEuO,UAAAA,EAAW5J,MAAAA,EAAOkH,MAAAA,CAAK,EAAKJ,KAAKL,IACd,KAAA,IAAhBS,EAAMI,QAGX0I,EAAKpG,EAAUiG,WAAWxU,CAAC,EACjCyL,KAAKjI,KAAKoR,YACVnJ,KAAKjI,KAAKqR,OAAO,CAAClQ,EAAQkH,EAAMI,MAAQ,EAAG0I,CAAE,EAC7ClJ,KAAKjI,KAAKsR,OAAOnQ,EAAQkH,EAAMI,MAAQ,EAAG0I,CAAE,EAC5ClJ,KAAKjI,KAAKuR,SACX,CAGDZ,iBAAiBnU,GACf,GAAM,CAAEuO,UAAAA,EAAW3J,OAAAA,EAAQiH,MAAAA,CAAK,EAAKJ,KAAKL,IACf,KAAA,IAAhBS,EAAMI,QAGX0I,EAAKpG,EAAU6F,WAAWpU,CAAC,EACjCyL,KAAKjI,KAAKoR,YACVnJ,KAAKjI,KAAKqR,OAAOF,EAAI,CAAC/P,EAASiH,EAAMI,MAAQ,CAAC,EAC9CR,KAAKjI,KAAKsR,OAAOH,EAAI/P,EAASiH,EAAMI,MAAQ,CAAC,EAC7CR,KAAKjI,KAAKuR,SACX,CAEDN,WACEhJ,KAAKL,IAAIuB,YAAY,CACnB8H,SAAU,CAAA,CACJ,CAAA,EACRhJ,KAAKqI,WAAU,CAChB,CAEDkB,WACEvJ,KAAKL,IAAIuB,YAAY,CACnB8H,SAAU,CAAA,CACJ,CAAA,EACRhJ,KAAKxG,OAAOyO,aACb,CAEDuB,WAAWC,EAAS,IAClBzJ,KAAKL,IAAIuB,YAAY,CACnBqH,WAAY,CACV,GAAGvI,KAAKL,IAAIS,MAAMmI,WAClB,GAAGkB,CACJ,CACK,CAAA,EACJzJ,KAAKL,IAAIS,MAAM4I,WACjBhJ,KAAKuJ,SAAQ,EACbvJ,KAAKgJ,SAAQ,EAEhB,CAEDZ,OACMpI,KAAKxG,QACPwG,KAAKL,IAAI+B,QAAQgI,YAAY1J,KAAKxG,OAAOuO,EAAE,EAE7C,GAAM,CAAE7O,MAAAA,EAAOC,OAAAA,GAAW6G,KAAKL,IAC/BK,KAAKxG,OAAS,IAAIsO,OAAO5O,EAAOC,EAAQ,CACtCI,UAAW,MACZ,CAAA,EACDyG,KAAKjI,IAAMiI,KAAKxG,OAAOzB,IACvBiI,KAAKL,IAAI+B,QAAQiI,aAAa3J,KAAKxG,OAAOuO,GAAI/H,KAAKL,IAAI+B,QAAQkI,SAAS,EAAE,CAC3E,CACF,OCvLoBC,QACZlK,IAEAmK,aAEAzM,OAEA0M,MAEAC,SAEPjK,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAK8J,aAAe,GAEpB9J,KAAK3C,OAAS,EAEd2C,KAAK+J,MAAQ,CAAC,EAEd/J,KAAKgK,SAAW,CAAC,CAClB,CAEDC,aACEjK,KAAKL,IAAI2E,KAAK,UAAWtE,KAAK+J,MAAO/J,KAAK3C,MAAM,CACjD,CAEDkG,MACE,OAAOvD,KAAK8J,aAAa9J,KAAK3C,OAAS,EACxC,CAED6M,QACElK,KAAK+J,MAAQ,CAAC,EACd/J,KAAK3C,OAAS,EACd2C,KAAK8J,aAAe,GACpB9J,KAAKiK,WAAU,CAChB,CAEDE,IAAIC,GACF,IAAMC,EAAqB,EAAdrK,KAAK3C,OAAa2C,KAAK8J,aAAa9J,KAAK3C,OAAS,GAAK,KAC9DiN,EAAWtT,SAASoT,CAAI,EAC1BE,IAAaD,IAGjBrK,KAAK8J,aAAatC,KAAK8C,CAAQ,EAC/BtK,KAAK3C,QAAU,EACf2C,KAAK+J,MAAQ/J,KAAK3C,OAAS,EAC3B2C,KAAKiK,WAAU,EAChB,CAEDM,UACE,MAAMC,EAAUxK,KAAKL,IAAIkG,QAAO,EAC1BuE,EAAOpK,KAAK8J,aAAa9J,KAAK+J,OAG9BU,GADNzK,KAAKgK,SAAWhK,KAAK+J,MACH/J,KAAK3C,QACvB2C,KAAKL,IACF+K,QAAQN,EAAM,CAAA,CAAI,EAClBO,KAAK,KACJ3K,KAAK+J,MAAQ/J,KAAKgK,SAClBhK,KAAK3C,OAASoN,EACdzK,KAAKiK,WAAU,EACfjK,KAAKL,IAAI2E,KAAK,SAAU8F,CAAI,EAC5BpK,KAAKL,IAAIiL,oBAAoBJ,EAASJ,CAAI,EAC1CpK,KAAKL,IAAIkL,oBAAoBL,EAASJ,CAAI,CAC5C,CAAC,EACAU,MAAM,KAEL3D,QAAQC,MAAM,+BAA+B,CAC/C,CAAC,CACJ,CAED2D,OACM/K,KAAK+J,OAAS,IAGlB/J,EAAAA,KAAK+J,MACL/J,KAAKuK,QAAO,EACb,CAEDS,OACMhL,KAAK+J,OAAS/J,KAAK3C,OAAS,IAGhC2C,KAAK+J,OAAS,EACd/J,KAAKuK,QAAO,EACb,CACF,OCtFoBU,kBAAkBpI,aAC9BlD,IAEAoI,GAEPmD,QAEOC,UAEAC,UAQAtM,SAEAuM,UAEAC,SAEPvL,YAAYJ,GACV2D,QAEAtD,KAAKL,IAAMA,EAEXK,KAAK+H,GAAK,KAEV/H,KAAKkL,QAAU,CAAA,EAEflL,KAAKmL,UAAY,KAEjBnL,KAAKoL,UAAY,KAEjBpL,KAAKlB,SAAW,IAEhBkB,KAAKqL,UAAY,IAEjBrL,KAAKsL,SAAWtL,KAAKlB,SAAWkB,KAAKqL,UAErCrL,KAAKuL,oBAAsBvL,KAAKuL,oBAAoB1H,KAAK7D,IAAI,CAC9D,CAEDwL,mBAAmBlW,EAAWC,GAC5B,IAMM4D,EALD6G,KAAKoL,WAKJjS,EANQ,IAMS6G,KAAKoL,UAAUK,MACjCzL,KAAKmL,YACRnL,KAAKmL,UAAY3T,SAASC,cAAc,KAAK,EAC7CuI,KAAKmL,UAAU1R,MAAMgE,SAAW,QAChCuC,KAAKmL,UAAU1R,MAAMP,MAAQ,QAC7B8G,KAAKmL,UAAU1R,MAAMN,OAAYA,EAAH,KAC9B6G,KAAKmL,UAAU1R,MAAMiS,wBAA0B1L,KAAKoL,UAAU1M,QAC9DsB,KAAKmL,UAAU1R,MAAMkS,eAAiB,QACtC3L,KAAKmL,UAAU1R,MAAMmS,cAAgB,OACrCpU,SAASmG,KAAKC,YAAYoC,KAAKmL,SAAS,GAEpCU,EAAK7L,KAAKL,IAAImD,UAAUgJ,gBAAgBxW,EAAGC,CAAC,EAClDyK,KAAKmL,UAAU1R,MAAMiE,KAAUmO,EAAGvW,EAAI4D,GAAV,KAC5B8G,KAAKmL,UAAU1R,MAAMsS,IAASF,EAAGtW,EAAI4D,EAAS,EAAnB,MAhBzBgO,QAAQC,MAAM,mBAAmB,CAiBpC,CAED5E,QACMxC,KAAK+H,KACP/H,KAAK+H,GAAGiE,MAAQ,IAElBhM,KAAKkL,QAAU,CAAA,EACXlL,KAAKmL,WACP3T,SAASmG,KAAK+L,YAAY1J,KAAKmL,SAAS,EAE1CnL,KAAKmL,UAAY,KACjBnL,KAAKoL,UAAY,IAClB,CAEDa,kBAAkB3U,GAChB,OAAO,IAAI4G,QAAQ,CAACK,EAASwI,KAC3B,MAAMmF,EAAS,IAAIC,WACnBD,EAAOE,UAAY,KACjB7N,EAAQ2N,EAAOG,MAAM,CACvB,EACAH,EAAO1N,QAAU,KACfuI,GACF,EACAmF,EAAOI,cAAchV,CAAI,CAC3B,CAAC,CACF,CAEDiV,mBAAmB7N,GAQjB,OAAO,IAAIR,QAAQ,CAACK,EAASwI,KAC3B,MAAM5I,EAAM,IAAIC,MAChBD,EAAIE,aAAa,cAAe,WAAW,EAC3CF,EAAIG,OAAS,KACXzH,IAAMqC,EAAUiF,EAAVjF,SACAC,EAAWgF,EAAXhF,UACN,IAAMsS,EAAQtN,EAAIjF,MAAQiF,EAAIhF,QAC1BgF,EAAIjF,MAAQ8G,KAAKlB,UAAYX,EAAIhF,OAAS6G,KAAKqL,aAC7CI,EAAQzL,KAAKsL,UACfpS,EAAQ8G,KAAKlB,SACb3F,EAAS6G,KAAKlB,SAAW2M,IAEzBtS,EAAS6G,KAAKqL,UACdnS,EAAQ8G,KAAKqL,UAAYI,IAG7BlN,EAAQ,CACNiO,SAAUrO,EACVsK,KAAM,CACJvP,MAAAA,EACAC,OAAAA,CACD,EACDsS,MAAAA,CACM,CAAA,CACV,EACAtN,EAAIK,QAAU,KACZuI,GACF,EACA5I,EAAIM,IAAMC,CACZ,CAAC,CACF,CAED6M,0BAA0BpX,GACxB,IAMQqY,EAAU/D,EAAMgD,EANlB/M,EAAM+N,MAAMzM,KAAKiM,YAAY9X,EAAEuY,OAAOC,MAAM,EAAE,EACjC,UAAf,OAAOjO,EAETyI,QAAQC,MAAM,mBAAmB,GAG7B,CAAEoF,SAAAA,EAAU/D,KAAAA,EAAMgD,MAAAA,CAAK,EAAKgB,MAAMzM,KAAKuM,aAAa7N,CAAG,EAC7DsB,KAAKkL,QAAU,CAAA,EACflL,KAAKoL,UAAY,CACf1M,IAAAA,EACA,GAAG+J,EACHgD,MAAAA,EACAe,SAAAA,GAEFxM,KAAKsE,KAAK,oBAAqBtE,KAAKoL,SAAS,EAC9C,CAEDwB,cACO5M,KAAK+H,KACR/H,KAAK+H,GAAKvQ,SAASC,cAAc,OAAO,EACxCuI,KAAK+H,GAAGtO,MAAMgE,SAAW,QACzBuC,KAAK+H,GAAGtO,MAAMiE,KAAO,aACrBsC,KAAK+H,GAAG5F,KAAO,OACfnC,KAAK+H,GAAG8E,OAAS,UACjB7M,KAAK+H,GAAG1C,iBAAiB,SAAUrF,KAAKuL,mBAAmB,EAC3D/T,SAASmG,KAAKC,YAAYoC,KAAK+H,EAAE,GAEnC/H,KAAK+H,GAAGnQ,OACT,CACF,OCpKoBkV,WACZnN,IAEAhP,SAEAoc,YAEPhN,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAKrP,SAAWA,SAEhBqP,KAAK+M,YAAc,GAEnB/M,KAAKE,UAAS,CACf,CAGD8M,cAAcC,GAENC,GADND,EAAMA,EAAIvU,QAAQ,OAAQ,MAAM,GAE7BC,MAAM,UAAU,EAChBwU,IAAI,GAAoB,QAATC,EAAiB,IAAMA,CAAK,EAC9C,MAAMC,EAAa,GAKnB,OAJAH,EAAOxQ,QAAQ,IAEb2Q,EAAI7F,KAAK7W,SAASyc,EAAK,CACzB,CAAC,EACMC,CACR,CAGDC,sBAAsBnZ,GASpB,IAAMkZ,EAAM,GAaZ,OAZIlZ,EAAEoZ,SAAWpZ,EAAEqZ,UACjBH,EAAI7F,KAAK7W,SAASe,OAAO,EAEvByC,EAAEsZ,QACJJ,EAAI7F,KAAK7W,SAASgB,GAAG,EAEnBwC,EAAEuZ,UACJL,EAAI7F,KAAK7W,SAASc,KAAK,EAEpB4b,EAAIxF,SAAS1T,EAAE2M,OAAO,GACzBuM,EAAI7F,KAAKrT,EAAE2M,OAAO,EAEbuM,CACR,CAGDM,SACExZ,EACA8Y,GAEA,MAAMpY,EAAImL,KAAKsN,sBAAsBnZ,CAAC,EACtC,IAAMM,EAAIuL,KAAKgN,cAAcC,CAAG,EAChC,GAAIpY,EAAEwI,SAAW5I,EAAE4I,OACjB,MAAO,CAAA,EAET,IAAKxG,IAAItC,EAAI,EAAGA,EAAIM,EAAEwI,OAAQ9I,GAAK,EAAG,CACpC,IAAMwV,EAAQtV,EAAEmZ,UAAU,GAAUR,IAASvY,EAAEN,EAAE,EACjD,GAAc,CAAC,IAAXwV,EACF,MAAO,CAAA,EAETtV,EAAEoZ,OAAO9D,EAAO,CAAC,CAClB,CACD,MAAO,CAAA,CACR,CAED7F,UAAU/P,GACR2Z,OAAOC,KAAK/N,KAAK+M,WAAW,EAAErQ,QAAQ,IAChCsD,KAAK2N,SAASxZ,EAAG8Y,CAAG,IACtB9Y,EAAEsQ,gBAAe,EACjBtQ,EAAEuQ,eAAc,EAChB1E,KAAK+M,YAAYE,GAAKvQ,QACpB,IACEtI,EAAE0D,GAAGM,KAAKhE,EAAE2D,GAAG,CACjB,CAAC,EAGP,CAAC,CACF,CAGDiW,YAAYf,EAAanV,EAASC,GAChCkV,EAAItU,MAAM,UAAU,EAAE+D,QAAQ,IACxBsD,KAAK+M,YAAYK,GACnBpN,KAAK+M,YAAYK,GAAM5F,KAAK,CAC1B1P,GAAAA,EACAC,IAAAA,CACD,CAAA,EAEDiI,KAAK+M,YAAYK,GAAQ,CACvB,CACEtV,GAAAA,EACAC,IAAAA,CACD,EAGP,CAAC,CACF,CAGDkW,eAAehB,EAAanV,GAC1BmV,EAAItU,MAAM,UAAU,EAAE+D,QAAQ,IAC5B,IAEUqN,EAFN/J,KAAK+M,YAAYK,KACftV,EAIY,CAAC,KAHTiS,EAAQ/J,KAAK+M,YAAYK,GAAMQ,UACnC,GAAoBxZ,EAAE0D,KAAOA,CAAE,IAG/BkI,KAAK+M,YAAYK,GAAMS,OAAO9D,EAAO,CAAC,GAGxC/J,KAAK+M,YAAYK,GAAQ,GACzB,OAAOpN,KAAK+M,YAAYK,IAG9B,CAAC,CACF,CAEDlN,YACEF,KAAKL,IAAIY,MAAMM,GAAG,UAAWb,KAAKkE,UAAWlE,IAAI,CAClD,CAEDkO,cACElO,KAAKL,IAAIY,MAAM4N,IAAI,UAAWnO,KAAKkE,SAAS,CAC7C,CACF,CC/HM,MAAMkK,wBAA0B,CAACzS,EAAWE,IACjDiB,6BAA6BjB,EAAGvG,EAAGuG,EAAGtG,EAAGoG,CAAY,EAAIA,EAAO,KAGrD0S,gBAAkB,CAACnV,EAAeC,IAC7C5C,KAAK+X,IAAI/X,KAAK6D,IAAIlB,CAAK,EAAG3C,KAAK6D,IAAIjB,CAAM,CAAC,EAAI,EAGnCoV,0BAA4B,CAACC,EAAoB3S,KAC5DhF,IAAI4X,EAAM,CAAA,EAOV,OANAD,EAAS9R,QAAQ,IACX+R,GACAlU,iBAAiBsB,EAAGvG,EAAGuG,EAAGtG,EAAG,GAAGmZ,EAAKjZ,cAAc,IACrDgZ,EAAM,CAAA,EAEV,CAAC,EACMA,CACT,EAGaE,oBAAsB,CAAChT,EAAWE,KAC7C,GAAM,CAAE3C,MAAAA,EAAOC,OAAAA,EAAQ7D,EAAAA,EAAGC,EAAAA,CAAC,EAAKoG,EAC1BiT,EAASP,gBAAgBnV,EAAOC,CAAM,EACtCqB,EAAMX,yBAAyBgC,EAAGvG,EAAGuG,EAAGtG,EAAGD,EAAIsZ,EAAQrZ,EAAIqZ,CAAM,EAGvE,OADEpU,GAAOoU,EAASnZ,gBAAkB+E,GAAOoU,EAASnZ,eAClCkG,EAAO,IAC3B,EAGakT,uBAAyB,CAAClT,EAAWE,KAChD,GAAM,CAAEvG,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,CAAM,EAAKwC,EAC1B6S,EAAqB,CACzB,CAAClZ,EAAGC,EAAGD,EAAI4D,EAAO3D,GAClB,CAACD,EAAI4D,EAAO3D,EAAGD,EAAI4D,EAAO3D,EAAI4D,GAC9B,CAAC7D,EAAI4D,EAAO3D,EAAI4D,EAAQ7D,EAAGC,EAAI4D,GAC/B,CAAC7D,EAAGC,EAAI4D,EAAQ7D,EAAGC,IAErB,OAAOgZ,0BAA0BC,EAAU3S,CAAE,EAAIF,EAAO,IAC1D,EAGamT,sBAAwB,CAACnT,EAAYE,KAChD,GAAM,CAAEvG,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,CAAM,EAAKwC,EAC1B6S,EAAW,CACf,CAAClZ,EAAI4D,EAAQ,EAAG3D,EAAGD,EAAI4D,EAAO3D,EAAI4D,GAClC,CAAC7D,EAAI4D,EAAO3D,EAAI4D,EAAQ7D,EAAGC,EAAI4D,GAC/B,CAAC7D,EAAGC,EAAI4D,EAAQ7D,EAAI4D,EAAQ,EAAG3D,IAEjC,OAAOgZ,0BAA0BC,EAAsB3S,CAAE,EAAIF,EAAO,IACtE,EAGaoT,qBAAuB,CAACpT,EAAWE,KAC9C,GAAM,CAAEvG,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,CAAM,EAAKwC,EAC1B6S,EAAW,CACf,CAAClZ,EAAI4D,EAAQ,EAAG3D,EAAGD,EAAI4D,EAAO3D,EAAI4D,EAAS,GAC3C,CAAC7D,EAAI4D,EAAO3D,EAAI4D,EAAS,EAAG7D,EAAI4D,EAAQ,EAAG3D,EAAI4D,GAC/C,CAAC7D,EAAI4D,EAAQ,EAAG3D,EAAI4D,EAAQ7D,EAAGC,EAAI4D,EAAS,GAC5C,CAAC7D,EAAGC,EAAI4D,EAAS,EAAG7D,EAAI4D,EAAQ,EAAG3D,IAErC,OAAOgZ,0BAA0BC,EAAsB3S,CAAE,EAAIF,EAAO,IACtE,EAGaqT,mBAAqB,CAACrT,EAAWE,KAC5C,IAAQM,EAAkBR,EAAlBQ,iBACR,OAA6B,KAAA,IAAlBA,IAOLqS,EAAW,CAAC,CAJRrS,EAAc,GAAG,GACjBA,EAAc,GAAG,GAChBA,EAAcA,EAAckB,OAAS,GAAG,GACxClB,EAAcA,EAAckB,OAAS,GAAG,KAE5CkR,0BAA0BC,EAAsB3S,CAAE,GAAIF,EAAO,IACtE,EAGasT,+BAAiC,CAACtT,EAAYE,KACzDhF,IAAI4X,EAAmB,KACvB,OAAkC,KAAA,IAAvB9S,EAAKQ,cACP,MAETR,EAAKQ,cAAcO,QAAQ,IACrB+R,GACQ5U,yBACVgC,EAAGvG,EACHuG,EAAGtG,EACHoH,EAAW,GACXA,EAAW,EAAE,GAEJlH,iBACTgZ,EAAM9S,EAEV,CAAC,EACM8S,EACT,EAGaS,kBAAoB,CAACvT,EAAYE,KAC5C,IAAM2S,EAAW,GACjB,GAAkC,KAAA,IAAvB7S,EAAKQ,cACd,OAAO,KAET,IAAMgT,EAAMxT,EAAKQ,cAAckB,OACzBgQ,EAAM1R,EAAKQ,cACjB,IAAKtF,IAAItC,EAAI,EAAGA,EAAI4a,EAAM,EAAG5a,GAAK,EAChCia,EAAShH,KAAK,CAAC,GAAG6F,EAAI9Y,GAAI,GAAG8Y,EAAI9Y,EAAI,GAAG,EAE1C,OAAOga,0BAA0BC,EAAsB3S,CAAE,EAAIF,EAAO,IACtE,+eCjHqByT,iBAAiBvM,aAC7BlD,IAEAwC,KAEA8K,IAEAoC,SAEAjJ,SAEAC,WAEAiJ,OAEAC,OAEPja,EAEAC,EAEA2D,MAEAC,OAEOqW,YAEAlU,OAEA6K,SAEA1M,MAEPgW,SAEA1P,YAAY2P,EAAc/P,GACxB2D,QACAtD,KAAKL,IAAMA,EAEXK,KAAKmC,KAAOuN,EAAQvN,MAAQ,GAE5BnC,KAAKiN,IAAMlW,gBAEXiJ,KAAKqP,SAAW,CAAA,EAEhBrP,KAAKoG,SAAW,CAAA,EAEhBpG,KAAKqG,WAAa,CAAA,EAElBrG,KAAKsP,OAAS,EACdtP,KAAKuP,OAAS,EAEdvP,KAAK1K,EAAIoa,EAAQpa,GAAK,EACtB0K,KAAKzK,EAAIma,EAAQna,GAAK,EAEtByK,KAAK9G,MAAQwW,EAAQxW,OAAS,EAC9B8G,KAAK7G,OAASuW,EAAQvW,QAAU,EAEhC6G,KAAKwP,YAAc,EAEnBxP,KAAK1E,OAASoU,EAAQpU,QAAU,EAEhC0E,KAAKmG,SAAW,CAAA,EAEhBnG,KAAKvG,MAAQ,CACXwP,YAAajJ,KAAKL,IAAIS,MAAMuP,aAC5B7N,UAAW,cACXtC,UAAW,EACXoQ,SAAU,EACVC,YAAa,EACb,GAAIH,EAAQjW,OAAS,IAGvBuG,KAAKyP,SAAWK,KAAAA,CACjB,CAIDC,QAAQza,EAAWC,GACjB,MAAM,IAAIya,MAAM,2CAA2C,CAC5D,CAGDC,aAAaC,GAEX,OADAlQ,KAAKmQ,aAAanQ,KAAKwP,YAAcU,CAAE,EAChClQ,IACR,CAGDoQ,SAAS3W,EAAQ,IACf,MAAM4W,EAAS5W,EAef,OAdAqU,OAAOC,KAAKsC,CAAM,EAAE3T,QAAQ,IACd,aAARuQ,EACoB,EAAlBoD,EAAOT,UACT5P,KAAKL,IAAI5H,IAAIuY,YAAY,CAACD,EAAOT,SAAS,EAG5BE,KAAAA,IAAhBO,EAAOpD,IACS,KAAhBoD,EAAOpD,IACS,OAAhBoD,EAAOpD,KAGPjN,KAAKL,IAAI5H,IAAIkV,GAAOoD,EAAOpD,GAE/B,CAAC,EACMjN,IACR,CAGDuQ,WAAWC,GACT,GAAM,CAAElb,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,EAAQmC,OAAAA,EAAQ7B,MAAAA,CAAO,EAAGuG,KACzC,CAAE1K,EAAG0F,EAAIzF,EAAG0F,CAAI,EAAG+E,KAAKL,IAAImD,UAAU2N,UAAUnb,EAAGC,CAAC,EACpDmb,EAAYxX,EAAQ,EACpByX,EAAaxX,EAAS,EACtB2B,EAAKE,EAAK0V,EACV3V,EAAKE,EAAK0V,EAchB,OAbA3Q,KAAKL,IAAI5H,IAAI6J,OACb5B,KAAKL,IAAI5H,IAAI6B,UAAUkB,EAAIC,CAAE,EAC7BiF,KAAKL,IAAI5H,IAAIuD,OAAOvC,SAASuC,CAAM,CAAC,EACpC0E,KAAKoQ,SAAS3W,CAAK,EACnB+W,EAAS,CACPE,UAAAA,EACAC,WAAAA,EACA3V,GAAAA,EACAC,GAAAA,EACAH,GAAAA,EACAC,GAAAA,CACD,CAAA,EACDiF,KAAKL,IAAI5H,IAAIiK,UACNhC,IACR,CAGD2F,YACE,GAAM,CAAErK,OAAAA,EAAQhG,EAAAA,EAAGC,EAAAA,CAAC,EAAKyK,KAIzB,OAHAA,KAAKwP,YAAclU,EACnB0E,KAAKsP,OAASha,EACd0K,KAAKuP,OAASha,EACPyK,IACR,CAGD4Q,KAAKC,EAAYC,GACf,GAAM,CAAExB,OAAAA,EAAQC,OAAAA,CAAQ,EAAGvP,KAI3B,OAHAA,KAAK1K,EAAIga,EAASuB,EAClB7Q,KAAKzK,EAAIga,EAASuB,EAClB9Q,KAAKsE,KAAK,qBAAsBtE,KAAK1K,EAAG0K,KAAKzK,CAAC,EACvCyK,IACR,CAGDmQ,aAAa7U,GAKX0E,KAAK1E,OAFHA,GAFFA,GAAU,KACG,EACF,IAAMA,EAEHA,EACd0E,KAAKL,IAAIoR,qBAAqB/Q,KAAK1E,MAAM,CAC1C,CAGD0V,eAAe1V,EAAgBR,EAAYC,GACzCiF,KAAKiQ,aAAa3U,CAAM,EAClB2V,EAAK5V,qBAAqB2E,KAAKsP,OAAQtP,KAAKuP,OAAQzU,EAAIC,EAAIO,CAAM,EACxE0E,KAAKkR,UAAUD,EAAG3b,EAAG2b,EAAG1b,CAAC,CAC1B,CAGD4b,YAAYC,EAAoBjd,GAE9B,OADA6L,KAAKyP,SAAS0B,YAAYC,EAAYjd,CAAC,EAChC6L,IACR,CAGDqR,YAEE,OADArR,KAAKyP,SAAS4B,YACPrR,IACR,CAGDsR,UAAUpZ,GAER,OADA8H,KAAKyP,SAAS8B,iBAAiB,GAAGrZ,CAAI,EAC/B8H,IACR,CAGD1C,uBACE,OAAOS,mBAAmBiC,IAAW,CACtC,CAGDwR,WAAWlc,EAAWC,EAAW2D,EAAeC,GAG9C,OAFA6G,KAAKkR,UAAU5b,EAAGC,CAAC,EACnByK,KAAKyR,WAAWvY,EAAOC,CAAM,EACtB6G,IACR,CAGDyR,WAAWvY,EAAeC,GAIxB,OAHA6G,KAAK9G,MAAQA,EACb8G,KAAK7G,OAASA,EACd6G,KAAKsE,KAAK,iBAAkBtE,KAAK9G,MAAO8G,KAAK7G,MAAM,EAC5C6G,IACR,CAGDkR,UAAU5b,EAAWC,GAInB,OAHAyK,KAAK1K,EAAIA,EACT0K,KAAKzK,EAAIA,EACTyK,KAAKsE,KAAK,qBAAsBtE,KAAK1K,EAAG0K,KAAKzK,CAAC,EACvCyK,IACR,CAGD0R,YACE,MAAO,CACLvP,KAAMnC,KAAKmC,KACXjJ,MAAO8G,KAAK9G,MACZC,OAAQ6G,KAAK7G,OACb7D,EAAG0K,KAAK1K,EACRC,EAAGyK,KAAKzK,EACR+F,OAAQ0E,KAAK1E,OACb7B,MAAO,CACL,GAAGuG,KAAKvG,KACT,EAEJ,CAGDkY,iBACM3R,KAAKoG,UAAY,CAACpG,KAAKqP,UACzBrP,KAAKyP,SAASmC,UACd5R,KAAKyP,SAAS3J,UACL9F,KAAKqG,aAEdrG,KAAKyP,SAASoC,eACd7R,KAAKyP,SAAS3J,SAEjB,CAGDA,SACE,MAAM,IAAIkK,MAAM,2CAA2C,CAC5D,CACF,OCrPoB8B,oCAAoC1C,SAChD2C,mBAEA5V,cAEA6V,WAEAC,YAEAC,qBAEPnS,YAAYoS,EAAWxS,GACrB2D,MAAM6O,EAAMxS,CAAG,EAEfK,KAAK+R,mBAAqB,GAE1B/R,KAAK7D,cAAgBgW,EAAKhW,eAAiB,GAE3C6D,KAAKgS,WAAa,EAClBhS,KAAKiS,YAAc,EAEnBjS,KAAKkS,qBAAuB,CAC1B5c,EAAG,EACHC,EAAG,EAEN,CAGDic,WAAWlc,EAAWC,EAAW2D,EAAeC,GAC9C,GAAM,CAAE6Y,WAAAA,EAAYC,YAAAA,EAAaF,mBAAAA,CAAkB,EAAK/R,KACxD,GACwB,KAAA,IAAfgS,GACgB,KAAA,IAAhBC,EAFT,CAMA,MAAMG,EAASlZ,EAAQ8Y,EACjBK,EAASlZ,EAAS8Y,EACxBjS,KAAK7D,cAAgB4V,EAAmB5E,IAAI,IAG1C,MAAO,CAFIxQ,EAAW,GAAKyV,EAChBzV,EAAW,GAAK0V,EACX,GAAG1V,EAAW2V,MAAM,CAAC,EACvC,CAAC,EACKzQ,EAAY3F,gBAAgB8D,KAAK7D,aAAa,EACpD,MAAMoW,EAAU1Q,EAAKvM,EAAIA,EACnBkd,EAAU3Q,EAAKtM,EAAIA,EACzByK,KAAK7D,cAAgB6D,KAAK7D,cAAcgR,IACtC,GAAgC,CAC9BxQ,EAAW,GAAK4V,EAChB5V,EAAW,GAAK6V,EAChB,GAAG7V,EAAW2V,MAAM,CAAC,EACtB,EAEHtS,KAAKkR,UAAU5b,EAAGC,CAAC,EACnByK,KAAKyR,WAAWvY,EAAOC,CAAM,CAnB5B,CAoBD,OAAO6G,IACR,CAGDgR,eAAe1V,EAAgBR,EAAYC,GACzCiF,KAAK7D,cAAgB6D,KAAK+R,mBAAmB5E,IAAI,IAC/C,IAAM8D,EAAK5V,qBACTsB,EAAW,GACXA,EAAW,GACX7B,EACAC,EACAO,CAAM,EAER,MAAO,CAAC2V,EAAG3b,EAAG2b,EAAG1b,EAAG,GAAGoH,EAAW2V,MAAM,CAAC,EAC3C,CAAC,EACDtS,KAAKyS,sCAAqC,CAC3C,CAGDf,YAEE,MAAO,CACL,GAFWpO,MAAMoO,YAGjBvV,cAAe,CAAC,GAAG6D,KAAK7D,eAE3B,CAGDmB,uBACE,OAAO0C,KAAK7D,cAAcgR,IAAI,IAC5B,IAAMpR,EAASL,wBAAwBsE,IAAW,EAC5CiR,EAAK5V,qBACTsB,EAAW,GACXA,EAAW,GACXZ,EAAOzG,EACPyG,EAAOxG,EACPyK,KAAK1E,MAAgB,EAEvB,MAAO,CACLhG,EAAG2b,EAAG3b,EACNC,EAAG0b,EAAG1b,EAEV,CAAC,CACF,CAGDmd,cAAcpd,EAAWC,KAAc2C,GACrC,GAAKya,MAAMC,QAAQ5S,KAAK7D,aAAa,EAIrC,OADA6D,KAAK7D,cAAcqL,KAAK,CAAClS,EAAGC,EAAG,GAAG2C,EAAK,EAChC8H,IACR,CAGDyS,wCACE,IAAM5Q,EAAY3F,gBAAgB8D,KAAK7D,aAAa,EAKpD,OAJA6D,KAAK1K,EAAIuM,EAAKvM,EACd0K,KAAKzK,EAAIsM,EAAKtM,EACdyK,KAAK9G,MAAQ2I,EAAK3I,MAClB8G,KAAK7G,OAAS0I,EAAK1I,OACZ6G,IACR,CAGD6S,2BAA2Bvd,EAAWC,GACpCyK,KAAKkS,qBAAqB5c,EAAIA,EAC9B0K,KAAKkS,qBAAqB3c,EAAIA,CAC/B,CAGDqb,KAAKC,EAAYC,GACf9Q,KAAK7D,cAAgB6D,KAAK+R,mBAAmB5E,IAAI,GAAgB,CAC/DxQ,EAAW,GAAKkU,EAChBlU,EAAW,GAAKmU,EAChB,GAAGnU,EAAW2V,MAAM,CAAC,EACtB,EACD,GAAM,CAAEhD,OAAAA,EAAQC,OAAAA,CAAQ,EAAGvP,KAK3B,OAJIsP,GAAUC,IACZvP,KAAK1K,EAAIga,EAASuB,EAClB7Q,KAAKzK,EAAIga,EAASuB,GAEb9Q,IACR,CAGD2F,YACE,GAAM,CAAErK,OAAAA,EAAQhG,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,EAAQgD,cAAAA,CAAe,EAAG6D,KAOvD,OANAA,KAAKwP,YAAclU,EACnB0E,KAAKsP,OAASha,EACd0K,KAAKuP,OAASha,EACdyK,KAAK+R,mBAAqB/a,SAASmF,CAAa,EAChD6D,KAAKgS,WAAa9Y,EAClB8G,KAAKiS,YAAc9Y,EACZ6G,IACR,CACF,CCvJM,MAAM8S,SAAW,CAAC/a,EAAUD,EAASiK,EAAO,CAAA,KACjDhK,EAAIoR,UAAS,EACbrR,IACAC,EAAIuR,OAAM,EACNvH,GACFhK,EAAIgK,KAAI,CAEZ,EAGagR,WAAa,CACxBhb,EACAzC,EACAC,EACAP,EACA+M,EAAO,CAAA,KAEP+Q,SACE/a,EACA,KACEA,EAAIib,IAAI1d,EAAGC,EAAGP,EAAG,EAAG,EAAIuB,KAAKuC,EAAE,CAChC,EACDiJ,CAAI,CAER,EAGakR,UAAY,CAAClb,EAAUoE,KAClC,MAAM7G,EAAI6G,EAAc,GAAG,GACrB5G,EAAI4G,EAAc,GAAG,GACrBnB,EAAKmB,EAAcA,EAAckB,OAAS,GAAG,GAC7CpC,EAAKkB,EAAcA,EAAckB,OAAS,GAAG,GAW7C6V,GAVNJ,SACE/a,EACA,KACEA,EAAIqR,OAAO9T,EAAGC,CAAC,EACfwC,EAAIsR,OAAOrO,EAAIC,CAAE,CAClB,EACD,CAAA,CAAI,EAIUrC,SAASrC,KAAK6E,MAAMH,EAAK1F,EAAGyF,EAAK1F,CAAC,CAAC,GACnDwd,SACE/a,EACA,KACE,IAAMob,EALE,GAKcD,EAChBE,EAAKpY,EAPL,GAOczE,KAAKiF,IAAIzC,SAASoa,CAAO,CAAC,EACxCE,EAAKpY,EARL,GAQc1E,KAAKkF,IAAI1C,SAASoa,CAAO,CAAC,EAC9Cpb,EAAIqR,OAAOgK,EAAIC,CAAE,EACjBtb,EAAIsR,OAAOrO,EAAIC,CAAE,CAClB,EACD,CAAA,CAAI,EAEN6X,SAAS/a,EAAK,KACZ,IAAMob,EAAU,GAAKD,EAdX,GAeJE,EAAKpY,EAhBH,GAgBYzE,KAAKkF,IAAI1C,SAASoa,CAAO,CAAC,EACxCE,EAAKpY,EAjBH,GAiBY1E,KAAKiF,IAAIzC,SAASoa,CAAO,CAAC,EAC9Cpb,EAAIqR,OAAOgK,EAAIC,CAAE,EACjBtb,EAAIsR,OAAOrO,EAAIC,CAAE,CACnB,CAAC,CACH,EAGaqY,SAAW,CACtBvb,EACAzC,EACAC,EACA2D,EACAC,EACA4I,EAAO,CAAA,KAEP+Q,SAAS/a,EAAK,KACZA,EAAI8J,KAAKvM,EAAGC,EAAG2D,EAAOC,CAAM,EACxB4I,GACFhK,EAAIwb,SAASje,EAAGC,EAAG2D,EAAOC,CAAM,CAEpC,CAAC,CACH,EAGaqa,YAAc,CACzBzb,EACAzC,EACAC,EACA2D,EACAC,EACA4I,EAAO,CAAA,KAEP+Q,SACE/a,EACA,KACEA,EAAIqR,OAAO9T,EAAI4D,EAAQ,EAAG3D,CAAC,EAC3BwC,EAAIsR,OAAO/T,EAAI4D,EAAO3D,EAAI4D,EAAS,CAAC,EACpCpB,EAAIsR,OAAO/T,EAAI4D,EAAQ,EAAG3D,EAAI4D,CAAM,EACpCpB,EAAIsR,OAAO/T,EAAGC,EAAI4D,EAAS,CAAC,EAC5BpB,EAAI0b,UAAS,CACd,EACD1R,CAAI,CAER,EAGM2R,iCAAmC,CACvC/W,EACAqL,KAQA,GAAM,CAAE1S,EAAAA,EAAGC,EAAAA,GAAMyS,EAAIrI,IAAImD,UAAU2N,UAAU9T,EAAW,GAAIA,EAAW,EAAE,EACzE,MAAO,CAACrH,EAAI0S,EAAIlN,GAAIvF,EAAIyS,EAAIjN,GAAI,GAAG4B,EAAW2V,MAAM,CAAC,EACvD,EAGaqB,gBAAkB,CAC7B5b,EACA6b,EACAC,EACA7Y,EACAC,EACAuE,EAAY,KAEZsT,SAAS/a,EAAK,KACI,EAAZyH,IACFzH,EAAIyH,UAAYA,GAElBzH,EAAIqR,OAAOwK,EAAIC,CAAE,EACjB9b,EAAIsR,OAAOrO,EAAIC,CAAE,EACjBlD,EAAI+b,QAAU,QACd/b,EAAIgc,SAAW,OACjB,CAAC,CACH,EAGaC,aAAe,CAC1Bjc,EACAzC,EACAC,EACA2D,EACAC,EACA4I,EAAO,CAAA,KAEP+Q,SACE/a,EACA,KACEA,EAAIqR,OAAO9T,EAAI4D,EAAQ,EAAG3D,CAAC,EAC3BwC,EAAIsR,OAAO/T,EAAI4D,EAAO3D,EAAI4D,CAAM,EAChCpB,EAAIsR,OAAO/T,EAAGC,EAAI4D,CAAM,EACxBpB,EAAI0b,UAAS,CACd,EACD1R,CAAI,CAER,EAGakS,kBAAoB,CAC/Blc,EACAmc,EACAlM,KAEA,IAAKnR,IAAItC,EAAI,EAAGA,EAAI2f,EAAY7W,OAAS,EAAG9I,GAAK,EAC/Cue,SACE/a,EACA,KACE,IAAM4E,EAAa+W,iCAAiCQ,EAAY3f,GAAIyT,CAAG,EACjEmM,EAAiBT,iCACrBQ,EAAY3f,EAAI,GAChByT,CAAG,EAEL2L,gBACE5b,EACA4E,EAAW,GACXA,EAAW,GACXwX,EAAe,GACfA,EAAe,GACfA,EAAe,EAAE,CAEpB,EACD,CAAA,CAAI,CAGV,EAGaC,SAAW,CAACrc,EAAUsc,EAAc/e,EAAWC,KAC1D,KAAM,CAAEkD,KAAAA,EAAMgB,MAAAA,CAAO,EAAG4a,EAClBC,EAAa7a,EAAMnB,SAAWmB,EAAM0F,gBAC1C2T,SAAS/a,EAAK,KACZA,EAAIwc,KAAOlc,cAAcoB,EAAMnB,SAAUmB,EAAMlB,UAAU,EACzDR,EAAIyc,aAAe,SACHhc,eAAeC,CAAI,EAC3BiE,QAAQ,CAACqC,EAASgL,KACxBhS,EAAI0c,SAAS1V,EAASzJ,EAAGC,GAAKwU,EAAQuK,EAAaA,EAAa,EAAE,CACpE,CAAC,CACH,CAAC,CACH,EAGaI,UAAY,CACvB3c,EACA4D,EACArG,EACAC,EACA2D,EACAC,KAEA2Z,SAAS/a,EAAK,KAEZlB,IAAI8d,EAAY,EACZC,EAAa,EAFH1b,EAAQC,EAGVwC,EAAK8P,OACfmJ,EAAazb,EACbwb,EAAYhZ,EAAK8P,MAAQtS,IAEzBwb,EAAYzb,EACZ0b,EAAa1b,EAAQyC,EAAK8P,OAE5B1T,EAAI8c,UAAUlZ,EAAK6Q,SAAUlX,EAAGC,EAAGof,EAAWC,CAAU,CAC1D,CAAC,CACH,EAGaE,SAAW,CAAC/c,EAAUmc,KACjCpB,SAAS/a,EAAK,KACZlB,IAAIke,EAAQ,CAAA,EACZb,EAAYxX,QAAQ,IACdqY,GACFA,EAAQ,CAAA,EACRhd,EAAIqR,OAAOzM,EAAW,GAAIA,EAAW,EAAE,GAEvC5E,EAAIsR,OAAO1M,EAAW,GAAIA,EAAW,EAAE,CAE3C,CAAC,CACH,CAAC,CACH,6SCxOqBqY,iBAAiB5F,SAC7BM,QAEA/T,KAEAsZ,OAEAxM,KAEA2I,WAEA8D,mBAEAC,6BAEAC,UAEAC,UAEPtV,YAAYpE,EAAWgE,EAAgB+P,EAAU,IAC/CpM,MACE,CACEnB,KAAM,WACNmT,gBAAiB,CAAA,CAClB,EACD3V,CAAG,EAILK,KAAK0P,QAAU,CACb6F,UAAW,CAAA,EACX,GAAG7F,GAGL1P,KAAKvG,MAAQ,CACXwP,YAAa,OACbnH,UAAW,cACXtC,UAAW,QACXoQ,SAAU,EACVC,YAAa,GAIf7P,KAAKrE,KAAOA,EAGZqE,KAAKiV,OAAS,EAGdjV,KAAKyI,KAAO,GAGZzI,KAAKoR,WAAa,GAGlBpR,KAAKkV,mBAAqB,CACxB5f,EAAG,EACHC,EAAG,GAILyK,KAAKmV,6BAA+B,CAClC7f,EAAG,EACHC,EAAG,GAILyK,KAAKoV,UAAY,EAGjBpV,KAAKqV,UAAY,GAEjBrV,KAAK1K,EAAI,EACT0K,KAAKzK,EAAI,CACV,CAID4b,YAAYC,EAAoBjd,GAC9B6L,KAAKoR,WAAaA,EACdpR,KAAK0P,QAAQ6F,YACfvV,KAAKoV,UAAYpV,KAAKrE,KAAKzC,MAAQ8G,KAAKrE,KAAKxC,QAE3CiY,IAAerb,gBAAgBC,MAExBob,IAAerb,gBAAgBE,OACxC+J,KAAKrE,KAAKgK,YACDyL,IAAerb,gBAAgBG,gBACxC8J,KAAKwV,oBAAoBrhB,EAAGuB,YAAYC,QAAQ,EACvCyb,IAAerb,gBAAgBI,iBACxC6J,KAAKwV,oBAAoBrhB,EAAGuB,YAAYE,SAAS,EACxCwb,IAAerb,gBAAgBK,oBACxC4J,KAAKwV,oBAAoBrhB,EAAGuB,YAAYG,YAAY,EAC3Cub,IAAerb,gBAAgBM,oBACxC2J,KAAKwV,oBAAoBrhB,EAAGuB,YAAYI,WAAW,CAEtD,CAIDub,YACErR,KAAKoR,WAAa,GAClBpR,KAAKkV,mBAAqB,CACxB5f,EAAG,EACHC,EAAG,GAELyK,KAAKmV,6BAA+B,CAClC7f,EAAG,EACHC,EAAG,GAELyK,KAAKoV,UAAY,CAClB,CAGDI,oBAAoBrhB,EAAyCshB,GAC3D,IAAMC,EAAYha,wBAAwBsE,KAAKrE,IAAI,EAC7Cga,EAAW/Y,mCAAmCoD,KAAKrE,KAAM8Z,CAAM,EACrEzV,KAAKkV,mBAAmB5f,EAAI,EAAIogB,EAAUpgB,EAAIqgB,EAAIrgB,EAClD0K,KAAKkV,mBAAmB3f,EAAI,EAAImgB,EAAUngB,EAAIogB,EAAIpgB,EAClDyK,KAAKmV,6BAA6B7f,EAAInB,EAAEwQ,QAAUgR,EAAIrgB,EACtD0K,KAAKmV,6BAA6B5f,EAAIpB,EAAEyQ,QAAU+Q,EAAIpgB,EACtDyK,KAAKrE,KAAKgK,WACX,CAGD4L,iBACEpd,EACAyf,EACAC,EACAtB,EACAC,GAEA,IAAQpB,EAAepR,KAAfoR,cACJA,IAAerb,gBAAgBC,KACjCgK,KAAK4V,eAAerD,EAASC,CAAO,EAC3BpB,IAAerb,gBAAgBE,OACxC+J,KAAK6V,iBAAiB1hB,EAAGyf,EAAIC,CAAE,EACtBzC,IAAerb,gBAAgBG,gBACxC8J,KAAK8V,kBACH3hB,EACA,CACE4hB,EACAla,KACI,CACJ3C,MAA8B,GAAtB6c,EAAUzgB,EAAIuG,EAAGvG,GACzB6D,OAA+B,GAAtB4c,EAAUxgB,EAAIsG,EAAGtG,EAC3B,GACD,IAA6B,CAC3BD,EAAGuG,EAAGvG,EACNC,EAAGsG,EAAGtG,CACP,GACD,CACEygB,EACAC,KAEApf,IAAMvB,EAAM2gB,EAAN3gB,KACAC,EAAM0gB,EAAN1gB,KAMN,OALIygB,EAAWhW,KAAKoV,UAClB9f,EAAI2gB,EAAQ3gB,EAAI2gB,EAAQ/c,MAAQ8G,KAAKoV,UAAYa,EAAQ9c,OAChD6c,EAAWhW,KAAKoV,YACzB7f,EAAI0gB,EAAQ1gB,GAAK0gB,EAAQ9c,OAAS8c,EAAQ/c,MAAQ8G,KAAKoV,YAElD,CACL9f,EAAAA,EACAC,EAAAA,EAEJ,CAAC,EAEM6b,IAAerb,gBAAgBI,iBACxC6J,KAAK8V,kBACH3hB,EACA,CACE4hB,EACAla,KACI,CACJ3C,MAA8B,GAAtB2C,EAAGvG,EAAIygB,EAAUzgB,GACzB6D,OAA+B,GAAtB4c,EAAUxgB,EAAIsG,EAAGtG,EAC3B,GACD,CAACsG,EAA2Bqa,KAAgC,CAC1D5gB,EAAGuG,EAAGvG,EAAI4gB,EAAQhd,MAClB3D,EAAGsG,EAAGtG,CACP,GACD,CACEygB,EACAC,KAEApf,IAAMvB,EAAM2gB,EAAN3gB,KACAC,EAAM0gB,EAAN1gB,KAON,OANIygB,EAAWhW,KAAKoV,UAClB9f,EAAI2gB,EAAQ3gB,EAAI0K,KAAKoV,UAAYa,EAAQ9c,OAChC6c,EAAWhW,KAAKoV,YACzB9f,EAAI2gB,EAAQ3gB,EAAI2gB,EAAQ/c,MACxB3D,EAAI0gB,EAAQ1gB,GAAK0gB,EAAQ9c,OAAS8c,EAAQ/c,MAAQ8G,KAAKoV,YAElD,CACL9f,EAAAA,EACAC,EAAAA,EAEJ,CAAC,EAEM6b,IAAerb,gBAAgBK,oBACxC4J,KAAK8V,kBACH3hB,EACA,CACE4hB,EACAla,KACI,CACJ3C,MAA8B,GAAtB2C,EAAGvG,EAAIygB,EAAUzgB,GACzB6D,OAA+B,GAAtB0C,EAAGtG,EAAIwgB,EAAUxgB,EAC3B,GACD,CACEsG,EACAqa,KACI,CACJ5gB,EAAGuG,EAAGvG,EAAI4gB,EAAQhd,MAClB3D,EAAGsG,EAAGtG,EAAI2gB,EAAQ/c,MACnB,GACD,CACE6c,EACAC,KAEApf,IAAMvB,EAAM2gB,EAAN3gB,KACAC,EAAM0gB,EAAN1gB,KAQN,OAPIygB,EAAWhW,KAAKoV,WAClB9f,EAAI2gB,EAAQ3gB,EAAI0K,KAAKoV,UAAYa,EAAQ9c,OACzC5D,EAAI0gB,EAAQ1gB,EAAI0gB,EAAQ9c,QACf6c,EAAWhW,KAAKoV,YACzB9f,EAAI2gB,EAAQ3gB,EAAI2gB,EAAQ/c,MACxB3D,EAAI0gB,EAAQ1gB,EAAI0gB,EAAQ/c,MAAQ8G,KAAKoV,WAEhC,CACL9f,EAAAA,EACAC,EAAAA,EAEJ,CAAC,EAEM6b,IAAerb,gBAAgBM,oBACxC2J,KAAK8V,kBACH3hB,EACA,CACE4hB,EACAla,KACI,CACJ3C,MAA8B,GAAtB6c,EAAUzgB,EAAIuG,EAAGvG,GACzB6D,OAA+B,GAAtB0C,EAAGtG,EAAIwgB,EAAUxgB,EAC3B,GACD,CAACsG,EAA8Bqa,KAAiC,CAC9D5gB,EAAGuG,EAAGvG,EACNC,EAAGsG,EAAGtG,EAAI2gB,EAAQ/c,MACnB,GACD,CACE6c,EACAC,KAEApf,IAAMvB,EAAM2gB,EAAN3gB,KACAC,EAAM0gB,EAAN1gB,KAON,OANIygB,EAAWhW,KAAKoV,WAClB9f,EAAI2gB,EAAQ3gB,EAAI2gB,EAAQ/c,MAAQ8G,KAAKoV,UAAYa,EAAQ9c,OACzD5D,EAAI0gB,EAAQ1gB,EAAI0gB,EAAQ9c,QACf6c,EAAWhW,KAAKoV,YACzB7f,EAAI0gB,EAAQ1gB,EAAI0gB,EAAQ/c,MAAQ8G,KAAKoV,WAEhC,CACL9f,EAAAA,EACAC,EAAAA,EAEJ,CAAC,CAGN,CAGDqgB,eAAerD,EAAiBC,GAC9BxS,KAAKrE,KAAKiV,KAAK2B,EAASC,CAAO,CAChC,CAGDqD,iBACE1hB,EACAyf,EACAC,GAEA,IAAM6B,EAAYha,wBAAwBsE,KAAKrE,IAAI,EAC7CL,EAAST,uBACb6a,EAAUpgB,EACVogB,EAAUngB,EACVpB,EAAEwQ,QACFxQ,EAAEyQ,QACFgP,EACAC,CAAE,EAEJ7T,KAAKrE,KAAKsU,aAAa3U,CAAM,CAC9B,CAGD6a,aAAaC,EAAQ,IACnBpW,KAAKqV,UAAYe,CAClB,CAGDxE,UACE5R,KAAKmW,aAAa,EAAE,CACrB,CAGDtE,eACE7R,KAAKmW,aAAa,CAChBpgB,gBAAgBE,OAChBF,gBAAgBG,gBAChBH,gBAAgBI,iBAChBJ,gBAAgBK,oBAChBL,gBAAgBM,mBACV,CACT,CAGDggB,SACErW,KAAK1K,EAAI0K,KAAKrE,KAAKrG,EAAI0K,KAAKiV,OAC5BjV,KAAKzK,EAAIyK,KAAKrE,KAAKpG,EAAIyK,KAAKiV,OAC5BjV,KAAK9G,MAAQ8G,KAAKrE,KAAKzC,MAAsB,EAAd8G,KAAKiV,OACpCjV,KAAK7G,OAAS6G,KAAKrE,KAAKxC,OAAuB,EAAd6G,KAAKiV,OACtCjV,KAAK1E,OAAS0E,KAAKrE,KAAKL,MACzB,CAGDgb,YACEhhB,EACAC,EACAghB,EAIAC,GAEA,IAAMT,EAAY,CAChBzgB,GAAIA,EAAI0K,KAAKkV,mBAAmB5f,GAAK,EACrCC,GAAIA,EAAIyK,KAAKkV,mBAAmB3f,GAAK,GAEjCsG,EAAKD,iCACTtG,EACAC,EACAwgB,EAAUzgB,EACVygB,EAAUxgB,EACVyK,KAAKrE,KAAKL,MAAM,EAEZ4a,EAAUK,EAASR,EAAWla,CAAE,EACtChF,IAAI4f,EAAiB,CAAA,EAKjBC,GAJAR,EAAQhd,MAAQ,IAClBgd,EAAQhd,MAAQ,EAChBud,EAAiB,CAAA,GAEG,CAAA,GAClBP,EAAQ/c,OAAS,IACnB+c,EAAQ/c,OAAS,EACjBud,EAAkB,CAAA,GAEdC,EAASH,EAAQ3a,EAAIqa,CAAO,EAC5BD,EAAU,CACd3gB,EAAGqhB,EAAOrhB,EACVC,EAAGohB,EAAOphB,EACV2D,MAAOgd,EAAQhd,MACfC,OAAQ+c,EAAQ/c,QAMlB,OAJIsd,GAAkBC,KACpBT,EAAQ3gB,EAAI0K,KAAKrE,KAAKrG,EACtB2gB,EAAQ1gB,EAAIyK,KAAKrE,KAAKpG,GAEjB,CACL0gB,QAAAA,EACAF,UAAAA,EAEH,CAGDD,kBACE3hB,EACAoiB,EACAC,EACAI,GAEA,IAAMC,EAAa1iB,EAAEwQ,QAAU3E,KAAKmV,6BAA6B7f,EAC3DwhB,EAAa3iB,EAAEyQ,QAAU5E,KAAKmV,6BAA6B5f,EAC3D,CAAE0gB,QAAAA,EAASF,UAAAA,CAAS,EAAK/V,KAAKsW,YAClCO,EACAC,EACAP,EACAC,CAAO,EAELxW,KAAK0P,QAAQ6F,UACfvV,KAAK+W,WAAWd,EAASF,EAAWQ,EAAUC,EAASI,CAAM,EAG/D5W,KAAKrE,KAAK6V,WAAWyE,EAAQ3gB,EAAG2gB,EAAQ1gB,EAAG0gB,EAAQ/c,MAAO+c,EAAQ9c,MAAM,CACzE,CAGD4d,WACEd,EACAF,EACAQ,EAoBAC,EAiBAI,GAqBMI,EAAKJ,EADMX,EAAQ/c,MAAQ+c,EAAQ9c,OACb8c,CAAO,EAC7Bpa,EAAKR,qBACT2b,EAAG1hB,EACH0hB,EAAGzhB,EACHwgB,EAAUzgB,EACVygB,EAAUxgB,EACVyK,KAAKrE,KAAKL,MAAM,EAEZ2b,EAAajX,KAAKsW,YAAYza,EAAGvG,EAAGuG,EAAGtG,EAAGghB,EAAUC,CAAO,EAAEP,QAC1C,IAArBgB,EAAW/d,OAAqC,IAAtB+d,EAAW9d,QAGzC6G,KAAKrE,KAAK6V,WACRyF,EAAW3hB,EACX2hB,EAAW1hB,EACX0hB,EAAW/d,MACX+d,EAAW9d,MAAM,CAEpB,CAED2M,SACE9F,KAAKqW,OAAM,EACX,KAAM,CAAEnd,MAAAA,EAAOC,OAAAA,CAAQ,EAAG6G,KAC1BA,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7C3Q,KAAKL,IAAI5H,IAAI6J,OACR5B,KAAKqV,UAAUxN,SAAS9R,gBAAgBC,IAAI,IAC/CgK,KAAKL,IAAI5H,IAAIuY,YAAY,CAAC,EAAE,EAC5BgD,SAAStT,KAAKL,IAAI5H,IAAK,CAAC2Y,EAAW,CAACC,EAAYzX,EAAOC,CAAM,EAC7D6G,KAAKL,IAAI5H,IAAIiK,WAEVhC,KAAKqV,UAAUxN,SAAS9R,gBAAgBG,eAAe,GAC1Dod,SACEtT,KAAKL,IAAI5H,IACT,CAAC2Y,EAAY1Q,KAAKyI,KAClB,CAACkI,EAAa3Q,KAAKyI,KACnBzI,KAAKyI,KACLzI,KAAKyI,IAAI,EAGRzI,KAAKqV,UAAUxN,SAAS9R,gBAAgBI,gBAAgB,GAC3Dmd,SACEtT,KAAKL,IAAI5H,IACT,CAAC2Y,EAAY1Q,KAAKrE,KAAKzC,MAAQ8G,KAAKyI,KACpC,CAACkI,EAAa3Q,KAAKyI,KACnBzI,KAAKyI,KACLzI,KAAKyI,IAAI,EAGRzI,KAAKqV,UAAUxN,SAAS9R,gBAAgBK,mBAAmB,GAC9Dkd,SACEtT,KAAKL,IAAI5H,IACT,CAAC2Y,EAAY1Q,KAAKrE,KAAKzC,MAAQ8G,KAAKyI,KACpC,CAACkI,EAAa3Q,KAAKrE,KAAKxC,OAAS6G,KAAKyI,KACtCzI,KAAKyI,KACLzI,KAAKyI,IAAI,EAGRzI,KAAKqV,UAAUxN,SAAS9R,gBAAgBM,kBAAkB,GAC7Did,SACEtT,KAAKL,IAAI5H,IACT,CAAC2Y,EAAY1Q,KAAKyI,KAClB,CAACkI,EAAa3Q,KAAKrE,KAAKxC,OAAS6G,KAAKyI,KACtCzI,KAAKyI,KACLzI,KAAKyI,IAAI,EAGRzI,KAAKqV,UAAUxN,SAAS9R,gBAAgBE,MAAM,GACjD8c,WACE/S,KAAKL,IAAI5H,IACT,CAAC2Y,EAAY1Q,KAAKrE,KAAKzC,MAAQ,EAAI8G,KAAKyI,KAAO,EAC/C,CAACkI,EAAyB,EAAZ3Q,KAAKyI,KACnBzI,KAAKyI,IAAI,CAGf,CAAC,CACF,CAGDyO,+BAA+B5hB,EAAWC,GACxCsB,IAAIsgB,EAAO,GACLtb,EAAKC,0BAA0BxG,EAAGC,EAAGyK,KAAKrE,IAAI,EAgCpD,OA/BImB,6BAA6BjB,EAAGvG,EAAGuG,EAAGtG,EAAGyK,IAAW,EACtDmX,EAAOphB,gBAAgBC,KAEvB6D,yBACEgC,EAAGvG,EACHuG,EAAGtG,EACHyK,KAAK1K,EAAI0K,KAAK9G,MAAQ,EACtB8G,KAAKzK,EAAgB,EAAZyK,KAAKyI,IAAQ,GACnBzI,KAAKyI,KAEV0O,EAAOphB,gBAAgBE,OAEvB+J,KAAKoX,2BAA2Bvb,EAAGvG,EAAGuG,EAAGtG,EAAGG,YAAYC,QAAQ,EAEhEwhB,EAAOphB,gBAAgBG,gBAEvB8J,KAAKoX,2BAA2Bvb,EAAGvG,EAAGuG,EAAGtG,EAAGG,YAAYE,SAAS,EAEjEuhB,EAAOphB,gBAAgBI,iBAEvB6J,KAAKoX,2BAA2Bvb,EAAGvG,EAAGuG,EAAGtG,EAAGG,YAAYG,YAAY,EAEpEshB,EAAOphB,gBAAgBK,oBAEvB4J,KAAKoX,2BAA2Bvb,EAAGvG,EAAGuG,EAAGtG,EAAGG,YAAYI,WAAW,IAEnEqhB,EAAOphB,gBAAgBM,oBAGvB8gB,EADEnX,KAAKqV,UAAUxN,SAASsP,CAAI,EACvB,GAEFA,CACR,CAGDC,2BAA2B9hB,EAAWC,EAAW0G,GAC/CpF,IAAIuc,EAAK,EACLC,EAAK,EACT,OAAQpX,GACN,KAAKvG,YAAYC,SACfyd,EAAKpT,KAAK1K,EAAI0K,KAAKyI,KACnB4K,EAAKrT,KAAKzK,EAAIyK,KAAKyI,KACnB,MACF,KAAK/S,YAAYE,UACfwd,EAAKpT,KAAK1K,EAAI0K,KAAK9G,MACnBma,EAAKrT,KAAKzK,EAAIyK,KAAKyI,KACnB,MACF,KAAK/S,YAAYG,aACfud,EAAKpT,KAAK1K,EAAI0K,KAAK9G,MACnBma,EAAKrT,KAAKzK,EAAIyK,KAAK7G,OACnB,MACF,KAAKzD,YAAYI,YACfsd,EAAKpT,KAAK1K,EAAI0K,KAAKyI,KACnB4K,EAAKrT,KAAKzK,EAAIyK,KAAK7G,MAItB,CACD,OAAO2D,6BAA6BxH,EAAGC,EAAG6d,EAAIC,EAAIrT,KAAKyI,KAAMzI,KAAKyI,IAAI,CACvE,CACF,OC9lBoB4O,sBAAsBvF,4BAClCxS,cAEPS,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,GAAG,EAG3CK,KAAKV,cAAgB,CAAC,CACvB,CAEDyQ,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAOiP,+BAA+BjP,KAAanE,CAAE,CACtD,CAGDyb,aACE1D,EACAC,EACA7Y,EACAC,EACAuE,GAEAQ,KAAKL,IAAI5H,IAAI6J,OACb+R,gBAAgB3T,KAAKL,IAAI5H,IAAK6b,EAAIC,EAAI7Y,EAAIC,EAAIuE,CAAS,EACvDQ,KAAKL,IAAI5H,IAAIiK,SACd,CAED8D,SACE,MAAQ3J,EAAuB6D,KAAvB7D,iBACR6D,KAAKuQ,WAAW,CAAA,CAAGzV,GAAAA,EAAIC,GAAAA,CAAS,KAC9BkZ,kBAAkBjU,KAAKL,IAAI5H,IAAKoE,EAAe,CAC7CwD,IAAKK,KAAKL,IACV7E,GAAAA,EACAC,GAAAA,CACD,CAAA,CACH,CAAC,EACDiF,KAAK2R,eAAc,CACpB,CACF,OCzCoB4F,cAAczF,4BACjC/R,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAML,CAAG,CACvC,CAEDoQ,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAOgP,mBAAmBhP,KAAMnE,CAAE,CACnC,CAEDiK,SACE,KAAM,CAAE3J,cAAAA,EAAe+V,qBAAAA,CAAsB,EAAQlS,KACrDA,KAAKuQ,WAAW,CAAA,CAAGzV,GAAAA,EAAIC,GAAAA,CAAgC,KAErDlE,IAAI2gB,EAA8B,GAClC,IACatc,EAAOC,EADO,EAAvBgB,EAAckB,QAAc2C,KAAKqP,WAC7B,CAAE/Z,EAAG4F,EAAI3F,EAAG4F,CAAE,EAAK6E,KAAKL,IAAImD,UAAU2N,UAC1CyB,EAAqB5c,EAAIwF,EACzBoX,EAAqB3c,EAAIwF,CAAE,EAE7Byc,EAAqB,CAAC,CAACtc,EAAIC,KAE7B8X,UACEjT,KAAKL,IAAI5H,IACToE,EACGgR,IAAI,IACH,GAAM,CAAE7X,EAAAA,EAAGC,EAAAA,GAAMyK,KAAKL,IAAImD,UAAU2N,UAClC9T,EAAW,GACXA,EAAW,EAAE,EAEf,MAAO,CAACrH,EAAIwF,EAAIvF,EAAIwF,EACtB,CAAC,EACA0c,OAAOD,CAAkB,CAAC,CAEjC,CAAC,EACDxX,KAAK2R,eAAc,CACpB,CACF,OCpCoB+F,eAAetI,SAClCrP,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,IAAK,CAC3C4V,UAAW,CAAA,CACZ,CAAA,CACF,CAEDxF,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAO2O,oBAAoB3O,KAAMnE,CAAE,CACpC,CAEDiK,SACE,KAAM,CAAE5M,MAAAA,EAAOC,OAAAA,CAAQ,EAAQ6G,KAC/BA,KAAKuQ,WAAW,KACdwC,WAAW/S,KAAKL,IAAI5H,IAAK,EAAG,EAAGsW,gBAAgBnV,EAAOC,CAAM,EAAG,CAAA,CAAI,CACrE,CAAC,EACD6G,KAAK2R,eAAc,CACpB,CACF,OCpBoBgG,gBAAgBvI,SACnCrP,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,GAAG,CAC5C,CAEDoQ,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAO+O,qBAAqB/O,KAAMnE,CAAE,CACrC,CAGDyB,uBACE,KAAM,CAAEhI,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,EAAQmC,OAAAA,CAAQ,EAAQ0E,KAC7C,IAAMkU,EAAc,CAClB,CAAC5e,EAAI4D,EAAQ,EAAG3D,GAChB,CAACD,EAAI4D,EAAO3D,EAAI4D,EAAS,GACzB,CAAC7D,EAAI4D,EAAQ,EAAG3D,EAAI4D,GACpB,CAAC7D,EAAGC,EAAI4D,EAAS,IAEnB,MAAM4C,EAASL,wBAAwBsE,IAAI,EAC3C,OAAOkU,EAAY/G,IAAI,GACrB9R,qBACEsB,EAAW,GACXA,EAAW,GACXZ,EAAOzG,EACPyG,EAAOxG,EACP+F,CAAM,CACP,CAEJ,CAEDwK,SACE,KAAM,CAAE5M,MAAAA,EAAOC,OAAAA,CAAQ,EAAQ6G,KAC/BA,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7C6C,YAAYxT,KAAKL,IAAI5H,IAAK,CAAC2Y,EAAW,CAACC,EAAYzX,EAAOC,EAAQ,CAAA,CAAI,CACxE,CAAC,EACD6G,KAAK2R,eAAc,CACpB,CACF,2BC5CkCvC,SAC1B1Q,IAEA8N,SAEAf,MAEP1L,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,IAAK,CAC3C4V,UAAW,CAAA,CACZ,CAAA,EAED,GAAM,CAAE7W,IAAAA,EAAK8N,SAAAA,EAAUf,MAAAA,CAAK,EAAUiE,EAEtC1P,KAAKtB,IAAMA,GAAO,GAElBsB,KAAKwM,SAAWA,GAAY,KAE5BxM,KAAKyL,MAAQA,GAAS,CACvB,CAEDsE,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAOoO,wBAAwBpO,KAAMnE,CAAE,CACxC,CAGD6V,YAEE,MAAO,CACL,GAFWpO,MAAMoO,YAGjBhT,IAAKsB,KAAKtB,IACV+M,MAAOzL,KAAKyL,MAEf,CAED3F,SACE,KAAM,CAAE5M,MAAAA,EAAOC,OAAAA,CAAQ,EAAQ6G,KAC/BA,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7C+D,UAAU1U,KAAKL,IAAI5H,IAAKiI,KAAM,CAAC0Q,EAAW,CAACC,EAAYzX,EAAOC,CAAM,CACtE,CAAC,EACD6G,KAAK2R,eAAc,CACpB,CACF,QC7CoBiG,aAAa9F,4BACzB+F,SAEP9X,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,GAAG,EAG3C,GAAM,CAAEkY,SAAAA,EAAW,CAAA,CAAO,EAAQnI,EAElC1P,KAAK6X,SAAWA,CACjB,CAED9H,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAOkP,kBAAkBlP,KAAanE,CAAE,CACzC,CAEDiK,SACE,KAAM,CAAE3J,cAAAA,EAAe+V,qBAAAA,CAAsB,EAAQlS,KACrDA,KAAKuQ,WAAW,CAAA,CAAGzV,GAAAA,EAAIC,GAAAA,CAAS,KAE9BlE,IAAI2gB,EAA8B,GAClC,IACatc,EAAOC,EADO,EAAvBgB,EAAckB,QAAc2C,KAAKqP,WAC7B,CAAE/Z,EAAG4F,EAAI3F,EAAG4F,CAAE,EAAK6E,KAAKL,IAAImD,UAAU2N,UAC1CyB,EAAqB5c,EAAIwF,EACzBoX,EAAqB3c,EAAIwF,CAAE,EAE7Byc,EAAqB,CAAC,CAACtc,EAAIC,KAE7B2Z,SACE9U,KAAKL,IAAI5H,IACToE,EACGgR,IAAI,IACH,GAAM,CAAE7X,EAAAA,EAAGC,EAAAA,GAAMyK,KAAKL,IAAImD,UAAU2N,UAClC9T,EAAW,GACXA,EAAW,EAAE,EAEf,MAAO,CAACrH,EAAIwF,EAAIvF,EAAIwF,EACtB,CAAC,EACA0c,OAAOD,CAAkB,CAAC,CAEjC,CAAC,EACDxX,KAAK2R,eAAc,CACpB,CACF,OC9CoBmG,kBAAkB1I,SACrCrP,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,GAAG,CAC5C,CAEDoQ,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAO6O,uBAAuB7O,KAAMnE,CAAE,CACvC,CAEDiK,SACE,KAAM,CAAE5M,MAAAA,EAAOC,OAAAA,CAAQ,EAAQ6G,KAC/BA,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7C2C,SAAStT,KAAKL,IAAI5H,IAAK,CAAC2Y,EAAW,CAACC,EAAYzX,EAAOC,EAAQ,CAAA,CAAI,CACrE,CAAC,EACD6G,KAAK2R,eAAc,CACpB,CACF,OCnBoBoG,aAAa3I,SACzB3W,KAEPsH,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,IAAK,CAC3C4V,UAAW,CAAA,CACZ,CAAA,EAEDvV,KAAKvH,KAAOiX,GAASjX,MAAQ,GAE7BuH,KAAKvG,MAAMqI,UAAY4N,GAASjW,OAAOqI,WAAa,UAEpD9B,KAAKvG,MAAMnB,SAAWoX,GAASjW,OAAOnB,UAAY,GAElD0H,KAAKvG,MAAM0F,gBAAkBuQ,GAASjW,OAAO0F,iBAAmB,IAEhEa,KAAKvG,MAAMlB,WACTmX,GAASjW,OAAOlB,YAAc,6BACjC,CAEDwX,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAOoO,wBAAwBpO,KAAMnE,CAAE,CACxC,CAID2V,WAAWlc,EAAWC,EAAW2D,EAAeC,GAC9C,GAAM,CAAEV,KAAAA,EAAMgB,MAAAA,CAAO,EAAGuG,KACxBA,KAAKvG,MAAMnB,SAAW/B,KAAKC,MACzB2C,EAASX,eAAeC,CAAI,EAAE4E,OAAS5D,EAAM0F,eAAe,EAE9DmE,MAAMkO,WAAWlc,EAAGC,EAAG2D,EAAOC,CAAM,CACrC,CAEDuY,YAEE,MAAO,CACL,GAFWpO,MAAMoO,YAGjBjZ,KAAMuH,KAAKvH,KAEd,CAEDqN,SACE9F,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7CyD,SAASpU,KAAKL,IAAI5H,IAAKiI,KAAM,CAAC0Q,EAAW,CAACC,CAAU,CACtD,CAAC,EACD3Q,KAAK2R,eAAc,CACpB,CACF,OC/CoBqG,iBAAiB5I,SACpCrP,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAMA,KAAKL,GAAG,CAC5C,CAGDrC,uBACE,KAAM,CAAEhI,EAAAA,EAAGC,EAAAA,EAAG2D,MAAAA,EAAOC,OAAAA,EAAQmC,OAAAA,CAAQ,EAAQ0E,KAC7C,IAAMkU,EAAc,CAClB,CAAC5e,EAAI4D,EAAQ,EAAG3D,GAChB,CAACD,EAAI4D,EAAO3D,EAAI4D,GAChB,CAAC7D,EAAGC,EAAI4D,IAEV,MAAM4C,EAASL,wBAAwBsE,IAAI,EAC3C,OAAOkU,EAAY/G,IAAI,GACrB9R,qBACEsB,EAAW,GACXA,EAAW,GACXZ,EAAOzG,EACPyG,EAAOxG,EACP+F,CAAM,CACP,CAEJ,CAEDyU,QAAQza,EAAWC,GACXsG,EAAKC,0BAA0BxG,EAAGC,EAAGyK,IAAI,EAC/C,OAAO8O,sBAAsB9O,KAAanE,CAAE,CAC7C,CAEDiK,SACE,KAAM,CAAE5M,MAAAA,EAAOC,OAAAA,CAAQ,EAAQ6G,KAC/BA,KAAKuQ,WAAW,CAAA,CAAGG,UAAAA,EAAWC,WAAAA,CAAiB,KAC7CqD,aAAahU,KAAKL,IAAI5H,IAAK,CAAC2Y,EAAW,CAACC,EAAYzX,EAAOC,EAAQ,CAAA,CAAI,CACzE,CAAC,EACD6G,KAAK2R,eAAc,CACpB,CACF,OC/BoBsG,MACZtY,IAEAvC,SAEPmK,WAEO2Q,aAEAC,SAEAC,WAEPrY,YAAYJ,GACVK,KAAKL,IAAMA,EAGXK,KAAK5C,SAAW,GAGhB4C,KAAKuH,WAAauI,KAAAA,EAGlB9P,KAAKkY,aAAe,CAAA,EAGpBlY,KAAKmY,SAAW,CAAA,EAGhBnY,KAAKoY,WAAa,KAGlBpY,KAAKqY,aAAexgB,SAASmI,KAAKqY,aAAcrY,KAAa,EAAE,CAChE,CAEDsY,WACE5I,EACA6I,EAAmC,OACnCxgB,EACAygB,GAiBA,MAfIxY,CAAAA,KAAKyY,iBAAmBzY,CAAAA,KAAKkY,eAGjCxI,EAAQgJ,GAAKpiB,YACPqF,EAAYqE,KAAK2Y,eAAejJ,CAAO,KAI7C1P,KAAK4Y,QAAQjd,CAAI,EACZ6c,GACHxY,KAAK6Y,cAAcld,CAAI,EAEzBqE,KAAKkY,aAAe,CAAA,EAEpBK,EAASngB,KAAKL,EAAK4D,CAAI,GAChBqE,IACR,CAED8Y,SAASnd,EAAY6c,EAAqB7C,GACxC,OAAO,IAAIzX,QAAa6a,MAAOxa,IAC7B,IAGM6L,EAHDzO,IAIa,WADZyO,EAAYzO,EAAK+V,eACdvP,MAAgC,MAAZiI,EAAK1L,MAChC0L,EAAKoC,SAAQ,MAAUvO,eAAemM,EAAK1L,GAAG,GAEhDsB,KAAKsY,WACHlO,EACA,IACEzO,EAAKwV,YAAYpb,gBAAgBC,IAAI,EACrCa,IAAIga,EAAK,GACLC,EAAK,GACL6E,IACF9E,EAAK8E,EAAIrgB,EAAIqG,EAAKrG,EAAIqG,EAAKzC,MAAQ,EACnC4X,EAAK6E,EAAIpgB,EAAIoG,EAAKpG,EAAIoG,EAAKxC,OAAS,GAEtC,IAAM6f,EAAmBhZ,KAAKL,IAAImD,UAAUsC,cAAcyL,EAAIC,CAAE,EAChEnV,EAAK2V,OAAO,KAAM,KAAM,KAAM0H,EAAiB1jB,EAAG0jB,EAAiBzjB,CAAC,EACpEoG,EAAK0T,SAAW,CAAA,EACZmJ,IACF7c,EAAKyK,SAAW,CAAA,GAElBpG,KAAKkY,aAAe,CAAA,EACpB3Z,EAAQ5C,CAAI,CACd,EACAqE,KACAwY,CAAS,EAEb,CAAC,CACF,CAGDS,wBACE9W,EACA7M,EACAC,EACAgd,EACAC,GAEAxS,KAAKsY,WAAW,CACdnW,KAAAA,EACA7M,EAAAA,EACAC,EAAAA,EACA2D,MAAOqZ,EACPpZ,OAAQqZ,CACT,CAAA,EACDxS,KAAKuH,YAAYkK,aAAac,EAASC,CAAO,CAC/C,CAGD0G,aAAa5jB,EAAWC,EAAWpB,GACjC6L,KAAKsY,WAAW,CACdnW,KAAM,SACN7M,EAAAA,EACAC,EAAAA,CACD,CAAA,EACKqZ,EAAS/U,yBAAyB1F,EAAEwQ,QAASxQ,EAAEyQ,QAAStP,EAAGC,CAAC,EAClEyK,KAAKuH,YAAYkK,aAAa7C,EAAQA,CAAM,CAC7C,CAGDuK,oBACEhlB,EACAoM,GAEAP,KAAKsY,WAAW,CACdnW,KAAM,gBACP,CAAA,EACD,IAAMxG,EAAOqE,KAAKuH,WAEZ/H,EAAYJ,yBAChBmB,EAAM4C,WACExH,GAAM2D,aAAa,EAOvB,CAAEwD,UAAAA,EAAW/K,IAAAA,EAAKqI,MAAAA,CAAK,GALzBzE,GAAM2D,gBACR3D,EAAK2D,cAAgBE,GAEvB7D,GAAM+W,gBAAgBve,EAAEwQ,QAASxQ,EAAEyQ,QAASpF,CAAS,EAEnBQ,KAAKL,KACjCyZ,EAAMtW,EAAUuW,2BACpBvW,EAAU6F,WAAWpI,EAAMwC,aAAazN,CAAC,EACzCwN,EAAUiG,WAAWxI,EAAMwC,aAAaxN,CAAC,CAAC,EAEtC+jB,EAAMxW,EAAUuW,2BACpBvW,EAAU6F,WAAWxU,EAAEwQ,OAAO,EAC9B7B,EAAUiG,WAAW5U,EAAEyQ,OAAO,CAAC,EAEjC7M,EAAI6J,KAAI,EACR7J,EAAIyI,MAAcJ,EAAMI,MAAeJ,EAAMI,KAAK,EAClD7E,GAAM2b,eAAe8B,EAAI9jB,EAAG8jB,EAAI7jB,EAAG+jB,EAAIhkB,EAAGgkB,EAAI/jB,EAAGiK,CAAS,EAC1DzH,EAAIiK,QAAO,CACZ,CAGDuX,YACEplB,EACA,CACE+E,MAAAA,EACAC,OAAAA,EACAqT,SAAAA,EACA9N,IAAAA,EACA+M,MAAAA,IASItG,EAAKnF,KAAKL,IAAImD,UAAUsC,cAC5BjR,EAAEqP,cAAgBtK,EAAQ,EAC1B/E,EAAEsP,cAAgBtK,EAAS,CAAC,EAE9B6G,KAAKsY,WAAW,CACdnW,KAAM,QACN7M,EAAG6P,EAAG7P,EACNC,EAAG4P,EAAG5P,EACNmJ,IAAAA,EACA8N,SAAAA,EACAtT,MAAAA,EACAC,OAAAA,EACAsS,MAAAA,CACD,CAAA,CACF,CAGD+N,YAAY7d,GACQ,SAAdA,EAAKwG,OAGTxG,EAAKwK,SAAW,CAAA,EAChBnG,KAAK6Y,cAAcld,CAAI,EACxB,CAGD8d,sBACE,IAAM9d,EAAOqE,KAAKuH,WACb5L,GAAsB,SAAdA,EAAKwG,OAGbxG,GAAMlD,MAAMihB,OAKjB/d,EAAKwK,SAAW,CAAA,GAJdnG,KAAK2Z,WAAWhe,CAAI,EACpBqE,KAAK6Y,cAAa,GAIrB,CAGDe,oBAAoBzlB,GAClB6L,KAAKuH,YAAYmL,gBAAgBve,EAAEwQ,QAASxQ,EAAEyQ,OAAO,CACtD,CAGDiV,YAAYvkB,EAAWC,EAAWpB,GAChC6L,KAAKsY,WACH,CACEnW,KAAM,QACN7M,EAAAA,EACAC,EAAAA,CACD,EACD,IACEoG,EAAK+W,cAAcpd,EAAGC,CAAC,CACzB,CAAC,EAEHyK,KAAKuH,YAAYsL,6BAA6B1e,EAAEwQ,QAASxQ,EAAEyQ,OAAO,CACnE,CAGDkV,WACExkB,EACAC,EACApB,EACA0jB,EAAW,CAAA,EACXkC,EAAY,CAAA,GAEPA,GACH/Z,KAAKsY,WACH,CACEnW,KAAM,OACN7M,EAAAA,EACAC,EAAAA,EACAsiB,SAAAA,CACD,EACD,IACElc,EAAK+W,cAAcpd,EAAGC,CAAC,CACzB,CAAC,EAGCoG,EAAOqE,KAAKuH,WACd5L,GACFA,EAAKkX,6BAA6B1e,EAAEwQ,QAASxQ,EAAEyQ,OAAO,CAEzD,CAEDoV,WAAWre,EAAYoO,GACrB/J,KAAK5C,SAASyQ,OAAO9D,EAAO,EAAGpO,CAAI,CACpC,CAEDid,QAAQjd,GAEN,OADAqE,KAAK5C,SAASoK,KAAK7L,CAAI,EAChBqE,IACR,CAEDia,cACE,OAAOja,KAAK5C,SAASC,MACtB,CAED6c,WACE,OAA8B,EAAvBla,KAAK5C,SAASC,MACtB,CAED8c,YAAYxe,GAEV,OADAqE,KAAK5C,SAASgd,QAAQze,CAAI,EACnBqE,IACR,CAGD2Z,WAAWhe,GACT,IAAMoO,EAAQ/J,KAAKqa,aAAa1e,CAAI,EAOpC,MANc,CAAC,IAAXoO,IACF/J,KAAK5C,SAASyQ,OAAO9D,EAAO,CAAC,EACzBpO,EAAKyK,WACPpG,KAAKqB,iBAAgB,EAGlBrB,IACR,CAGDsa,iBAME,OALAta,KAAKuH,WAAauI,KAAAA,EAClB9P,KAAK5C,SAAW,GAChB4C,KAAKkY,aAAe,CAAA,EACpBlY,KAAKmY,SAAW,CAAA,EAChBnY,KAAKoY,WAAa,KACXpY,IACR,CAGDqa,aAAa1e,GACX,OAAOqE,KAAK5C,SAASwQ,UAAU,GAAUR,IAASzR,CAAI,CACvD,CAGD4e,oBAAoBlT,GAOlB,OANAA,EAAM3K,QAAQ,IACN8d,EAAkBxa,KAAK2Y,eAAehd,CAAI,EAChD6e,EAAWpU,SAAW,CAAA,EACtBoU,EAAWnL,SAAW,CAAA,EACtBrP,KAAK4Y,QAAQ4B,CAAkB,CACjC,CAAC,EACMxa,IACR,CAGDyY,gBACE,OAAOzY,KAAKuH,UACb,CAGDsR,cAAcld,GAOZ,OANAqE,KAAKqB,iBAAgB,GACrBrB,KAAKuH,WAAa5L,KAEhBA,EAAKyK,SAAW,CAAA,GAElBpG,KAAKL,IAAI2E,KAAK,mBAAoBtE,KAAKuH,UAAU,EAC1CvH,IACR,CAGDqB,mBASE,OARKrB,KAAKyY,kBAGNzY,KAAKuH,aACPvH,KAAKuH,WAAWnB,SAAW,CAAA,EAC3BpG,KAAKuH,WAAauI,KAAAA,GAEpB9P,KAAKL,IAAI2E,KAAK,mBAAoBtE,KAAKuH,UAAU,GAC1CvH,IACR,CAGDya,iBAAiBtmB,GACf,IAAMmB,EAAInB,EAAEqP,cACNjO,EAAIpB,EAAEsP,cACZ,IAAK5M,IAAItC,EAAIyL,KAAK5C,SAASC,OAAS,EAAQ,GAAL9I,EAAQA,EAAAA,EAAQ,CACrD,IAAMoH,EAAOqE,KAAK5C,SAAS7I,GAC3B,GAAIoH,EAAKoU,UAAUza,EAAGC,CAAC,EACrB,OAAOoG,CAEV,CACD,OAAO,IACR,CAEDgd,eAAejJ,EAAe,IAC5B,OAAQA,EAAQvN,MACd,IAAK,YACH,OAAO,IAAI2V,UAAUpI,EAAS1P,KAAKL,GAAG,EACxC,IAAK,UACH,OAAO,IAAIgY,QAAQjI,EAAS1P,KAAKL,GAAG,EACtC,IAAK,WACH,OAAO,IAAIqY,SAAStI,EAAS1P,KAAKL,GAAG,EACvC,IAAK,SACH,OAAO,IAAI+X,OAAOhI,EAAS1P,KAAKL,GAAG,EACrC,IAAK,iBACH,OAAO,IAAI0X,cAAc3H,EAAS1P,KAAKL,GAAG,EAC5C,IAAK,QACH,OAAO,IAAIvB,QAAMsR,EAAS1P,KAAKL,GAAG,EACpC,IAAK,QACH,OAAO,IAAI4X,MAAM7H,EAAS1P,KAAKL,GAAG,EACpC,IAAK,OACH,OAAO,IAAIiY,KAAKlI,EAAS1P,KAAKL,GAAG,EACnC,IAAK,OACH,OAAO,IAAIoY,KAAKrI,EAAS1P,KAAKL,GAAG,EACnC,QACE,OAAO,IACV,CACF,CAGD+a,mBACEvmB,EACAwmB,EAAmB,QAEnB9jB,IAAI8E,EAAOqE,KAAKuH,WAChB,IAAMjS,EAAInB,EAAEwQ,QACNpP,EAAIpB,EAAEyQ,QACRjJ,GAAQA,EAAKkc,UACflc,EAAK+W,gBAAgBpd,EAAGC,CAAC,EACzBolB,MAEA3a,KAAKsY,WAAW,CACdnW,KAAM,OACN0V,SAAU,CAAA,CACX,CAAA,GACDlc,EAAOqE,KAAKuH,aACNmL,gBAAgBpd,EAAGC,CAAC,EAC1BoG,GAAMkX,6BAA6Bvd,EAAGC,CAAC,EAE1C,CAGDqlB,qBACE5a,KAAKkY,aAAe,CAAA,EACpB,IAAMvc,EAAYqE,KAAKuH,WASvB,OARK5L,IAGD,CAAC,iBAAkB,QAAS,QAAQkM,SAASlM,EAAKwG,IAAI,GACxDxG,EAAK8W,sCAAqC,EAE5C9W,EAAK0T,SAAW,CAAA,EAChBrP,KAAKL,IAAIsK,cACFjK,IACR,CAGD6a,mBAAmBphB,EAAQ,IAQzB,OAPKuG,KAAKyY,iBAGV3K,OAAOC,KAAKtU,CAAK,EAAEiD,QAAQ,IAEzBsD,KAAKuH,WAAW9N,MAAMwT,GAAOxT,EAAMwT,EACrC,CAAC,EACMjN,IACR,CAGD8a,kBAAkBxlB,EAAQC,GACxB,IAAMoG,EAAOqE,KAAKuH,WACZwT,EAAOpf,GAAM8T,UAAUyH,iCAAiC5hB,EAAGC,CAAC,EAClE,OAAIwlB,EACK,CACLpf,KAAAA,EACAof,KAAAA,GAGG,IACR,CAGDC,cAAc1lB,EAAWC,EAAWpB,GAClC,MAAK6L,CAAAA,CAAAA,KAAKyY,iBAINhK,CAAAA,EADEA,EAAMzO,KAAK8a,kBAAkBxlB,EAAGC,CAAC,KAErCyK,KAAKmY,SAAW,CAAA,EACZ1J,EAAI9S,OACNqE,KAAKoY,WAAa3J,EAAI9S,KACtBqE,KAAKoY,WAAWjH,cAAc1C,EAAIsM,KAAM5mB,CAAC,GAE3C6L,KAAKL,IAAIoB,OAAO2B,UAAU+L,EAAIsM,IAAI,EAC3B,CAAA,EAGV,CAGD1C,gBAAgBngB,GACT8H,KAAKmY,UAGVnY,KAAKoY,YAAY9G,SAAS,GAAGpZ,CAAI,CAClC,CAGDmZ,YACErR,KAAKmY,SAAW,CAAA,EAChBnY,KAAKoY,YAAY/G,cACjBrR,KAAKoY,WAAa,IACnB,CAGD1G,UAAUva,EAAY,CAAA,GACpB,IAAMiT,EAAOpK,KAAK5C,SAAS+P,IAAI,GAAUxR,EAAK+V,YAAS,CAAI,EAC3D,OAAOva,EAAYF,KAAKE,UAAUiT,CAAI,EAAIA,CAC3C,CACF,OCtfoB6Q,OACZtb,IAEAub,oBAEAC,uBAEAC,cAEPrb,YAAYJ,GACVK,KAAKL,IAAMA,EAGXK,KAAKkb,oBAAsB,KAG3Blb,KAAKmb,uBAAyB,GAE9Bnb,KAAKqb,qBAAoB,CAC1B,CAGDR,mBAAmBphB,EAAQ,IASzB,OARKuG,KAAKL,IAAI0H,MAAMoR,cAAa,IAGjCzY,KAAKL,IAAI0H,MAAMwT,mBAAmBphB,CAAK,EACvCuG,KAAK8F,OAAM,EACN9F,KAAKL,IAAI0H,MAAM6Q,cAClBlY,KAAKL,IAAIsK,cAEJjK,IACR,CAGDsb,qBAAqB7hB,EAAQ,IAC3BuG,KAAK6a,mBAAmBphB,CAAK,EAC7BuG,KAAKL,IAAI8H,UAAU8T,qBAAqB9hB,CAAK,CAC9C,CAEDwO,cACE,GAAM,CAAE/O,MAAAA,EAAOC,OAAAA,GAAW6G,KAAKL,IAE/B,OADAK,KAAKL,IAAI5H,IAAImQ,UAAU,CAAChP,EAAQ,EAAG,CAACC,EAAS,EAAGD,EAAOC,CAAM,EACtD6G,IACR,CAED8F,SACE,IAAQ1F,EAAUJ,KAAKL,IAAfS,SAWR,OAVAJ,KAAKiI,YAAW,EAChBjI,KAAKL,IAAI5H,IAAI6J,OACb5B,KAAKL,IAAI5H,IAAIyI,MAAcJ,EAAMI,MAAeJ,EAAMI,KAAK,EAC3DR,KAAKL,IAAI0H,MAAMjK,SAASV,QAAQ,IAC1Bf,EAAKwK,UAGTxK,EAAKmK,OAAM,CACb,CAAC,EACD9F,KAAKL,IAAI5H,IAAIiK,UACNhC,IACR,CAEDqb,uBAEErb,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAKyb,UAAS,CAChB,CAAC,EAEDzb,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAK0b,QAAQ,CAAC,CAChB,CAAC,EAED1b,KAAKL,IAAI6b,WAAWxN,YAAY,gBAAiB,KAC/ChO,KAAK2b,mBAAkB,CACzB,CAAC,EAED3b,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAK4b,gBAAe,CACtB,CAAC,EAED5b,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAK6b,eAAc,CACrB,CAAC,EAED7b,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAKL,IAAImc,QAAQ/Q,MACnB,CAAC,EAED/K,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KACvChO,KAAKL,IAAIS,MAAM4I,SACjBhJ,KAAKL,IAAIoc,KAAKxS,WAEdvJ,KAAKL,IAAIoc,KAAK/S,UAElB,CAAC,EAEDhJ,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAKL,IAAImc,QAAQ9Q,MACnB,CAAC,EAEDhL,KAAKL,IAAI6b,WAAWxN,YAAY,YAAa,KAC3ChO,KAAKgc,iBAAiB,CAAA,CAAI,CAC5B,CAAC,CACF,CAGDJ,kBACM5b,KAAKL,IAAI0H,MAAME,YACjBvH,KAAKmb,uBAAyB,GAC9Bnb,KAAKob,cAAgBpb,KAAKL,IAAI0H,MAAME,YAC3BvH,KAAKL,IAAI8H,UAAUC,kBAAiB,IAC7C1H,KAAKob,cAAgBtL,KAAAA,EACrB9P,KAAKmb,uBAAyBnb,KAAKL,IAAI8H,UAAUE,kBAAiB,EAErE,CAGDkU,iBACM7b,KAAKL,IAAI0H,MAAME,YACjBvH,KAAK4b,gBAAe,EACpB5b,KAAK2b,mBAAkB,GACd3b,KAAKL,IAAI8H,UAAUC,kBAAiB,IAC7C1H,KAAK4b,gBAAe,EACpB5b,KAAK2b,mBAAkB,EACvB3b,KAAKL,IAAI8H,UAAUwU,wBAAwBjc,KAAKmb,sBAAsB,EACtEnb,KAAKL,IAAI8H,UAAUwC,aAEtB,CAGD+R,iBAAiBE,EAAqB,CAAA,GACpCrlB,IAAI8e,EAAM,KACV,IACUrgB,EACAC,EAFN2mB,IACM5mB,EAAM0K,KAAKL,IAAIY,MAAMwC,aAArBzN,KACAC,EAAMyK,KAAKL,IAAIY,MAAMwC,aAArBxN,KACRogB,EAAM,CACJrgB,EAAAA,EACAC,EAAAA,IAGAyK,KAAKob,cACPpb,KAAK8Y,SAAS9Y,KAAKob,cAAe,CAAA,EAAOzF,CAAU,EAAEhL,KAAK,MAAQ,EACpB,EAArC3K,KAAKmb,uBAAuB9d,QACrC2C,KAAKL,IAAI8H,UAAU0U,mBAAmBD,EAAqBvG,EAAM,IAAI,CAExE,CAGDgE,WAAWhe,GACTqE,KAAKL,IAAI0H,MAAMsS,WAAWhe,CAAI,EAC9BqE,KAAK8F,OAAM,EACX9F,KAAKL,IAAIsK,YACV,CAGD6O,eAAend,EAAW6c,EAAqB7C,GAC7C3V,KAAKL,IAAI0H,MAAMhG,mBACfoL,MAAMzM,KAAKL,IAAI0H,MAAMyR,SAASnd,EAAM6c,EAAW7C,CAAG,EAClD3V,KAAK8F,OAAM,EACX9F,KAAKL,IAAIsK,YACV,CAGDmS,mBACOpc,KAAKL,IAAI0H,MAAMoR,cAAa,GAGjCzY,KAAK2Z,WAAW3Z,KAAKL,IAAI0H,MAAME,UAAU,CAC1C,CAGDoU,qBACE3b,KAAKoc,iBAAgB,EACrBpc,KAAKL,IAAI8H,UAAU4U,qBACpB,CAGDhb,mBAME,OALKrB,KAAKL,IAAI0H,MAAMoR,cAAa,IAGjCzY,KAAKL,IAAI0H,MAAMhG,mBACfrB,KAAK8F,OAAM,GACJ9F,IACR,CAGDsc,yBAAyBhnB,EAAWC,GAMlC,OALKyK,KAAKL,IAAI0H,MAAMoR,cAAa,IAGjCzY,KAAKL,IAAI0H,MAAME,WAAW2J,UAAU5b,EAAGC,CAAC,EACxCyK,KAAK8F,OAAM,GACJ9F,IACR,CAGDuc,qBAAqBrjB,EAAeC,GAMlC,OALK6G,KAAKL,IAAI0H,MAAMoR,cAAa,IAGjCzY,KAAKL,IAAI0H,MAAME,WAAWkK,WAAWvY,EAAOC,CAAM,EAClD6G,KAAK8F,OAAM,GACJ9F,IACR,CAGDwc,uBAAuBlhB,GAMrB,OALK0E,KAAKL,IAAI0H,MAAMoR,cAAa,IAGjCzY,KAAKL,IAAI0H,MAAME,WAAW4I,aAAa7U,CAAM,EAC7C0E,KAAK8F,OAAM,GACJ9F,IACR,CAGDyc,QACEzc,KAAKL,IAAI0H,MAAMiT,iBACfta,KAAK8F,OAAM,EACX9F,KAAKL,IAAIsK,YACV,CAGDyS,OAAOC,EAAM,IACP3c,KAAKL,IAAIS,MAAMI,QACjBR,KAAKL,IAAIuB,YAAY,CACnBV,MAAOR,KAAKL,IAAIS,MAAMI,MAAQmc,CACxB,CAAA,EACR3c,KAAK8F,OAAM,EACX9F,KAAKL,IAAI2E,KAAK,aAActE,KAAKL,IAAIS,MAAMI,KAAK,EAEnD,CAGDoc,QAAQD,EAAM,IACR3c,KAAKL,IAAIS,MAAMI,QACjBR,KAAKL,IAAIuB,YAAY,CACnBV,MAAoC,EAA7BR,KAAKL,IAAIS,MAAMI,MAAQmc,EAAU3c,KAAKL,IAAIS,MAAMI,MAAQmc,EAAM,CAC/D,CAAA,EACR3c,KAAK8F,OAAM,EACX9F,KAAKL,IAAI2E,KAAK,aAActE,KAAKL,IAAIS,MAAMI,KAAK,EAEnD,CAGDkb,QAAQmB,GACFA,EAAO,GAAY,EAAPA,IAGhB7c,KAAKL,IAAIuB,YAAY,CACnBV,MAAOqc,CACD,CAAA,EACR7c,KAAK8F,OAAM,EACX9F,KAAKL,IAAI2E,KAAK,aAActE,KAAKL,IAAIS,MAAMI,KAAK,EACjD,CAGDsc,MACE,IAIQzgB,EAAYG,EAAMC,EAKpBsgB,EATD/c,KAAKL,IAAI0H,MAAM6S,SAAQ,IAG5Bla,KAAKgd,eAAc,EACb,CAAE3gB,KAAAA,EAAME,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,CAAI,EAAKU,yBACjC6C,KAAKL,IAAI0H,MAAMjK,QAAQ,EAInB2f,EAAWxmB,KAAK+X,IAAItO,KAAKL,IAAIzG,OAFrBqD,EAAOF,GAE6B2D,KAAKL,IAAIxG,QAD5CsD,EAAOD,EACoD,EAC1EwD,KAAK0b,QAAQqB,CAAQ,EACtB,CAGDtc,SAASJ,EAAiBC,GACxBN,KAAKL,IAAIuB,YAAY,CACnBb,QAAAA,EACAC,QAAAA,CACM,CAAA,EACRN,KAAK8F,OAAM,EACX9F,KAAKL,IAAI2E,KACP,eACAtE,KAAKL,IAAIS,MAAMC,QACfL,KAAKL,IAAIS,MAAME,OAAO,CAEzB,CAGD0c,iBACE,IAIQ3gB,EAAME,EAAMC,EAAMC,EAJrBuD,KAAKL,IAAI0H,MAAM6S,SAAQ,GAItB,CAAE7d,KAAAA,EAAME,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,CAAI,EAAKU,yBACjC6C,KAAKL,IAAI0H,MAAMjK,QAAQ,EAIzB4C,KAAKS,SACHpE,GAAQ2D,KAAKL,IAAIzG,OAHLqD,EAAOF,IAGe,EAClCG,GAAQwD,KAAKL,IAAIxG,QAHJsD,EAAOD,IAGgB,CAAC,GAVrCwD,KAAKS,SAAS,EAAG,CAAC,CAYrB,CAGDwc,wBACEjd,KAAK4b,gBAAe,EACpB5b,KAAKgc,iBAAgB,CACtB,CAGDkB,mBAAmBC,GACjBnd,KAAKL,IAAIuB,YAAY,CACnBK,gBAAiB4b,CACX,CAAA,EACRnd,KAAKL,IAAIyd,WAAWpc,KACrB,CAGDya,YACEzb,KAAKL,IAAI8H,UAAU4V,YAAYrd,KAAKL,IAAI0H,MAAMjK,QAAQ,CACvD,CACF,OCjUoBkgB,UACF3d,IAEjBI,YAAYJ,GACVK,KAAKL,IAAMA,CACZ,CAGD0Z,2BAA2B/jB,EAAWC,GAGpC,MAAO,CACLD,EAHFA,GAAK0K,KAAKL,IAAIzG,MAAQ,EAIpB3D,EAHFA,GAAKyK,KAAKL,IAAIxG,OAAS,EAKxB,CAGDiM,cAAc9P,EAAWC,GACvB,GAAM,CAAEgT,WAAAA,EAAYS,SAAAA,CAAQ,EAAKhJ,KAAKL,IAAIS,MAC1C,OAA0B,KAAA,IAAfmI,EACF,GAEJS,EAOmB,KAAA,KADlBuU,EAAWhV,EAAWE,MAEnB,GAEF,CACLnT,EAAGA,EAAKA,EAAIioB,EACZhoB,EAAGA,EAAKA,EAAIgoB,GAXL,CACLjoB,EAAAA,EACAC,EAAAA,EAWL,CAGD2P,WAAW3P,GACT,OAAsC,KAAA,IAA3ByK,KAAKL,IAAIS,MAAME,QACjB,EAEFN,KAAKL,IAAIS,MAAME,QAAU/K,CACjC,CAGD0P,WAAW3P,GACT,OAAsC,KAAA,IAA3B0K,KAAKL,IAAIS,MAAMC,QACjB,EAEFL,KAAKL,IAAIS,MAAMC,QAAU/K,CACjC,CAGDyT,WAAWxT,GACT,OAAsC,KAAA,IAA3ByK,KAAKL,IAAIS,MAAME,QACjB,EAEF/K,EAAIyK,KAAKL,IAAIS,MAAME,OAC3B,CAGDqI,WAAWrT,GACT,OAAsC,KAAA,IAA3B0K,KAAKL,IAAIS,MAAMC,QACjB,EAEF/K,EAAI0K,KAAKL,IAAIS,MAAMC,OAC3B,CAGDmd,2BAA2BloB,EAAWC,GAGpC,MAAO,CACLD,EAHFA,GAAK0K,KAAKL,IAAIzG,MAAQ,EAIpB3D,EAHFA,GAAKyK,KAAKL,IAAIxG,OAAS,EAKxB,CAGDsX,UAAUnb,EAAWC,GACbL,EAAI8K,KAAKqZ,2BAA2B/jB,EAAGC,CAAC,EAC9C,MAAO,CACLD,EAAG0K,KAAK2I,WAAWzT,EAAEI,CAAC,EACtBC,EAAGyK,KAAK+I,WAAW7T,EAAEK,CAAC,EAEzB,CAGDuW,gBAAgBxW,EAAWC,GACzB,MAAO,CACLD,EAAGA,EAAI0K,KAAKL,IAAIjC,KAChBnI,EAAGA,EAAIyK,KAAKL,IAAIoM,IAEnB,CAGDhH,kBAAkBzP,EAAWC,GAC3B,MAAO,CACLD,EAAGA,EAAI0K,KAAKL,IAAIjC,KAChBnI,EAAGA,EAAIyK,KAAKL,IAAIoM,IAEnB,CAGDvL,MAAMlL,EAAWC,GACf,IAAQ6K,EAAUJ,KAAKL,IAAfS,SACR,OAA2B,KAAA,IAAhBA,EAAMI,MACR,IAEHsE,EAAK9E,KAAKqZ,2BAA2B/jB,EAAGC,CAAC,EAKxC,CACLD,GALImoB,EAAKzd,KAAKwd,2BACd1Y,EAAGxP,EAAI8K,EAAMI,MACbsE,EAAGvP,EAAI6K,EAAMI,KAAK,GAGZlL,EACNC,EAAGkoB,EAAGloB,GAET,CAGDyP,aAAa1P,EAAWC,GACtB,IAAQ6K,EAAUJ,KAAKL,IAAfS,SACR,OAA2B,KAAA,IAAhBA,EAAMI,MACR,IAEHqL,EAAK7L,KAAKqZ,2BAA2B/jB,EAAGC,CAAC,EAKxC,CACLD,GALImoB,EAAKzd,KAAKwd,2BACd3R,EAAGvW,EAAI8K,EAAMI,MACbqL,EAAGtW,EAAI6K,EAAMI,KAAK,GAGZlL,EACNC,EAAGkoB,EAAGloB,GAET,CACF,OCpIoBmoB,4BAA4BtO,SAC/CuO,iBAEOC,eAEP7d,YAAY2P,EAAe/P,GACzB2D,MAAMoM,EAAS/P,CAAG,EAElBK,KAAKyP,SAAW,IAAIuF,SAAShV,KAAaA,KAAKL,GAAG,EAElDK,KAAK2d,iBAAmB,GAExB3d,KAAK4d,eAAiB,CAAEtoB,EAAG,EAAGC,EAAG,EAClC,CAGDsoB,YAAYxW,GACV,MAAMyW,EAAoB,GAC1B9d,KAAK2d,iBAAiBjhB,QAAQ,IACxB2K,EAAMQ,SAASlM,CAAI,GACrBmiB,EAAOtW,KAAK7L,CAAI,CAEpB,CAAC,EACDqE,KAAK+d,oBAAoBD,CAAM,CAChC,CAIDtM,aACE,IAIQnV,EAAME,EAAMC,EAAMC,EAJtBuD,KAAK2d,iBAAiBtgB,QAAU,EAClCiG,MAAMkO,WAAW,EAAG,EAAG,EAAG,CAAC,GAGvB,CAAEnV,KAAAA,EAAME,KAAAA,EAAMC,KAAAA,EAAMC,KAAAA,CAAI,EAAKU,yBACjC6C,KAAK2d,gBAAgB,EAEvBra,MAAMkO,WAAWnV,EAAMG,EAAMD,EAAOF,EAAMI,EAAOD,CAAI,EACtD,CAID8U,UAAUpZ,GACR8H,KAAK2d,iBAAiBjhB,QAAQ,IACxBf,EAAK8T,UAAyC,WAA7B9T,EAAK8T,SAAS2B,WAEjCpR,KAAKge,aAAariB,EAAM,GAAGzD,CAAI,EAE/ByD,GAAM2V,SAAS,GAAGpZ,CAAI,CAE1B,CAAC,CACF,CAGD8lB,aAAariB,EAAYxH,EAASyf,EAAaC,GACvCvY,EAAST,uBACbmF,KAAK4d,eAAetoB,EACpB0K,KAAK4d,eAAeroB,EACpBpB,EAAEwQ,QACFxQ,EAAEyQ,QACMgP,EACAC,CAAE,EAEZlY,EAAKqV,iBAAiB1V,EAAQ0E,KAAK4d,eAAetoB,EAAG0K,KAAK4d,eAAeroB,CAAC,CAC3E,CAID8b,YACErR,KAAK2d,iBAAiBjhB,QAAQ,IAC5Bf,EAAK0V,YAAS,CAChB,CAAC,CACF,CAGD0M,oBAAoBE,GAClBje,KAAK2d,iBAAiBjhB,QAAQ,IAC5Bf,EAAK0K,WAAa,CAAA,CACpB,CAAC,EACDrG,KAAK2d,iBAAmBM,EACxBje,KAAK2d,iBAAiBjhB,QAAQ,IAC5Bf,EAAK0K,WAAa,CAAA,CACpB,CAAC,CACF,CAID8K,eAAejZ,GACb8H,KAAK2d,iBAAiBjhB,QAAQ,IACZ,WAAZxE,EAAK,KAEP8H,KAAK4d,eAAiBliB,wBAAwBsE,IAAW,GAE3DrE,EAAKwV,cAAc,GAAGjZ,CAAI,CAC5B,CAAC,CACF,CAED4N,SACM9F,KAAK9G,OAAS8G,KAAK7G,QAAyC,EAA/B6G,KAAK2d,iBAAiBtgB,SACjD2C,KAAK9G,OAAS,GAAK8G,KAAK7G,QAAU,GAGtC6G,KAAKyP,SAAS3J,SAEjB,CACF,OCzGoBoY,UACZve,IAEAnG,OAEAzB,IAEAomB,gBAEPC,aAEOjG,SAEA/X,MAEAlH,MAEAC,OAEA2J,UAEAub,UAEAC,oBAEPve,YAAYJ,GACVK,KAAKL,IAAMA,EAEXK,KAAKxG,OAAS,KAEdwG,KAAKjI,IAAM+X,KAAAA,EAGX9P,KAAKme,gBAAkB,CAAA,EAGvBne,KAAKoe,aAAe,CAAA,EAGpBpe,KAAKmY,SAAW,CAAA,EAEhBnY,KAAKI,MAAQJ,KAAKL,IAAIS,MAEtBJ,KAAK9G,MAAQ8G,KAAKL,IAAIzG,MAEtB8G,KAAK7G,OAAS6G,KAAKL,IAAIxG,OAEvB6G,KAAK8C,UAAY,IAAIwa,UAAUtd,IAA4B,EAG3DA,KAAKqe,UAAY,IAAIvG,UACnB,CACE3V,KAAM,YACN1I,MAAO,CACLwP,YAAa,sBACbnH,UAAW,qBACZ,CACK,EACR9B,IAAW,EAIbA,KAAKse,oBAAsB,IAAIZ,oBAC7B,CACEvb,KAAM,qBACA,EACRnC,IAAW,EAIbA,KAAKue,aAAe1mB,SAASmI,KAAKue,aAAcve,KAAM,EAAE,EAGxDA,KAAKqY,aAAexgB,SAASmI,KAAKqY,aAAcrY,KAAa,EAAE,EAE/DA,KAAKoI,KAAI,EAETpI,KAAKE,UAAS,CACf,CAGDqe,aAAapqB,EAAQoM,GACnB,MAAMlE,EAAO9F,KAAK+X,IAAI/N,EAAM8C,aAAa/N,EAAGnB,EAAEwQ,OAAO,EAC/CnI,EAAOjG,KAAK+X,IAAI/N,EAAM8C,aAAa9N,EAAGpB,EAAEyQ,OAAO,EAC/CrI,EAAOhG,KAAKqE,IAAI2F,EAAM8C,aAAa/N,EAAGnB,EAAEwQ,OAAO,EAC/ClI,EAAOlG,KAAKqE,IAAI2F,EAAM8C,aAAa9N,EAAGpB,EAAEyQ,OAAO,EAC/C+Y,EAAsC,GAC5C3d,KAAKL,IAAI0H,MAAMjK,SAASV,QAAQ,IAC9B7F,IAAI2nB,EAAQliB,EAAAA,EACRmiB,EAASniB,CAAAA,EAAAA,EACToiB,EAAQpiB,EAAAA,EACRqiB,EAASriB,CAAAA,EAAAA,EACb,IAAMsiB,EAAoBjjB,GAAM2B,yBACdpB,gBAChB0iB,EAAkBzR,IAAI,GAA0C,CAC9DxQ,EAAWrH,EACXqH,EAAWpH,EACZ,EACD,CAAA,CAAI,EAEDmH,QAAQ,CAAA,CAAGpH,EAAAA,EAAGC,EAAAA,CAAQ,KACrBD,EAAIkpB,IACNA,EAAQlpB,GAENA,EAAImpB,IACNA,EAAQnpB,GAENC,EAAImpB,IACNA,EAAQnpB,GAENA,EAAIopB,IACNA,EAAQppB,EAEZ,CAAC,EACGipB,GAASniB,GAAQoiB,GAASliB,GAAQmiB,GAASliB,GAAQmiB,GAASliB,GAC9DkhB,EAAiBnW,KAAK7L,CAAI,CAE9B,CAAC,EACDqE,KAAKic,wBAAwB0B,EAAkB,CAAA,CAAI,EACnD3d,KAAKL,IAAImG,OAAOA,QACjB,CAGDgV,kBAAkBxlB,EAAQC,GACxB,OAAOyK,KAAKse,oBAAoB7O,SAASyH,+BACvC5hB,EACAC,CAAC,CAEJ,CAGD8mB,sBACErc,KAAK2H,kBAAiB,EAAGjL,QAAQ,IAC/BsD,KAAKL,IAAI0H,MAAMsS,WAAWhe,CAAI,CAChC,CAAC,EACDqE,KAAKqd,YAAY,EAAE,EACnBrd,KAAKL,IAAIsK,YACV,CAGDvC,oBACE,OAAyC,EAAlC1H,KAAK2H,oBAAoBtK,MACjC,CAGDsK,oBACE,OAAO3H,KAAKse,oBAAoBX,gBACjC,CAGDxB,yBAAyBxG,GACvB,IAAMkJ,EAAO7e,KAAK2H,kBAAiB,EAAGwF,IAAI,GACxCnN,KAAKL,IAAI0H,MAAMyR,SAASnd,EAAM,CAAA,CAAI,CAAC,EAE/B0L,EAAQoF,MAAMvO,QAAQ4gB,IAAID,CAAI,EAGpC,GAFA7e,KAAKic,wBAAwB5U,CAAK,EAE9BsO,EAAK,CAEP,GADA3V,KAAKse,oBAAoBnN,YAAYpb,gBAAgBC,IAAI,EAEvD,EAACgK,KAAKse,oBAAoBhpB,GACzB0K,KAAKse,oBAAoB/oB,GACzByK,KAAKse,oBAAoBplB,OACzB8G,KAAKse,oBAAoBnlB,QAI1B,OADAgO,KAAAA,QAAQC,MAAM,uDAAuD,EAGjEyJ,EACJ8E,EAAIrgB,EAAI0K,KAAKse,oBAAoBhpB,EAAI0K,KAAKse,oBAAoBplB,MAAQ,EAClE4X,EACJ6E,EAAIpgB,EAAIyK,KAAKse,oBAAoB/oB,EAAIyK,KAAKse,oBAAoBnlB,OAAS,EAEnE6f,EAAmBhZ,KAAKL,IAAImD,UAAUsC,cAAcyL,EAAIC,CAAE,EAChE9Q,KAAKse,oBAAoBhN,OACvB,KACA,KACA,KACA0H,EAAiB1jB,EACjB0jB,EAAiBzjB,CAAC,EAEpByK,KAAKse,oBAAoBjN,YACzBrR,KAAKse,oBAAoB9M,YAC1B,CACDxR,KAAKL,IAAImG,OAAOA,SAChB9F,KAAK+e,gBAAe,EACpB/e,KAAKL,IAAIsK,YACV,CAGD+Q,cAAc1lB,EAAWC,EAAWpB,GAClC,MAAK6L,CAAAA,CAAAA,KAAKoe,cAKNrD,CAAAA,EAFEA,EACJ/a,KAAKse,oBAAoB7O,SAASyH,+BAA+B5hB,EAAGC,CAAC,KAErEyK,KAAKmY,SAAW,CAAA,EAChBnY,KAAKse,oBAAoBnN,YAAY4J,EAAM5mB,CAAC,EAC5C6L,KAAKL,IAAIoB,OAAO2B,UAAUqY,CAAI,EACvB,CAAA,EAGV,CAGD1C,gBAAgBngB,GACT8H,KAAKmY,WAGVnY,KAAKse,oBAAoBhN,OAAO,GAAGpZ,CAAI,EACvC8H,KAAKL,IAAImG,OAAOA,SAChB9F,KAAKse,oBAAoB9M,aACzBxR,KAAK+e,gBAAe,EACrB,CAGD1N,YACErR,KAAKmY,SAAW,CAAA,EAChBnY,KAAKse,oBAAoBjN,WAC1B,CAGDkK,qBAAqB9hB,EAAQ,IACtBuG,KAAK0H,sBAGVoG,OAAOC,KAAKtU,CAAK,EAAEiD,QAAQ,IACzBsD,KAAK2H,kBAAiB,EAAGjL,QAAQ,IAE/Bf,EAAKlC,MAAMwT,GAAOxT,EAAMwT,EAC1B,CAAC,CACH,CAAC,EACDjN,KAAKL,IAAImG,OAAOA,SAChB9F,KAAKL,IAAIsK,aACV,CAGDoT,YAAYhW,EAAQ,IAClBrH,KAAKoe,aAA8B,EAAf/W,EAAMhK,OAC1B2C,KAAKic,wBAAwB5U,CAAK,EAClCrH,KAAKL,IAAImG,OAAOA,SAChB9F,KAAK+e,gBAAe,EACpB/e,KAAKiK,WAAU,CAChB,CAED+U,oBACEhf,KAAKqd,YAAY,EAAE,CACpB,CAGDpB,wBAAwB5U,EAAmB,GAAI4X,GAC7Cjf,KAAKse,oBAAoBP,oBAAoB1W,CAAK,EAC7C4X,GACHjf,KAAKse,oBAAoB9M,YAE5B,CAEDvH,aACEjK,KAAKL,IAAI2E,KAAK,wBAAyBtE,KAAK2H,kBAAiB,CAAE,CAChE,CAEDzH,YACEF,KAAKL,IAAIkB,GAAG,SAAU,KACpBb,KAAKI,MAAQJ,KAAKL,IAAIS,MACtBJ,KAAKse,oBAAoBT,YAAY7d,KAAKL,IAAI0H,MAAMjK,QAAQ,EAC5D4C,KAAK+e,gBAAe,CACtB,CAAC,EACD/e,KAAKL,IAAIkB,GAAG,eAAgB,KAC1Bb,KAAK+e,gBAAe,CACtB,CAAC,EACD/e,KAAKL,IAAIkB,GAAG,aAAc,KACxBb,KAAK+e,gBAAe,CACtB,CAAC,CACF,CAEDnb,YACEzP,EACAoM,GAE4B,IAAxBpM,EAAEoQ,YAAY2a,QAGlBlf,KAAKme,gBAAkB,CAAA,EACvBne,KAAKqe,UAAUnN,UAAU3Q,EAAM8C,aAAa/N,EAAGiL,EAAM8C,aAAa9N,CAAC,EACpE,CAEDuO,YAAY3P,EAAWoM,GAEnBhK,KAAK6D,IAAImG,EAAMG,YAAYpL,CAAC,GAAK,IACjCiB,KAAK6D,IAAImG,EAAMG,YAAYnL,CAAC,GAAK,IAInCyK,KAAKC,OAAO9L,EAAGoM,CAAK,CACrB,CAEDwD,YACE/D,KAAKme,gBAAkB,CAAA,EACvBne,KAAKqe,UAAU7M,WAAW,EAAG,EAAG,EAAG,CAAC,EAEpCxR,KAAKoe,aAAepe,KAAK0H,oBACzB1H,KAAKse,oBAAoB9M,aACzBxR,KAAK+e,gBAAe,EACpB/e,KAAKiK,WAAU,CAChB,CAGDhK,OAAO9L,EAAWoM,GAChBP,KAAKqe,UAAU5M,WAAWlR,EAAMG,YAAYpL,EAAGiL,EAAMG,YAAYnL,CAAC,EAClEyK,KAAK+e,gBAAe,EACpB/e,KAAKue,aAAapqB,EAAGoM,CAAK,CAC3B,CAEDiC,QACExC,KAAKic,wBAAwB,EAAE,EAC/Bjc,KAAKoe,aAAe,CAAA,EACpBpe,KAAK+e,gBAAe,EACpB/e,KAAKiK,WAAU,CAChB,CAED8U,kBACE/e,KAAKxG,OAAOyO,cACZjI,KAAKjI,KAAK6J,OACN5B,KAAKL,IAAIS,MAAMI,OACjBR,KAAKjI,KAAKyI,MAAMR,KAAKL,IAAIS,MAAMI,MAAOR,KAAKL,IAAIS,MAAMI,KAAK,EAE5DR,KAAKqe,UAAUvY,SACf9F,KAAKse,oBAAoBxY,SACzB9F,KAAKjI,KAAKiK,SACX,CAEDoG,OACMpI,KAAKxG,QACPwG,KAAKL,IAAI+B,QAAQgI,YAAY1J,KAAKxG,OAAOuO,EAAE,EAE7C/H,KAAK9G,MAAQ8G,KAAKL,IAAIzG,MACtB8G,KAAK7G,OAAS6G,KAAKL,IAAIxG,OACvB6G,KAAKxG,OAAS,IAAIsO,OAAO9H,KAAK9G,MAAO8G,KAAK7G,OAAQ,CAChDI,UAAW,WACZ,CAAA,EACDyG,KAAKjI,IAAMiI,KAAKxG,OAAOzB,IACvBiI,KAAKL,IAAI+B,QAAQ9D,YAAYoC,KAAKxG,OAAOuO,EAAE,CAC5C,CACF,OC5VoBoX,iBAAiBtc,aACnBlD,IAETyf,SAERC,UAEAtf,YAAYJ,GACV2D,QACAtD,KAAKL,IAAMA,EACXK,KAAKof,SAAWtP,KAAAA,EAChB9P,KAAKqf,UAAY,CAAA,EACjBrf,KAAKsf,YAActf,KAAKsf,YAAYzb,KAAK7D,IAAI,EAC7CA,KAAKuf,WAAavf,KAAKuf,WAAW1b,KAAK7D,IAAI,CAC5C,CAGDwf,eACOxf,KAAKof,SAGRpf,KAAKof,SAAS3lB,MAAMgmB,QAAU,QAF9Bzf,KAAK0f,iBAAgB,EAIM,KAAA,IAAlB1f,KAAKof,WAGhBpf,KAAK2f,qBAAoB,EACzB3f,KAAKof,SAASQ,QACd5f,KAAKof,SAASS,SACd7f,KAAKqf,UAAY,CAAA,EAClB,CAGDC,cACE,IAQQpmB,EAAOC,EARPoO,EAAevH,KAAKL,IAAI0H,MAAxBE,cACHA,GAGwB,KAAA,IAAlBvH,KAAKof,WAGhB7X,EAAW9O,KAAOuH,KAAKof,SAASpT,MAC1B,CAAE9S,MAAAA,EAAOC,OAAAA,CAAQ,EAAG+F,gBAAgBqI,CAAU,EACpDA,EAAWrO,MAAQA,EACnBqO,EAAWpO,OAASA,EACpB6G,KAAK2f,qBAAoB,EAC1B,CAGDJ,aAC+B,KAAA,IAAlBvf,KAAKof,WAGhBpf,KAAKof,SAAS3lB,MAAMgmB,QAAU,OAC9Bzf,KAAKof,SAASpT,MAAQ,GACtBhM,KAAKsE,KAAK,MAAM,EAChBtE,KAAKqf,UAAY,CAAA,EAClB,CAGDK,mBACE1f,KAAKof,SAAW5nB,SAASC,cAAc,UAAU,EACjDuI,KAAKof,SAASnjB,IAAM,OACpB+D,KAAKof,SAASU,SAAW,EACzB9f,KAAKof,SAASW,KAAO,MACrB/f,KAAKof,SAAS7lB,UAAY,YAC1BuU,OAAOkS,OAAOhgB,KAAKof,SAAS3lB,MAAO,CACjCgE,SAAU,QACVgiB,QAAS,QACTQ,UAAW,MACXC,mBAAoB,SACpBC,OAAQ,EACRC,QAAS,EACTC,OAAQ,EACRC,QAAS,EACThP,OAAQ,OACR8L,WAAY,cACZmD,SAAU,SACVC,WAAY,KACb,CAAA,EACDxgB,KAAKof,SAAS/Z,iBAAiB,QAASrF,KAAKsf,WAAW,EACxDtf,KAAKof,SAAS/Z,iBAAiB,OAAQrF,KAAKuf,UAAU,EACtD/nB,SAASmG,KAAKC,YAAYoC,KAAKof,QAAQ,CACxC,CAGDO,uBACE,IAQexmB,EAAQM,EAAa6B,EACjB8E,EAQbqd,EACA5R,EACAvT,EACAmoB,EApBElZ,EAAevH,KAAKL,IAAI0H,MAAxBE,cACHA,GAGwB,KAAA,IAAlBvH,KAAKof,WAGZ,CAAE9pB,EAAAA,EAAGC,EAAAA,CAAG,EAAQgS,EACd,CAAErO,MAAAA,EAAOC,OAAAA,EAAQM,MAAAA,EAAOhB,KAAAA,EAAM6C,OAAAA,CAAQ,EAAQiM,EAC9C,CAAEzE,UAAAA,EAAW1C,MAAAA,GAAUJ,KAAKL,IAClCK,KAAKof,SAASpT,MAAQvT,EACtBnD,EAAIwN,EAAU6F,WAAWrT,CAAC,EAC1BC,EAAIuN,EAAUiG,WAAWxT,CAAC,EACC,KAAA,IAAhB6K,EAAMI,SAIXid,EAAK3a,EAAUtC,MAAMlL,EAAGC,CAAC,EACzBsW,EAAK/I,EAAUgJ,gBAAgB2R,EAAGnoB,EAAGmoB,EAAGloB,CAAC,EACzC+C,EAAWmB,EAAMnB,SAAW8H,EAAMI,MAClCigB,EAAS,CACblM,KAAMlc,cAAcC,EAAUmB,EAAMlB,UAAU,EAC9C+b,WAAehc,EAAWmB,EAAM0F,gBAApB,KACZzB,KAASmO,EAAGvW,EAAN,KACNyW,IAAQF,EAAGtW,EAAN,KACL4nB,MAAO1jB,EAAMqI,UACb5I,MAAU3C,KAAKqE,IAAI1B,EAAO,GAAG,EAAIkH,EAAMI,MAAhC,KACPrH,OAAWA,EAASiH,EAAMI,MAAlB,KACRiQ,oBAAqBnV,QACrBolB,QAASjnB,EAAMoW,aAEjB/B,OAAOkS,OAAOhgB,KAAKof,SAAS3lB,MAAOgnB,CAAM,EAC1C,CACF,CClHD,IAAepZ,MAAA,CACbgQ,cAAAA,cACAE,MAAAA,MACAG,OAAAA,OACAC,QAAAA,cACAvZ,QACAwZ,KAAAA,KACA8F,oBAAAA,oBACA5F,UAAAA,UACAC,KAAAA,KACAC,SAAAA,gBCsBI2I,oBAAoB9d,aACjB6M,QAEShO,QAETkf,SAEA1nB,MAEAC,OAEAuE,KAEAqO,IAEAvS,OAEAzB,IAEAqI,MAEA0C,UAEAvC,MAEAib,WAEAqF,UAEAC,SAEA/f,OAEA+a,QAEAiF,OAEA3D,WAEA3V,UAEAsU,KAEAiF,OAEA3Z,MAEAvB,OAEAmb,MAEPC,aAEAC,kBAEAC,YAEA/Z,aAEAtH,YAAY2P,GACVpM,QAEAtD,KAAK0P,QAAUA,EAEf1P,KAAK0B,QAAUgO,EAAQhO,QAEvB1B,KAAK4gB,SAAWlR,EAAQkR,UAAY,YAGpC5gB,KAAK9G,MAAQ,EACb8G,KAAK7G,OAAS,EACd6G,KAAKtC,KAAO,EACZsC,KAAK+L,IAAM,EAGX/L,KAAKxG,OAASsW,KAAAA,EAGd9P,KAAKjI,IAAM+X,KAAAA,EAGX9P,KAAKI,MAAQ,CAEXI,MAAO,EAEPH,QAAS,EAETC,QAAS,EAET+gB,WAAY,GAEZ9f,gBAAiB,GAEjByH,SAAU,CAAA,EAEV7H,SAAU,CAAA,EAEVwO,aAAc,UAEdpH,WAAY,CAEVE,KAAM,GAENQ,YAAa,UAEbzJ,UAAW,CACZ,EAED,GAAIkQ,EAAQtP,OAAS,IAGvBJ,KAAKshB,WAAU,EAEfthB,KAAK8C,UAAY,IAAIwa,UAAUtd,IAAW,EAE1CA,KAAKO,MAAQ,IAAIqC,MAAM5C,IAAW,EAClCA,KAAKO,MAAMM,GAAG,YAAab,KAAK4D,YAAa5D,IAAI,EACjDA,KAAKO,MAAMM,GAAG,YAAab,KAAK8D,YAAa9D,IAAI,EACjDA,KAAKO,MAAMM,GAAG,UAAWb,KAAK+D,UAAW/D,IAAI,EAC7CA,KAAKO,MAAMM,GAAG,WAAYb,KAAKgE,WAAYhE,IAAI,EAC/CA,KAAKO,MAAMM,GAAG,aAAcb,KAAKiE,aAAcjE,IAAI,EACnDA,KAAKO,MAAMM,GAAG,cAAeb,KAAKoE,cAAepE,IAAI,EAErDA,KAAKwb,WAAa,IAAI1O,WAAW9M,IAAW,EAE5CA,KAAK6gB,UAAY,IAAI5V,UAAUjL,IAAW,EAC1CA,KAAK6gB,UAAUhgB,GAAG,oBAAqBb,KAAKuL,oBAAqBvL,IAAI,EAErEA,KAAK8gB,SAAW,IAAI3B,SAASnf,IAAW,EACxCA,KAAK8gB,SAASjgB,GAAG,OAAQb,KAAKuhB,gBAAiBvhB,IAAI,EAEnDA,KAAKe,OAAS,IAAIkB,OAAOjC,IAAW,EAEpCA,KAAK8b,QAAU,IAAIjS,QAAQ7J,IAAW,EAEtCA,KAAK+gB,OAAS,IAAItb,OAAOzF,IAAW,EAEpCA,KAAKod,WAAa,IAAI9b,WAAWtB,IAAW,EAE5CA,KAAKyH,UAAY,IAAIyW,UAAUle,IAAW,EAE1CA,KAAK+b,KAAO,IAAI5T,KAAKnI,IAAW,EAEhCA,KAAKqH,MAAQ,IAAI4Q,MAAMjY,IAAW,EAElCA,KAAK8F,OAAS,IAAImV,OAAOjb,IAAW,EAEpCA,KAAKghB,OAAS,IAAIthB,OAAOM,IAAW,EAEpCA,KAAKwhB,cAAa,EAElBxhB,KAAKyhB,cAAgB5pB,SAASmI,KAAKyhB,cAAezhB,IAAW,EAE7DA,KAAKiK,WAAU,EAEfjK,KAAK0hB,WAAU,EAEf1hB,KAAKihB,MAAQ,CACXU,WAAY,GAA0B3hB,KAAKa,GAAG,aAAc0X,CAAQ,EACpEqJ,aAAc,GAA0B5hB,KAAKa,GAAG,eAAgB0X,CAAQ,EACxEsJ,kBAAmB,GACjB7hB,KAAKa,GAAG,oBAAqB0X,CAAQ,EACvChO,QAAS,GAA0BvK,KAAKa,GAAG,UAAW0X,CAAQ,EAC9DuJ,iBAAkB,GAChB9hB,KAAKa,GAAG,mBAAoB0X,CAAQ,EACtCwJ,sBAAuB,GACrB/hB,KAAKa,GAAG,wBAAyB0X,CAAQ,EAC3CyJ,YAAa,GAA0BhiB,KAAKa,GAAG,cAAe0X,CAAQ,EACtE0J,gBAAiB,GACfjiB,KAAKa,GAAG,kBAAmB0X,CAAQ,EACrC2J,gBAAiB,GACfliB,KAAKa,GAAG,kBAAmB0X,CAAQ,EACrC4J,gBAAiB,GAA0BniB,KAAKa,GAAG,SAAU0X,CAAQ,EACrE6J,iBAAkB,GAChBpiB,KAAKa,GAAG,mBAAoB0X,CAAQ,EAEzC,CAEDiJ,gBACG,CAAC,cAAe,cAAc9kB,QAAQ,IAErCsD,KAAKqiB,GAAUriB,KAAK+gB,OAAOsB,GAAQxe,KAAK7D,KAAK+gB,MAAM,CACrD,CAAC,EACA,CAAC,WAAY,WAAY,cAAcrkB,QAAQ,IAE9CsD,KAAKqiB,GAAUriB,KAAK+b,KAAKsG,GAAQxe,KAAK7D,KAAK+b,IAAI,CACjD,CAAC,EACA,CAAC,gBAAiB,qBAAqBrf,QAAQ,IAE9CsD,KAAKqiB,GAAUriB,KAAKghB,OAAOqB,GAAQxe,KAAK7D,KAAKghB,MAAM,CACrD,CAAC,EACA,CAAC,OAAQ,QAAQtkB,QAAQ,IAExBsD,KAAKqiB,GAAUriB,KAAK8b,QAAQuG,GAAQxe,KAAK7D,KAAK8b,OAAO,CACvD,CAAC,EACA,CAAC,cAAe,aAAapf,QAAQ,IAEpCsD,KAAKqiB,GAAUriB,KAAKwb,WAAW6G,GAAQxe,KAAK7D,KAAKwb,UAAU,CAC7D,CAAC,EACA,CAAC,uBAAwB,qBAAqB9e,QAAQ,IAErDsD,KAAKqiB,GAAUriB,KAAKyH,UAAU4a,GAAQxe,KAAK7D,KAAKyH,SAAS,CAC3D,CAAC,EACA,CACC,yBACA,uBACA,2BACA,mBACA,iBACA,wBACA,QACA,SACA,UACA,UACA,YACA,MACA,mBACA,qBACA,qBACA,WACA,kBACA,aACA,qBACA,uBACA,WACA,iBACA,oBACA/K,QAAQ,IAERsD,KAAKqiB,GAAUriB,KAAK8F,OAAOuc,GAAQxe,KAAK7D,KAAK8F,MAAM,CACrD,CAAC,CACF,CAGDD,UACE,MAAO,CACLzF,MAAO,CACL,GAAGJ,KAAKI,KACT,EACDiH,MAAOrH,KAAKqH,MAAMqK,UAAW,EAEhC,CAGDnG,sBACEvL,KAAKe,OAAOwB,MACb,CAGD+f,uBACE,GAAM,CAAEppB,MAAAA,EAAOC,OAAAA,EAAQuE,KAAAA,EAAMqO,IAAAA,CAAG,EAAK/L,KAAK0B,QAAQ5D,wBAClDkC,KAAK9G,MAAQA,EACb8G,KAAK7G,OAASA,EACd6G,KAAKtC,KAAOA,EACZsC,KAAK+L,IAAMA,CACZ,CAGD2V,aACM1hB,KAAKI,MAAMe,UAEbnB,KAAKoB,kBAAiB,EAEpBpB,KAAKI,MAAM4I,UACbhJ,KAAK+b,KAAK/S,WAEZhJ,KAAKod,WAAWpc,KACjB,CAGD0J,cACE,CAAEtK,MAAAA,EAAQ,GAAIiH,MAAAA,EAAQ,EAAS,EAC/Bkb,EACAC,GAEAxiB,KAAKI,MAAQA,EAEb,IAUMqiB,EAAa,GAEnB,IAAK,MAAM7tB,KAZGyS,EAAM8F,IAAI4L,MAAOpd,GACX,UAAdA,EAAKwG,KACA,CACL,GAAGxG,EACH6Q,SAAUC,MAAMxO,eAAuBtC,EAAK+C,GAAG,GAG5C/C,CACR,EAMC8mB,EAAIjb,KAAKiF,MAAM7X,CAAC,EAGlBoL,KAAK0hB,WAAU,EACf1hB,KAAKqH,MAAMiT,eAAgB,EAACC,oBAAoBkI,CAAG,EACnDziB,KAAK8F,OAAOA,SACPyc,GACHviB,KAAKiK,WAAWuY,CAAU,CAE7B,CAEDlB,aACEthB,KAAKsiB,qBAAoB,EACrBtiB,KAAKxG,QACPwG,KAAK0B,QAAQgI,YAAY1J,KAAKxG,MAAM,EAEtC,GAAM,CAAEA,OAAAA,EAAQzB,IAAAA,GAAakB,aAAa+G,KAAK9G,MAAO8G,KAAK7G,OAAQ,CACjEI,UAAW,MACZ,CAAA,EACDyG,KAAKxG,OAASA,EACdwG,KAAKjI,IAAMA,EACXiI,KAAK0B,QAAQ9D,YAAYoC,KAAKxG,MAAa,CAC5C,CAGD8X,SACEtR,KAAKshB,WAAU,EACfthB,KAAK8F,OAAOA,SACZ9F,KAAKyH,UAAUW,OACfpI,KAAK+b,KAAK3T,OACVpI,KAAK+b,KAAK1T,YACX,CAGDnH,YAAYkJ,EAAO,IACjBpK,KAAKI,MAAQ,CACX,GAAGJ,KAAKI,MACR,GAAGgK,GAELpK,KAAKiK,WAAW6F,KAAAA,EAAW,CAAA,CAAI,CAChC,CAGD4S,kBAAkB9B,GAChB5gB,KAAK4gB,SAAWA,EACM,UAAlB5gB,KAAK4gB,UACP5gB,KAAK6gB,UAAUjU,cAEK,WAAlB5M,KAAK4gB,UACP5gB,KAAKe,OAAOqB,YAEZpC,KAAKqB,iBAAgB,GACM,SAAlBrB,KAAK4gB,SACd5gB,KAAKe,OAAOsB,UACe,cAAlBrC,KAAK4gB,SACd5gB,KAAKe,OAAO0B,eAEZzC,KAAKe,OAAOyB,QAEdxC,KAAKsE,KAAK,oBAAqBtE,KAAK4gB,QAAQ,CAC7C,CAGDhd,YACEzP,EAKAoM,GAEA,IAKQoiB,EALJ3iB,KAAKI,MAAMe,UAAYnB,KAAKghB,OAAOlhB,aACrCE,KAAKghB,OAAO7gB,UAGTH,KAAKqH,MAAM6Q,cAAiBlY,KAAK8gB,SAASzB,YACvCsD,EAAY3iB,KAAKqH,MAAMoT,iBAAiBtmB,CAAC,EACzB,cAAlB6L,KAAK4gB,SACH5gB,KAAKqH,MAAMoR,gBACIzY,KAAKqH,MAAM2T,cAC1Bza,EAAM8C,aAAaG,cACnBjD,EAAM8C,aAAaI,cACnBtP,CAAC,IAGD6L,KAAKqH,MAAMwR,cAAc8J,CAAgB,EACzC3iB,KAAK8F,OAAOA,UAEL9F,KAAKyH,UAAU2W,aACPpe,KAAKyH,UAAUuT,cAC9Bza,EAAM8C,aAAaG,cACnBjD,EAAM8C,aAAaI,cACnBtP,CAAC,IAGD6L,KAAKyH,UAAUjF,QACfxC,KAAKqH,MAAMwR,cAAc8J,CAAgB,EACzC3iB,KAAK8F,OAAOA,WAEL6c,GACT3iB,KAAKqH,MAAMwR,cAAc8J,CAAS,EAClC3iB,KAAK8F,OAAOA,SACZ9F,MAEAA,KAAKyH,WAFA7D,YAAYzP,EAAGoM,CAAK,EAIA,WAAlBP,KAAK4gB,UAEd5gB,KAAK2Z,WAAWgJ,CAAS,EAG9B,CAGD7e,YAAY3P,EAAQoM,GAElB,IAOQqT,EACAC,EAEArB,EA8DEuI,EAxEN/a,KAAKI,MAAMe,UAAYnB,KAAKghB,OAAOlhB,aACjCS,EAAM6C,aACRpD,KAAKghB,OAAO/gB,OAAO9L,EAAGoM,CAAK,EAI3BA,EAAM6C,aACFwQ,EAAKrT,EAAM8C,aAAa/N,EACxBue,EAAKtT,EAAM8C,aAAa9N,EACxBgd,EAAUhc,KAAKqE,IAAI2F,EAAMG,YAAYpL,EAAG,CAAC,EACzCkd,EAAUjc,KAAKqE,IAAI2F,EAAMG,YAAYnL,EAAG,CAAC,EACzB,cAAlByK,KAAK4gB,SACH5gB,KAAKyH,UAAU0Q,SACjBnY,KAAKyH,UAAU4Q,aACblkB,EACAyf,EACAC,EACAtT,EAAMG,YAAYpL,EAClBiL,EAAMG,YAAYnL,CAAC,EAEZyK,KAAKyH,UAAU0W,gBACxBne,KAAKyH,UAAU3D,YAAY3P,EAAGoM,CAAK,GAEnCP,KAAKqH,MAAMgR,aACTlkB,EACAyf,EACAC,EACAtT,EAAMG,YAAYpL,EAClBiL,EAAMG,YAAYnL,CAAC,EAErByK,KAAK8F,OAAOA,UAEL,CAAC,YAAa,UAAW,YAAY+B,SAAS7H,KAAK4gB,QAAQ,GACpE5gB,KAAKqH,MAAM4R,wBACTjZ,KAAK4gB,SACLhN,EACAC,EACAtB,EACAC,CAAO,EAETxS,KAAK8F,OAAOA,UACe,WAAlB9F,KAAK4gB,UACd5gB,KAAKqH,MAAM6R,aAAatF,EAAIC,EAAI1f,CAAC,EACjC6L,KAAK8F,OAAOA,UACe,mBAAlB9F,KAAK4gB,SACd5gB,KAAKqH,MAAM8R,oBAAoBhlB,EAAGoM,CAAK,EACZ,UAAlBP,KAAK4gB,UACd5gB,KAAKqH,MAAMwS,YAAYjG,EAAIC,EAAI1f,CAAC,EAChC6L,KAAK8F,OAAOA,UACe,SAAlB9F,KAAK4gB,UAC+C,EAAzD/mB,yBAAyB+Z,EAAIC,EAAI1f,EAAEwQ,QAASxQ,EAAEyQ,OAAO,IACvD5E,KAAKqH,MAAMyS,WAAWlG,EAAIC,EAAI1f,EAAG,CAAA,CAAI,EACrC6L,KAAK8F,OAAOA,WAGP9F,KAAK6gB,UAAU3V,SACxBlL,KAAKe,OAAOwB,OACZvC,KAAK6gB,UAAUrV,mBACbrX,EAAEoQ,YAAYI,QACdxQ,EAAEoQ,YAAYK,OAAO,GAEI,cAAlB5E,KAAK4gB,SACV5gB,KAAKqH,MAAMoR,gBAEHzY,KAAKqH,MAAMyT,kBAAkB3mB,EAAEqP,cAAerP,EAAEsP,aAAa,EAErEzD,KAAKe,OAAO2B,UAHQ,GAGWqY,IAAI,EAGnC/a,KAAKyhB,cAActtB,CAAC,EAEb6L,KAAKyH,UAAU2W,eAClBrD,EAAO/a,KAAKyH,UAAUqT,kBAC1B3mB,EAAEqP,cACFrP,EAAEsP,aAAa,GAGfzD,KAAKe,OAAO2B,UAAUqY,CAAI,EAO5B/a,KAAKyhB,cAActtB,CAAC,EAEK,SAAlB6L,KAAK4gB,WACd5gB,KAAKqH,MAAMyS,WAAWhK,KAAAA,EAAWA,KAAAA,EAAW3b,EAAG,CAAA,EAAO,CAAA,CAAI,EAC1D6L,KAAK8F,OAAOA,SAEf,CAGD2b,cAActtB,GACM6L,KAAKqH,MAAMoT,iBAAiBtmB,CAAC,EAE7C6L,KAAKe,OAAOuB,UAEZtC,KAAKe,OAAOyB,OAEf,CAGDogB,mBACwB,cAAlB5iB,KAAK4gB,WACP5gB,KAAK4gB,SAAW,YAChB5gB,KAAKsE,KAAK,oBAAqB,WAAW,EAE7C,CAGDue,wBACE7iB,KAAK4iB,iBAAgB,EACrB5iB,KAAKqH,MAAMuT,qBACX5a,KAAK8F,OAAOA,QACb,CAGD/B,UAAU5P,GACJ6L,KAAKI,MAAMe,UAAYnB,KAAKghB,OAAOlhB,eAGjB,SAAlBE,KAAK4gB,SACF5gB,KAAK8gB,SAASzB,YACjBrf,KAAK8iB,eAAe3uB,CAAC,EACrB6L,KAAK4iB,iBAAgB,GAEd5iB,KAAK6gB,UAAU3V,SACxBlL,KAAKqH,MAAMkS,YAAYplB,EAAG6L,KAAK6gB,UAAUzV,SAAgB,EACzDpL,KAAK6iB,sBAAqB,EAC1B7iB,KAAKe,OAAOyB,QACZxC,KAAK6gB,UAAUre,SACY,UAAlBxC,KAAK4gB,UACd5gB,KAAKqH,MAAMuS,oBAAoBzlB,CAAC,EAChC6L,KAAK6iB,sBAAqB,GACC,SAAlB7iB,KAAK4gB,UACd5gB,KAAKqH,MAAMqT,mBAAmBvmB,EAAG,KAC/B6L,KAAK6iB,sBAAqB,CAC5B,CAAC,EACD7iB,KAAK8F,OAAOA,UACH9F,KAAKqH,MAAM6Q,aACE,mBAAlBlY,KAAK4gB,UACP5gB,KAAKqH,MAAMuT,qBACX5a,KAAKqH,MAAMwR,iBAEX7Y,KAAK6iB,sBAAqB,EAEnB7iB,KAAKqH,MAAM8Q,UACpBnY,KAAKqH,MAAMgK,YACXrR,KAAKiK,WAAU,GACNjK,KAAKyH,UAAU0W,gBACxBne,KAAKyH,UAAU1D,YACN/D,KAAKyH,UAAU0Q,WACxBnY,KAAKyH,UAAU4J,YACfrR,KAAKiK,WAAU,GAElB,CAGDjG,WAAW7P,GACT,IAGQwuB,EAHc,SAAlB3iB,KAAK4gB,SACP5gB,KAAK6iB,sBAAqB,GAEpBF,EAAY3iB,KAAKqH,MAAMoT,iBAAiBtmB,CAAC,GAEtB,SAAnBwuB,EAAUxgB,OACZnC,KAAKqH,MAAMmS,YAAYmJ,CAAS,EAChC3iB,KAAK8F,OAAOA,SACZ9F,KAAKwb,WAAWtN,cAChBlO,KAAK8gB,SAAStB,gBAENxf,KAAK8gB,SAASzB,WAExBrf,KAAK8iB,eAAe3uB,CAAC,CAG1B,CAGDotB,kBACEvhB,KAAKwb,WAAWtb,YAChBF,KAAKqH,MAAMoS,sBACXzZ,KAAK8F,OAAOA,SACZ9F,KAAKiK,WAAU,CAChB,CAGD6Y,eAAe3uB,GACb6L,KAAKqH,MAAMiR,WAAW,CACpBnW,KAAM,OACN7M,EAAGnB,EAAEwQ,QACLpP,EAAGpB,EAAEyQ,OACN,CAAA,EACD5E,KAAKwb,WAAWtN,cAChBlO,KAAK8gB,SAAStB,cACf,CAGDvb,aAAahI,GACX,IAMM8mB,EAL6B,KAAA,IAA1B/iB,KAAKI,MAAMihB,YACU,KAAA,IAArBrhB,KAAKI,MAAMI,QAIduiB,EAAU/iB,KAAKI,MAAMihB,WAAarhB,KAAKI,MAAMI,MAGnDR,KAAKS,SAAST,KAAKI,MAAMC,QAASL,KAAKI,MAAME,SAFxB,SAARrE,EAAiB8mB,EAAU,CAACA,EAEkB,EAC5D,CAGD3e,cAAcjQ,GACZ0C,IAAIkR,EACA/H,KAAKqH,MAAMoR,gBACb1Q,EAAK,CAAC/H,KAAKqH,MAAME,YACRvH,KAAKyH,UAAUC,sBACxBK,EAAK/H,KAAKyH,UAAUE,qBAEtB3H,KAAKsE,KAAK,cAAenQ,EAAEoQ,YAAawD,CAAE,CAC3C,CAEDmG,cACElO,KAAKwb,WAAWtN,aACjB,CAEDhO,YACEF,KAAKwb,WAAWtb,WACjB,CAED6Q,qBAAqBzV,GACnB0E,KAAKsE,KAAK,mBAAoBhJ,CAAM,CACrC,CAGD2O,WAAWuY,EAAsBQ,GAC/B,IAAM5Y,EAAOpK,KAAK6F,UACZ2E,EAAUxK,KAAK8b,QAAQvY,IAAG,EAOhC,IALsB,KAAA,IAAZiH,GAAiD,IAAtBJ,EAAK/C,MAAMhK,QAC1B,KAAA,IAAZmN,GAA2B,CAACwY,IAEpChjB,KAAK8b,QAAQ3R,IAAeC,CAAI,EAE9B,CAACoY,EAAY,CACf,GAAuB,KAAA,IAAZhY,GAA2C,KAAA,IAATJ,EAC3C,OAEEA,GAAQI,GAAW,UAAWJ,GAAQ,UAAWI,GACnDxK,KAAK4K,oBAAoBJ,EAAQnD,MAAO+C,EAAK/C,KAAK,EAEhD+C,GAAQI,GAAW,UAAWJ,GAAQ,UAAWI,GACnDxK,KAAK6K,oBAAoBL,EAAQpK,MAAOgK,EAAKhK,KAAK,CAErD,CACDJ,KAAKsE,KAAK,SAAU8F,CAAI,CACzB,CAGDQ,oBAAoBqY,EAAqBC,GACjCC,EAAQC,KAAKH,EAAUC,CAAQ,EACjCC,GACFnjB,KAAKsE,KAAK,kBAAmB,CAAEnC,KAAM,kBAAmBghB,MAAAA,CAAK,CAAE,CAElE,CAGDtY,oBAAoBwY,EAAiBC,GAC7BH,EAAQC,KAAKC,EAAUC,CAAQ,EACjCH,GACFnjB,KAAKsE,KAAK,kBAAmB,CAAEnC,KAAM,kBAAmBghB,MAAAA,CAAK,CAAE,CAElE,CAEDI,uBAAuB9Z,GACrB,IAAMe,EAAUxK,KAAK6F,UACD,oBAAhB4D,EAAOtH,KACTnC,KAAK0K,QACH,CAAEtK,MAAOoK,EAAQpK,MAAOiH,MAAOmc,MAAMhZ,EAASf,EAAO0Z,KAAK,CAAG,EAC7D,CAAA,EACA,CAAA,CAAI,EAEmB,oBAAhB1Z,EAAOtH,MAChBnC,KAAK0K,QACH,CAAEtK,MAAOojB,MAAMhZ,EAASf,EAAO0Z,KAAK,EAAG9b,MAAOmD,EAAQnD,KAAO,EAC7D,CAAA,EACA,CAAA,CAAI,CAGT,CACF,CCjuBuB,SAAAoc,YAAYrjB,GAyBlC,MAAO,CAAEsjB,MAxBT,SAAeC,GAKb,GAAI,GAHE5b,EACe,UAAnB,OAAO4b,EAAuBnsB,SAASosB,cAAcD,CAAO,EAAIA,IAErD5b,aAAc8b,aACzB,MAAM,IAAI7T,MAAM,gCAAgC,EAElD,GACG,CAAC,WAAY,QAAS,YAAYnI,SACjCvC,OAAOwe,iBAA8B/b,CAAE,EAAEtK,QAAQ,EAQrD,OAAO,IAAIkjB,YAAY,CACrBjf,QAASqG,EACT6Y,SAAUxgB,EAAMwgB,SAChBxgB,MAAAA,CACD,CAAA,EATC,MAAM,IAAI4P,MACR,+EAA+E,CASpF,CACa,CAChB,CDysBA2Q,YAAYO,MAAQA,MACpBP,YAAYQ,WAAaA,WACzBR,YAAYS,KAAOA,KACnBT,YAAYtZ,MAAQA"}